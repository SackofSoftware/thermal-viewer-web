const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/gif-CuT8qcG1.js","assets/index-DEkoPESz.js","assets/index-BTJ2COCN.css","assets/jspdf.es.min-DW0aJyem.js","assets/ThreeView-XYcZP0wC.js"])))=>i.map(i=>d[i]);
import{r as L,j as p,R as Rs,_ as ca}from"./index-DEkoPESz.js";var Zr=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Np={setTimeout:(n,e)=>setTimeout(n,e),clearTimeout:n=>clearTimeout(n),setInterval:(n,e)=>setInterval(n,e),clearInterval:n=>clearInterval(n)},kp=class{#e=Np;#t=!1;setTimeoutProvider(n){this.#e=n}setTimeout(n,e){return this.#e.setTimeout(n,e)}clearTimeout(n){this.#e.clearTimeout(n)}setInterval(n,e){return this.#e.setInterval(n,e)}clearInterval(n){this.#e.clearInterval(n)}},mn=new kp;function Op(n){setTimeout(n,0)}var En=typeof window>"u"||"Deno"in globalThis;function nt(){}function Dp(n,e){return typeof n=="function"?n(e):n}function Io(n){return typeof n=="number"&&n>=0&&n!==1/0}function ch(n,e){return Math.max(n+(e||0)-Date.now(),0)}function Qt(n,e){return typeof n=="function"?n(e):n}function at(n,e){return typeof n=="function"?n(e):n}function Jc(n,e){const{type:t="all",exact:r,fetchStatus:s,predicate:i,queryKey:a,stale:c}=n;if(a){if(r){if(e.queryHash!==la(a,e.options))return!1}else if(!Gr(e.queryKey,a))return!1}if(t!=="all"){const u=e.isActive();if(t==="active"&&!u||t==="inactive"&&u)return!1}return!(typeof c=="boolean"&&e.isStale()!==c||s&&s!==e.state.fetchStatus||i&&!i(e))}function Yc(n,e){const{exact:t,status:r,predicate:s,mutationKey:i}=n;if(i){if(!e.options.mutationKey)return!1;if(t){if(Hr(e.options.mutationKey)!==Hr(i))return!1}else if(!Gr(e.options.mutationKey,i))return!1}return!(r&&e.state.status!==r||s&&!s(e))}function la(n,e){return(e?.queryKeyHashFn||Hr)(n)}function Hr(n){return JSON.stringify(n,(e,t)=>Ao(t)?Object.keys(t).sort().reduce((r,s)=>(r[s]=t[s],r),{}):t)}function Gr(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?Object.keys(e).every(t=>Gr(n[t],e[t])):!1}var Vp=Object.prototype.hasOwnProperty;function lh(n,e,t=0){if(n===e)return n;if(t>500)return e;const r=Xc(n)&&Xc(e);if(!r&&!(Ao(n)&&Ao(e)))return e;const i=(r?n:Object.keys(n)).length,a=r?e:Object.keys(e),c=a.length,u=r?new Array(c):{};let h=0;for(let f=0;f<c;f++){const m=r?f:a[f],v=n[m],S=e[m];if(v===S){u[m]=v,(r?f<i:Vp.call(n,m))&&h++;continue}if(v===null||S===null||typeof v!="object"||typeof S!="object"){u[m]=S;continue}const x=lh(v,S,t+1);u[m]=x,x===v&&h++}return i===c&&h===i?n:u}function xo(n,e){if(!e||Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(n[t]!==e[t])return!1;return!0}function Xc(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function Ao(n){if(!Zc(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!Zc(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function Zc(n){return Object.prototype.toString.call(n)==="[object Object]"}function Mp(n){return new Promise(e=>{mn.setTimeout(e,n)})}function So(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?lh(n,e):e}function Fp(n,e,t=0){const r=[...n,e];return t&&r.length>t?r.slice(1):r}function Lp(n,e,t=0){const r=[e,...n];return t&&r.length>t?r.slice(0,-1):r}var ua=Symbol();function uh(n,e){return!n.queryFn&&e?.initialPromise?()=>e.initialPromise:!n.queryFn||n.queryFn===ua?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}function hh(n,e){return typeof n=="function"?n(...e):!!n}function jp(n,e,t){let r=!1,s;return Object.defineProperty(n,"signal",{enumerable:!0,get:()=>(s??=e(),r||(r=!0,s.aborted?t():s.addEventListener("abort",t,{once:!0})),s)}),n}var Up=class extends Zr{#e;#t;#n;constructor(){super(),this.#n=n=>{if(!En&&window.addEventListener){const e=()=>n();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#n=n,this.#t?.(),this.#t=n(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(n){this.#e!==n&&(this.#e=n,this.onFocus())}onFocus(){const n=this.isFocused();this.listeners.forEach(e=>{e(n)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},ha=new Up;function Ro(){let n,e;const t=new Promise((s,i)=>{n=s,e=i});t.status="pending",t.catch(()=>{});function r(s){Object.assign(t,s),delete t.resolve,delete t.reject}return t.resolve=s=>{r({status:"fulfilled",value:s}),n(s)},t.reject=s=>{r({status:"rejected",reason:s}),e(s)},t}var Bp=Op;function $p(){let n=[],e=0,t=c=>{c()},r=c=>{c()},s=Bp;const i=c=>{e?n.push(c):s(()=>{t(c)})},a=()=>{const c=n;n=[],c.length&&s(()=>{r(()=>{c.forEach(u=>{t(u)})})})};return{batch:c=>{let u;e++;try{u=c()}finally{e--,e||a()}return u},batchCalls:c=>(...u)=>{i(()=>{c(...u)})},schedule:i,setNotifyFunction:c=>{t=c},setBatchNotifyFunction:c=>{r=c},setScheduler:c=>{s=c}}}var He=$p(),qp=class extends Zr{#e=!0;#t;#n;constructor(){super(),this.#n=n=>{if(!En&&window.addEventListener){const e=()=>n(!0),t=()=>n(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#n=n,this.#t?.(),this.#t=n(this.setOnline.bind(this))}setOnline(n){this.#e!==n&&(this.#e=n,this.listeners.forEach(t=>{t(n)}))}isOnline(){return this.#e}},Zs=new qp;function zp(n){return Math.min(1e3*2**n,3e4)}function dh(n){return(n??"online")==="online"?Zs.isOnline():!0}var Co=class extends Error{constructor(n){super("CancelledError"),this.revert=n?.revert,this.silent=n?.silent}};function fh(n){let e=!1,t=0,r;const s=Ro(),i=()=>s.status!=="pending",a=C=>{if(!i()){const A=new Co(C);v(A),n.onCancel?.(A)}},c=()=>{e=!0},u=()=>{e=!1},h=()=>ha.isFocused()&&(n.networkMode==="always"||Zs.isOnline())&&n.canRun(),f=()=>dh(n.networkMode)&&n.canRun(),m=C=>{i()||(r?.(),s.resolve(C))},v=C=>{i()||(r?.(),s.reject(C))},S=()=>new Promise(C=>{r=A=>{(i()||h())&&C(A)},n.onPause?.()}).then(()=>{r=void 0,i()||n.onContinue?.()}),x=()=>{if(i())return;let C;const A=t===0?n.initialPromise:void 0;try{C=A??n.fn()}catch(F){C=Promise.reject(F)}Promise.resolve(C).then(m).catch(F=>{if(i())return;const j=n.retry??(En?0:3),D=n.retryDelay??zp,M=typeof D=="function"?D(t,F):D,$=j===!0||typeof j=="number"&&t<j||typeof j=="function"&&j(t,F);if(e||!$){v(F);return}t++,n.onFail?.(t,F),Mp(M).then(()=>h()?void 0:S()).then(()=>{e?v(F):x()})})};return{promise:s,status:()=>s.status,cancel:a,continue:()=>(r?.(),s),cancelRetry:c,continueRetry:u,canStart:f,start:()=>(f()?x():S().then(x),s)}}var ph=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Io(this.gcTime)&&(this.#e=mn.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(En?1/0:300*1e3))}clearGcTimeout(){this.#e&&(mn.clearTimeout(this.#e),this.#e=void 0)}},Hp=class extends ph{#e;#t;#n;#s;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=tl(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=tl(this.options);t.data!==void 0&&(this.setState(el(t.data,t.dataUpdatedAt)),this.#e=t)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,t){const r=So(this.state.data,e,this.options);return this.#i({data:r,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),r}setState(e,t){this.#i({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#r?.promise;return this.#r?.cancel(e),t?t.then(nt).catch(nt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>at(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===ua||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Qt(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!ch(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(e,t){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const u=this.observers.find(h=>h.options.queryFn);u&&this.setOptions(u.options)}const r=new AbortController,s=u=>{Object.defineProperty(u,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},i=()=>{const u=uh(this.options,t),f=(()=>{const m={client:this.#s,queryKey:this.queryKey,meta:this.meta};return s(m),m})();return this.#o=!1,this.options.persister?this.options.persister(u,f,this):u(f)},c=(()=>{const u={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:i};return s(u),u})();this.options.behavior?.onFetch(c,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==c.fetchOptions?.meta)&&this.#i({type:"fetch",meta:c.fetchOptions?.meta}),this.#r=fh({initialPromise:t?.initialPromise,fn:c.fetchFn,onCancel:u=>{u instanceof Co&&u.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(u,h)=>{this.#i({type:"failed",failureCount:u,error:h})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0});try{const u=await this.#r.start();if(u===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(u),this.#n.config.onSuccess?.(u,this),this.#n.config.onSettled?.(u,this.state.error,this),u}catch(u){if(u instanceof Co){if(u.silent)return this.#r.promise;if(u.revert){if(this.state.data===void 0)throw u;return this.state.data}}throw this.#i({type:"error",error:u}),this.#n.config.onError?.(u,this),this.#n.config.onSettled?.(this.state.data,u,this),u}finally{this.scheduleGc()}}#i(e){const t=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...mh(r.data,this.options),fetchMeta:e.meta??null};case"success":const s={...r,...el(e.data,e.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?s:void 0,s;case"error":const i=e.error;return{...r,error:i,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=t(this.state),He.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function mh(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:dh(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function el(n,e){return{data:n,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function tl(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,r=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var Gp=class extends Zr{constructor(n,e){super(),this.options=e,this.#e=n,this.#i=null,this.#o=Ro(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#s=void 0;#r;#a;#o;#i;#m;#d;#f;#l;#u;#c;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),nl(this.#t,this.options)?this.#h():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Po(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Po(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#w(),this.#b(),this.#t.removeObserver(this)}setOptions(n){const e=this.options,t=this.#t;if(this.options=this.#e.defaultQueryOptions(n),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof at(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#E(),this.#t.setOptions(this.options),e._defaulted&&!xo(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&rl(this.#t,t,this.options,e)&&this.#h(),this.updateResult(),r&&(this.#t!==t||at(this.options.enabled,this.#t)!==at(e.enabled,this.#t)||Qt(this.options.staleTime,this.#t)!==Qt(e.staleTime,this.#t))&&this.#g();const s=this.#y();r&&(this.#t!==t||at(this.options.enabled,this.#t)!==at(e.enabled,this.#t)||s!==this.#c)&&this.#_(s)}getOptimisticResult(n){const e=this.#e.getQueryCache().build(this.#e,n),t=this.createResult(e,n);return Kp(this,t)&&(this.#s=t,this.#a=this.options,this.#r=this.#t.state),t}getCurrentResult(){return this.#s}trackResult(n,e){return new Proxy(n,{get:(t,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(t,r))})}trackProp(n){this.#p.add(n)}getCurrentQuery(){return this.#t}refetch({...n}={}){return this.fetch({...n})}fetchOptimistic(n){const e=this.#e.defaultQueryOptions(n),t=this.#e.getQueryCache().build(this.#e,e);return t.fetch().then(()=>this.createResult(t,e))}fetch(n){return this.#h({...n,cancelRefetch:n.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#h(n){this.#E();let e=this.#t.fetch(this.options,n);return n?.throwOnError||(e=e.catch(nt)),e}#g(){this.#w();const n=Qt(this.options.staleTime,this.#t);if(En||this.#s.isStale||!Io(n))return;const t=ch(this.#s.dataUpdatedAt,n)+1;this.#l=mn.setTimeout(()=>{this.#s.isStale||this.updateResult()},t)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(n){this.#b(),this.#c=n,!(En||at(this.options.enabled,this.#t)===!1||!Io(this.#c)||this.#c===0)&&(this.#u=mn.setInterval(()=>{(this.options.refetchIntervalInBackground||ha.isFocused())&&this.#h()},this.#c))}#v(){this.#g(),this.#_(this.#y())}#w(){this.#l&&(mn.clearTimeout(this.#l),this.#l=void 0)}#b(){this.#u&&(mn.clearInterval(this.#u),this.#u=void 0)}createResult(n,e){const t=this.#t,r=this.options,s=this.#s,i=this.#r,a=this.#a,u=n!==t?n.state:this.#n,{state:h}=n;let f={...h},m=!1,v;if(e._optimisticResults){const _=this.hasListeners(),y=!_&&nl(n,e),T=_&&rl(n,t,e,r);(y||T)&&(f={...f,...mh(h.data,n.options)}),e._optimisticResults==="isRestoring"&&(f.fetchStatus="idle")}let{error:S,errorUpdatedAt:x,status:C}=f;v=f.data;let A=!1;if(e.placeholderData!==void 0&&v===void 0&&C==="pending"){let _;s?.isPlaceholderData&&e.placeholderData===a?.placeholderData?(_=s.data,A=!0):_=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,_!==void 0&&(C="success",v=So(s?.data,_,e),m=!0)}if(e.select&&v!==void 0&&!A)if(s&&v===i?.data&&e.select===this.#m)v=this.#d;else try{this.#m=e.select,v=e.select(v),v=So(s?.data,v,e),this.#d=v,this.#i=null}catch(_){this.#i=_}this.#i&&(S=this.#i,v=this.#d,x=Date.now(),C="error");const F=f.fetchStatus==="fetching",j=C==="pending",D=C==="error",M=j&&F,$=v!==void 0,E={status:C,fetchStatus:f.fetchStatus,isPending:j,isSuccess:C==="success",isError:D,isInitialLoading:M,isLoading:M,data:v,dataUpdatedAt:f.dataUpdatedAt,error:S,errorUpdatedAt:x,failureCount:f.fetchFailureCount,failureReason:f.fetchFailureReason,errorUpdateCount:f.errorUpdateCount,isFetched:f.dataUpdateCount>0||f.errorUpdateCount>0,isFetchedAfterMount:f.dataUpdateCount>u.dataUpdateCount||f.errorUpdateCount>u.errorUpdateCount,isFetching:F,isRefetching:F&&!j,isLoadingError:D&&!$,isPaused:f.fetchStatus==="paused",isPlaceholderData:m,isRefetchError:D&&$,isStale:da(n,e),refetch:this.refetch,promise:this.#o,isEnabled:at(e.enabled,n)!==!1};if(this.options.experimental_prefetchInRender){const _=E.data!==void 0,y=E.status==="error"&&!_,T=w=>{y?w.reject(E.error):_&&w.resolve(E.data)},b=()=>{const w=this.#o=E.promise=Ro();T(w)},I=this.#o;switch(I.status){case"pending":n.queryHash===t.queryHash&&T(I);break;case"fulfilled":(y||E.data!==I.value)&&b();break;case"rejected":(!y||E.error!==I.reason)&&b();break}}return E}updateResult(){const n=this.#s,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),xo(e,n))return;this.#s=e;const t=()=>{if(!n)return!0;const{notifyOnChangeProps:r}=this.options,s=typeof r=="function"?r():r;if(s==="all"||!s&&!this.#p.size)return!0;const i=new Set(s??this.#p);return this.options.throwOnError&&i.add("error"),Object.keys(this.#s).some(a=>{const c=a;return this.#s[c]!==n[c]&&i.has(c)})};this.#T({listeners:t()})}#E(){const n=this.#e.getQueryCache().build(this.#e,this.options);if(n===this.#t)return;const e=this.#t;this.#t=n,this.#n=n.state,this.hasListeners()&&(e?.removeObserver(this),n.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#T(n){He.batch(()=>{n.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Wp(n,e){return at(e.enabled,n)!==!1&&n.state.data===void 0&&!(n.state.status==="error"&&e.retryOnMount===!1)}function nl(n,e){return Wp(n,e)||n.state.data!==void 0&&Po(n,e,e.refetchOnMount)}function Po(n,e,t){if(at(e.enabled,n)!==!1&&Qt(e.staleTime,n)!=="static"){const r=typeof t=="function"?t(n):t;return r==="always"||r!==!1&&da(n,e)}return!1}function rl(n,e,t,r){return(n!==e||at(r.enabled,n)===!1)&&(!t.suspense||n.state.status!=="error")&&da(n,t)}function da(n,e){return at(e.enabled,n)!==!1&&n.isStaleByTime(Qt(e.staleTime,n))}function Kp(n,e){return!xo(n.getCurrentResult(),e)}function sl(n){return{onFetch:(e,t)=>{const r=e.options,s=e.fetchOptions?.meta?.fetchMore?.direction,i=e.state.data?.pages||[],a=e.state.data?.pageParams||[];let c={pages:[],pageParams:[]},u=0;const h=async()=>{let f=!1;const m=x=>{jp(x,()=>e.signal,()=>f=!0)},v=uh(e.options,e.fetchOptions),S=async(x,C,A)=>{if(f)return Promise.reject();if(C==null&&x.pages.length)return Promise.resolve(x);const j=(()=>{const H={client:e.client,queryKey:e.queryKey,pageParam:C,direction:A?"backward":"forward",meta:e.options.meta};return m(H),H})(),D=await v(j),{maxPages:M}=e.options,$=A?Lp:Fp;return{pages:$(x.pages,D,M),pageParams:$(x.pageParams,C,M)}};if(s&&i.length){const x=s==="backward",C=x?Qp:il,A={pages:i,pageParams:a},F=C(r,A);c=await S(A,F,x)}else{const x=n??i.length;do{const C=u===0?a[0]??r.initialPageParam:il(r,c);if(u>0&&C==null)break;c=await S(c,C),u++}while(u<x)}return c};e.options.persister?e.fetchFn=()=>e.options.persister?.(h,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t):e.fetchFn=h}}}function il(n,{pages:e,pageParams:t}){const r=e.length-1;return e.length>0?n.getNextPageParam(e[r],e,t[r],t):void 0}function Qp(n,{pages:e,pageParams:t}){return e.length>0?n.getPreviousPageParam?.(e[0],e,t[0],t):void 0}var Jp=class extends ph{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||Yp(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(t=>t!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=fh({fn:()=>this.options.mutationFn?this.options.mutationFn(e,r):Promise.reject(new Error("No mutationFn found")),onFail:(a,c)=>{this.#r({type:"failed",failureCount:a,error:c})},onPause:()=>{this.#r({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const s=this.state.status==="pending",i=!this.#s.canStart();try{if(s)t();else{this.#r({type:"pending",variables:e,isPaused:i}),this.#n.config.onMutate&&await this.#n.config.onMutate(e,this,r);const c=await this.options.onMutate?.(e,r);c!==this.state.context&&this.#r({type:"pending",context:c,variables:e,isPaused:i})}const a=await this.#s.start();return await this.#n.config.onSuccess?.(a,e,this.state.context,this,r),await this.options.onSuccess?.(a,e,this.state.context,r),await this.#n.config.onSettled?.(a,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(a,null,e,this.state.context,r),this.#r({type:"success",data:a}),a}catch(a){try{await this.#n.config.onError?.(a,e,this.state.context,this,r)}catch(c){Promise.reject(c)}try{await this.options.onError?.(a,e,this.state.context,r)}catch(c){Promise.reject(c)}try{await this.#n.config.onSettled?.(void 0,a,this.state.variables,this.state.context,this,r)}catch(c){Promise.reject(c)}try{await this.options.onSettled?.(void 0,a,e,this.state.context,r)}catch(c){Promise.reject(c)}throw this.#r({type:"error",error:a}),a}finally{this.#n.runNext(this)}}#r(e){const t=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),He.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function Yp(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Xp=class extends Zr{constructor(n={}){super(),this.config=n,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(n,e,t){const r=new Jp({client:n,mutationCache:this,mutationId:++this.#n,options:n.defaultMutationOptions(e),state:t});return this.add(r),r}add(n){this.#e.add(n);const e=Cs(n);if(typeof e=="string"){const t=this.#t.get(e);t?t.push(n):this.#t.set(e,[n])}this.notify({type:"added",mutation:n})}remove(n){if(this.#e.delete(n)){const e=Cs(n);if(typeof e=="string"){const t=this.#t.get(e);if(t)if(t.length>1){const r=t.indexOf(n);r!==-1&&t.splice(r,1)}else t[0]===n&&this.#t.delete(e)}}this.notify({type:"removed",mutation:n})}canRun(n){const e=Cs(n);if(typeof e=="string"){const r=this.#t.get(e)?.find(s=>s.state.status==="pending");return!r||r===n}else return!0}runNext(n){const e=Cs(n);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==n&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){He.batch(()=>{this.#e.forEach(n=>{this.notify({type:"removed",mutation:n})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(n){const e={exact:!0,...n};return this.getAll().find(t=>Yc(e,t))}findAll(n={}){return this.getAll().filter(e=>Yc(n,e))}notify(n){He.batch(()=>{this.listeners.forEach(e=>{e(n)})})}resumePausedMutations(){const n=this.getAll().filter(e=>e.state.isPaused);return He.batch(()=>Promise.all(n.map(e=>e.continue().catch(nt))))}};function Cs(n){return n.options.scope?.id}var Zp=class extends Zr{constructor(n={}){super(),this.config=n,this.#e=new Map}#e;build(n,e,t){const r=e.queryKey,s=e.queryHash??la(r,e);let i=this.get(s);return i||(i=new Hp({client:n,queryKey:r,queryHash:s,options:n.defaultQueryOptions(e),state:t,defaultOptions:n.getQueryDefaults(r)}),this.add(i)),i}add(n){this.#e.has(n.queryHash)||(this.#e.set(n.queryHash,n),this.notify({type:"added",query:n}))}remove(n){const e=this.#e.get(n.queryHash);e&&(n.destroy(),e===n&&this.#e.delete(n.queryHash),this.notify({type:"removed",query:n}))}clear(){He.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}get(n){return this.#e.get(n)}getAll(){return[...this.#e.values()]}find(n){const e={exact:!0,...n};return this.getAll().find(t=>Jc(e,t))}findAll(n={}){const e=this.getAll();return Object.keys(n).length>0?e.filter(t=>Jc(n,t)):e}notify(n){He.batch(()=>{this.listeners.forEach(e=>{e(n)})})}onFocus(){He.batch(()=>{this.getAll().forEach(n=>{n.onFocus()})})}onOnline(){He.batch(()=>{this.getAll().forEach(n=>{n.onOnline()})})}},em=class{#e;#t;#n;#s;#r;#a;#o;#i;constructor(n={}){this.#e=n.queryCache||new Zp,this.#t=n.mutationCache||new Xp,this.#n=n.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=ha.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=Zs.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#i?.(),this.#i=void 0)}isFetching(n){return this.#e.findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return this.#t.findAll({...n,status:"pending"}).length}getQueryData(n){const e=this.defaultQueryOptions({queryKey:n});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(n){const e=this.defaultQueryOptions(n),t=this.#e.build(this,e),r=t.state.data;return r===void 0?this.fetchQuery(n):(n.revalidateIfStale&&t.isStaleByTime(Qt(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(n){return this.#e.findAll(n).map(({queryKey:e,state:t})=>{const r=t.data;return[e,r]})}setQueryData(n,e,t){const r=this.defaultQueryOptions({queryKey:n}),i=this.#e.get(r.queryHash)?.state.data,a=Dp(e,i);if(a!==void 0)return this.#e.build(this,r).setData(a,{...t,manual:!0})}setQueriesData(n,e,t){return He.batch(()=>this.#e.findAll(n).map(({queryKey:r})=>[r,this.setQueryData(r,e,t)]))}getQueryState(n){const e=this.defaultQueryOptions({queryKey:n});return this.#e.get(e.queryHash)?.state}removeQueries(n){const e=this.#e;He.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=this.#e;return He.batch(()=>(t.findAll(n).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...n},e)))}cancelQueries(n,e={}){const t={revert:!0,...e},r=He.batch(()=>this.#e.findAll(n).map(s=>s.cancel(t)));return Promise.all(r).then(nt).catch(nt)}invalidateQueries(n,e={}){return He.batch(()=>(this.#e.findAll(n).forEach(t=>{t.invalidate()}),n?.refetchType==="none"?Promise.resolve():this.refetchQueries({...n,type:n?.refetchType??n?.type??"active"},e)))}refetchQueries(n,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},r=He.batch(()=>this.#e.findAll(n).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let i=s.fetch(void 0,t);return t.throwOnError||(i=i.catch(nt)),s.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(r).then(nt)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=this.#e.build(this,e);return t.isStaleByTime(Qt(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(nt).catch(nt)}fetchInfiniteQuery(n){return n.behavior=sl(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(nt).catch(nt)}ensureInfiniteQueryData(n){return n.behavior=sl(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return Zs.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(n){this.#n=n}setQueryDefaults(n,e){this.#s.set(Hr(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...this.#s.values()],t={};return e.forEach(r=>{Gr(n,r.queryKey)&&Object.assign(t,r.defaultOptions)}),t}setMutationDefaults(n,e){this.#r.set(Hr(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...this.#r.values()],t={};return e.forEach(r=>{Gr(n,r.mutationKey)&&Object.assign(t,r.defaultOptions)}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...this.#n.queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=la(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===ua&&(e.enabled=!1),e}defaultMutationOptions(n){return n?._defaulted?n:{...this.#n.mutations,...n?.mutationKey&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},gh=L.createContext(void 0),yh=n=>{const e=L.useContext(gh);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},tm=({client:n,children:e})=>(L.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),p.jsx(gh.Provider,{value:n,children:e})),_h=L.createContext(!1),nm=()=>L.useContext(_h);_h.Provider;function rm(){let n=!1;return{clearReset:()=>{n=!1},reset:()=>{n=!0},isReset:()=>n}}var sm=L.createContext(rm()),im=()=>L.useContext(sm),om=(n,e,t)=>{const r=t?.state.error&&typeof n.throwOnError=="function"?hh(n.throwOnError,[t.state.error,t]):n.throwOnError;(n.suspense||n.experimental_prefetchInRender||r)&&(e.isReset()||(n.retryOnMount=!1))},am=n=>{L.useEffect(()=>{n.clearReset()},[n])},cm=({result:n,errorResetBoundary:e,throwOnError:t,query:r,suspense:s})=>n.isError&&!e.isReset()&&!n.isFetching&&r&&(s&&n.data===void 0||hh(t,[n.error,r])),lm=n=>{if(n.suspense){const t=s=>s==="static"?s:Math.max(s??1e3,1e3),r=n.staleTime;n.staleTime=typeof r=="function"?(...s)=>t(r(...s)):t(r),typeof n.gcTime=="number"&&(n.gcTime=Math.max(n.gcTime,1e3))}},um=(n,e)=>n.isLoading&&n.isFetching&&!e,hm=(n,e)=>n?.suspense&&e.isPending,ol=(n,e,t)=>e.fetchOptimistic(n).catch(()=>{t.clearReset()});function dm(n,e,t){const r=nm(),s=im(),i=yh(),a=i.defaultQueryOptions(n);i.getDefaultOptions().queries?._experimental_beforeQuery?.(a);const c=i.getQueryCache().get(a.queryHash);a._optimisticResults=r?"isRestoring":"optimistic",lm(a),om(a,s,c),am(s);const u=!i.getQueryCache().get(a.queryHash),[h]=L.useState(()=>new e(i,a)),f=h.getOptimisticResult(a),m=!r&&n.subscribed!==!1;if(L.useSyncExternalStore(L.useCallback(v=>{const S=m?h.subscribe(He.batchCalls(v)):nt;return h.updateResult(),S},[h,m]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),L.useEffect(()=>{h.setOptions(a)},[a,h]),hm(a,f))throw ol(a,h,s);if(cm({result:f,errorResetBoundary:s,throwOnError:a.throwOnError,query:c,suspense:a.suspense}))throw f.error;return i.getDefaultOptions().queries?._experimental_afterQuery?.(a,f),a.experimental_prefetchInRender&&!En&&um(f,r)&&(u?ol(a,h,s):c?.promise)?.catch(nt).finally(()=>{h.updateResult()}),a.notifyOnChangeProps?f:h.trackResult(f)}function Nr(n,e){return dm(n,Gp)}const al=n=>{let e;const t=new Set,r=(h,f)=>{const m=typeof h=="function"?h(e):h;if(!Object.is(m,e)){const v=e;e=f??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(S=>S(e,v))}},s=()=>e,c={setState:r,getState:s,getInitialState:()=>u,subscribe:h=>(t.add(h),()=>t.delete(h))},u=e=n(r,s,c);return c},fm=(n=>n?al(n):al),pm=n=>n;function mm(n,e=pm){const t=Rs.useSyncExternalStore(n.subscribe,Rs.useCallback(()=>e(n.getState()),[n,e]),Rs.useCallback(()=>e(n.getInitialState()),[n,e]));return Rs.useDebugValue(t),t}const cl=n=>{const e=fm(n),t=r=>mm(e,r);return Object.assign(t,e),t},gm=(n=>n?cl(n):cl);function Dn(n,e){try{const t=`thermal-viewer-image-${n}`;localStorage.setItem(t,JSON.stringify(e))}catch(t){console.warn("Failed to save image settings:",t)}}function ll(n){try{const e=`thermal-viewer-image-${n}`,t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(e){console.warn("Failed to load image settings:",e)}return null}const St=gm(n=>({currentImage:null,thermalStats:null,viewMode:"overlay",colormap:"hot_iron",opacity:.6,minTemp:0,maxTemp:100,displayMinTemp:0,displayMaxTemp:100,markers:[],hoverTemp:null,zoom:1,panX:0,panY:0,thermalZoom:1,alignOffsetX:0,alignOffsetY:0,isLoading:!1,setCurrentImage:e=>n(t=>{if(t.currentImage&&Dn(t.currentImage.id,{colormap:t.colormap,displayMinTemp:t.displayMinTemp,displayMaxTemp:t.displayMaxTemp,markers:t.markers}),e){const r=ll(e.id);if(r)return{currentImage:e,colormap:r.colormap,displayMinTemp:r.displayMinTemp,displayMaxTemp:r.displayMaxTemp,markers:r.markers}}return{currentImage:e,markers:[]}}),setThermalStats:e=>n(t=>{const r=t.currentImage&&ll(t.currentImage.id)!==null;return{thermalStats:e,minTemp:e?.minTemp??t.minTemp,maxTemp:e?.maxTemp??t.maxTemp,displayMinTemp:r?t.displayMinTemp:e?.minTemp??t.displayMinTemp,displayMaxTemp:r?t.displayMaxTemp:e?.maxTemp??t.displayMaxTemp}}),setViewMode:e=>n({viewMode:e}),setColormap:e=>n(t=>(t.currentImage&&Dn(t.currentImage.id,{colormap:e,displayMinTemp:t.displayMinTemp,displayMaxTemp:t.displayMaxTemp,markers:t.markers}),{colormap:e})),setOpacity:e=>n({opacity:e}),setDisplayTempRange:(e,t)=>n(r=>(r.currentImage&&Dn(r.currentImage.id,{colormap:r.colormap,displayMinTemp:e,displayMaxTemp:t,markers:r.markers}),{displayMinTemp:e,displayMaxTemp:t})),setTempRange:(e,t)=>n({minTemp:e,maxTemp:t}),addMarker:e=>n(t=>{const r=[...t.markers,e];return t.currentImage&&Dn(t.currentImage.id,{colormap:t.colormap,displayMinTemp:t.displayMinTemp,displayMaxTemp:t.displayMaxTemp,markers:r}),{markers:r}}),removeMarker:e=>n(t=>{const r=t.markers.filter(s=>s.id!==e);return t.currentImage&&Dn(t.currentImage.id,{colormap:t.colormap,displayMinTemp:t.displayMinTemp,displayMaxTemp:t.displayMaxTemp,markers:r}),{markers:r}}),clearMarkers:()=>n(e=>(e.currentImage&&Dn(e.currentImage.id,{colormap:e.colormap,displayMinTemp:e.displayMinTemp,displayMaxTemp:e.displayMaxTemp,markers:[]}),{markers:[]})),setHoverTemp:e=>n({hoverTemp:e}),setZoom:e=>n({zoom:Math.max(.5,Math.min(5,e))}),setPan:(e,t)=>n({panX:e,panY:t}),resetView:()=>n({zoom:1,panX:0,panY:0}),setLoading:e=>n({isLoading:e}),setThermalZoom:e=>n({thermalZoom:Math.max(1,Math.min(8,e))}),setAlignOffset:(e,t)=>n({alignOffsetX:e,alignOffsetY:t})}));function vh(n,e){return function(){return n.apply(e,arguments)}}const{toString:ym}=Object.prototype,{getPrototypeOf:fa}=Object,{iterator:vi,toStringTag:wh}=Symbol,wi=(n=>e=>{const t=ym.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),ft=n=>(n=n.toLowerCase(),e=>wi(e)===n),bi=n=>e=>typeof e===n,{isArray:ir}=Array,Jn=bi("undefined");function es(n){return n!==null&&!Jn(n)&&n.constructor!==null&&!Jn(n.constructor)&&st(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const bh=ft("ArrayBuffer");function _m(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&bh(n.buffer),e}const vm=bi("string"),st=bi("function"),Eh=bi("number"),ts=n=>n!==null&&typeof n=="object",wm=n=>n===!0||n===!1,js=n=>{if(wi(n)!=="object")return!1;const e=fa(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(wh in n)&&!(vi in n)},bm=n=>{if(!ts(n)||es(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},Em=ft("Date"),Tm=ft("File"),Im=ft("Blob"),xm=ft("FileList"),Am=n=>ts(n)&&st(n.pipe),Sm=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||st(n.append)&&((e=wi(n))==="formdata"||e==="object"&&st(n.toString)&&n.toString()==="[object FormData]"))},Rm=ft("URLSearchParams"),[Cm,Pm,Nm,km]=["ReadableStream","Request","Response","Headers"].map(ft),Om=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ns(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,s;if(typeof n!="object"&&(n=[n]),ir(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{if(es(n))return;const i=t?Object.getOwnPropertyNames(n):Object.keys(n),a=i.length;let c;for(r=0;r<a;r++)c=i[r],e.call(null,n[c],c,n)}}function Th(n,e){if(es(n))return null;e=e.toLowerCase();const t=Object.keys(n);let r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}const gn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ih=n=>!Jn(n)&&n!==gn;function No(){const{caseless:n,skipUndefined:e}=Ih(this)&&this||{},t={},r=(s,i)=>{const a=n&&Th(t,i)||i;js(t[a])&&js(s)?t[a]=No(t[a],s):js(s)?t[a]=No({},s):ir(s)?t[a]=s.slice():(!e||!Jn(s))&&(t[a]=s)};for(let s=0,i=arguments.length;s<i;s++)arguments[s]&&ns(arguments[s],r);return t}const Dm=(n,e,t,{allOwnKeys:r}={})=>(ns(e,(s,i)=>{t&&st(s)?Object.defineProperty(n,i,{value:vh(s,t),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(n,i,{value:s,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:r}),n),Vm=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Mm=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),Object.defineProperty(n.prototype,"constructor",{value:n,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},Fm=(n,e,t,r)=>{let s,i,a;const c={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),i=s.length;i-- >0;)a=s[i],(!r||r(a,n,e))&&!c[a]&&(e[a]=n[a],c[a]=!0);n=t!==!1&&fa(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},Lm=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},jm=n=>{if(!n)return null;if(ir(n))return n;let e=n.length;if(!Eh(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},Um=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&fa(Uint8Array)),Bm=(n,e)=>{const r=(n&&n[vi]).call(n);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(n,i[0],i[1])}},$m=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},qm=ft("HTMLFormElement"),zm=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),ul=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Hm=ft("RegExp"),xh=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};ns(t,(s,i)=>{let a;(a=e(s,i,n))!==!1&&(r[i]=a||s)}),Object.defineProperties(n,r)},Gm=n=>{xh(n,(e,t)=>{if(st(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(st(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Wm=(n,e)=>{const t={},r=s=>{s.forEach(i=>{t[i]=!0})};return ir(n)?r(n):r(String(n).split(e)),t},Km=()=>{},Qm=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function Jm(n){return!!(n&&st(n.append)&&n[wh]==="FormData"&&n[vi])}const Ym=n=>{const e=new Array(10),t=(r,s)=>{if(ts(r)){if(e.indexOf(r)>=0)return;if(es(r))return r;if(!("toJSON"in r)){e[s]=r;const i=ir(r)?[]:{};return ns(r,(a,c)=>{const u=t(a,s+1);!Jn(u)&&(i[c]=u)}),e[s]=void 0,i}}return r};return t(n,0)},Xm=ft("AsyncFunction"),Zm=n=>n&&(ts(n)||st(n))&&st(n.then)&&st(n.catch),Ah=((n,e)=>n?setImmediate:e?((t,r)=>(gn.addEventListener("message",({source:s,data:i})=>{s===gn&&i===t&&r.length&&r.shift()()},!1),s=>{r.push(s),gn.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",st(gn.postMessage)),eg=typeof queueMicrotask<"u"?queueMicrotask.bind(gn):typeof process<"u"&&process.nextTick||Ah,tg=n=>n!=null&&st(n[vi]),N={isArray:ir,isArrayBuffer:bh,isBuffer:es,isFormData:Sm,isArrayBufferView:_m,isString:vm,isNumber:Eh,isBoolean:wm,isObject:ts,isPlainObject:js,isEmptyObject:bm,isReadableStream:Cm,isRequest:Pm,isResponse:Nm,isHeaders:km,isUndefined:Jn,isDate:Em,isFile:Tm,isBlob:Im,isRegExp:Hm,isFunction:st,isStream:Am,isURLSearchParams:Rm,isTypedArray:Um,isFileList:xm,forEach:ns,merge:No,extend:Dm,trim:Om,stripBOM:Vm,inherits:Mm,toFlatObject:Fm,kindOf:wi,kindOfTest:ft,endsWith:Lm,toArray:jm,forEachEntry:Bm,matchAll:$m,isHTMLForm:qm,hasOwnProperty:ul,hasOwnProp:ul,reduceDescriptors:xh,freezeMethods:Gm,toObjectSet:Wm,toCamelCase:zm,noop:Km,toFiniteNumber:Qm,findKey:Th,global:gn,isContextDefined:Ih,isSpecCompliantForm:Jm,toJSONObject:Ym,isAsyncFn:Xm,isThenable:Zm,setImmediate:Ah,asap:eg,isIterable:tg};let Y=class Sh extends Error{static from(e,t,r,s,i,a){const c=new Sh(e.message,t||e.code,r,s,i);return c.cause=e,c.name=e.name,a&&Object.assign(c,a),c}constructor(e,t,r,s,i){super(e),this.name="AxiosError",this.isAxiosError=!0,t&&(this.code=t),r&&(this.config=r),s&&(this.request=s),i&&(this.response=i,this.status=i.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:N.toJSONObject(this.config),code:this.code,status:this.status}}};Y.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";Y.ERR_BAD_OPTION="ERR_BAD_OPTION";Y.ECONNABORTED="ECONNABORTED";Y.ETIMEDOUT="ETIMEDOUT";Y.ERR_NETWORK="ERR_NETWORK";Y.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";Y.ERR_DEPRECATED="ERR_DEPRECATED";Y.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";Y.ERR_BAD_REQUEST="ERR_BAD_REQUEST";Y.ERR_CANCELED="ERR_CANCELED";Y.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";Y.ERR_INVALID_URL="ERR_INVALID_URL";const ng=null;function ko(n){return N.isPlainObject(n)||N.isArray(n)}function Rh(n){return N.endsWith(n,"[]")?n.slice(0,-2):n}function hl(n,e,t){return n?n.concat(e).map(function(s,i){return s=Rh(s),!t&&i?"["+s+"]":s}).join(t?".":""):e}function rg(n){return N.isArray(n)&&!n.some(ko)}const sg=N.toFlatObject(N,{},null,function(e){return/^is[A-Z]/.test(e)});function Ei(n,e,t){if(!N.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=N.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(C,A){return!N.isUndefined(A[C])});const r=t.metaTokens,s=t.visitor||f,i=t.dots,a=t.indexes,u=(t.Blob||typeof Blob<"u"&&Blob)&&N.isSpecCompliantForm(e);if(!N.isFunction(s))throw new TypeError("visitor must be a function");function h(x){if(x===null)return"";if(N.isDate(x))return x.toISOString();if(N.isBoolean(x))return x.toString();if(!u&&N.isBlob(x))throw new Y("Blob is not supported. Use a Buffer instead.");return N.isArrayBuffer(x)||N.isTypedArray(x)?u&&typeof Blob=="function"?new Blob([x]):Buffer.from(x):x}function f(x,C,A){let F=x;if(x&&!A&&typeof x=="object"){if(N.endsWith(C,"{}"))C=r?C:C.slice(0,-2),x=JSON.stringify(x);else if(N.isArray(x)&&rg(x)||(N.isFileList(x)||N.endsWith(C,"[]"))&&(F=N.toArray(x)))return C=Rh(C),F.forEach(function(D,M){!(N.isUndefined(D)||D===null)&&e.append(a===!0?hl([C],M,i):a===null?C:C+"[]",h(D))}),!1}return ko(x)?!0:(e.append(hl(A,C,i),h(x)),!1)}const m=[],v=Object.assign(sg,{defaultVisitor:f,convertValue:h,isVisitable:ko});function S(x,C){if(!N.isUndefined(x)){if(m.indexOf(x)!==-1)throw Error("Circular reference detected in "+C.join("."));m.push(x),N.forEach(x,function(F,j){(!(N.isUndefined(F)||F===null)&&s.call(e,F,N.isString(j)?j.trim():j,C,v))===!0&&S(F,C?C.concat(j):[j])}),m.pop()}}if(!N.isObject(n))throw new TypeError("data must be an object");return S(n),e}function dl(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function pa(n,e){this._pairs=[],n&&Ei(n,this,e)}const Ch=pa.prototype;Ch.append=function(e,t){this._pairs.push([e,t])};Ch.toString=function(e){const t=e?function(r){return e.call(this,r,dl)}:dl;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function ig(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ph(n,e,t){if(!e)return n;const r=t&&t.encode||ig,s=N.isFunction(t)?{serialize:t}:t,i=s&&s.serialize;let a;if(i?a=i(e,s):a=N.isURLSearchParams(e)?e.toString():new pa(e,s).toString(r),a){const c=n.indexOf("#");c!==-1&&(n=n.slice(0,c)),n+=(n.indexOf("?")===-1?"?":"&")+a}return n}class fl{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){N.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Nh={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},og=typeof URLSearchParams<"u"?URLSearchParams:pa,ag=typeof FormData<"u"?FormData:null,cg=typeof Blob<"u"?Blob:null,lg={isBrowser:!0,classes:{URLSearchParams:og,FormData:ag,Blob:cg},protocols:["http","https","file","blob","url","data"]},ma=typeof window<"u"&&typeof document<"u",Oo=typeof navigator=="object"&&navigator||void 0,ug=ma&&(!Oo||["ReactNative","NativeScript","NS"].indexOf(Oo.product)<0),hg=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",dg=ma&&window.location.href||"http://localhost",fg=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ma,hasStandardBrowserEnv:ug,hasStandardBrowserWebWorkerEnv:hg,navigator:Oo,origin:dg},Symbol.toStringTag,{value:"Module"})),Ye={...fg,...lg};function pg(n,e){return Ei(n,new Ye.classes.URLSearchParams,{visitor:function(t,r,s,i){return Ye.isNode&&N.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...e})}function mg(n){return N.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function gg(n){const e={},t=Object.keys(n);let r;const s=t.length;let i;for(r=0;r<s;r++)i=t[r],e[i]=n[i];return e}function kh(n){function e(t,r,s,i){let a=t[i++];if(a==="__proto__")return!0;const c=Number.isFinite(+a),u=i>=t.length;return a=!a&&N.isArray(s)?s.length:a,u?(N.hasOwnProp(s,a)?s[a]=[s[a],r]:s[a]=r,!c):((!s[a]||!N.isObject(s[a]))&&(s[a]=[]),e(t,r,s[a],i)&&N.isArray(s[a])&&(s[a]=gg(s[a])),!c)}if(N.isFormData(n)&&N.isFunction(n.entries)){const t={};return N.forEachEntry(n,(r,s)=>{e(mg(r),s,t,0)}),t}return null}function yg(n,e,t){if(N.isString(n))try{return(e||JSON.parse)(n),N.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const rs={transitional:Nh,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,i=N.isObject(e);if(i&&N.isHTMLForm(e)&&(e=new FormData(e)),N.isFormData(e))return s?JSON.stringify(kh(e)):e;if(N.isArrayBuffer(e)||N.isBuffer(e)||N.isStream(e)||N.isFile(e)||N.isBlob(e)||N.isReadableStream(e))return e;if(N.isArrayBufferView(e))return e.buffer;if(N.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return pg(e,this.formSerializer).toString();if((c=N.isFileList(e))||r.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return Ei(c?{"files[]":e}:e,u&&new u,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),yg(e)):e}],transformResponse:[function(e){const t=this.transitional||rs.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(N.isResponse(e)||N.isReadableStream(e))return e;if(e&&N.isString(e)&&(r&&!this.responseType||s)){const a=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e,this.parseReviver)}catch(c){if(a)throw c.name==="SyntaxError"?Y.from(c,Y.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ye.classes.FormData,Blob:Ye.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};N.forEach(["delete","get","head","post","put","patch"],n=>{rs.headers[n]={}});const _g=N.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),vg=n=>{const e={};let t,r,s;return n&&n.split(`
`).forEach(function(a){s=a.indexOf(":"),t=a.substring(0,s).trim().toLowerCase(),r=a.substring(s+1).trim(),!(!t||e[t]&&_g[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},pl=Symbol("internals");function kr(n){return n&&String(n).trim().toLowerCase()}function Us(n){return n===!1||n==null?n:N.isArray(n)?n.map(Us):String(n)}function wg(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const bg=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function so(n,e,t,r,s){if(N.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!N.isString(e)){if(N.isString(r))return e.indexOf(r)!==-1;if(N.isRegExp(r))return r.test(e)}}function Eg(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function Tg(n,e){const t=N.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,i,a){return this[r].call(this,e,s,i,a)},configurable:!0})})}let it=class{constructor(e){e&&this.set(e)}set(e,t,r){const s=this;function i(c,u,h){const f=kr(u);if(!f)throw new Error("header name must be a non-empty string");const m=N.findKey(s,f);(!m||s[m]===void 0||h===!0||h===void 0&&s[m]!==!1)&&(s[m||u]=Us(c))}const a=(c,u)=>N.forEach(c,(h,f)=>i(h,f,u));if(N.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(N.isString(e)&&(e=e.trim())&&!bg(e))a(vg(e),t);else if(N.isObject(e)&&N.isIterable(e)){let c={},u,h;for(const f of e){if(!N.isArray(f))throw TypeError("Object iterator must return a key-value pair");c[h=f[0]]=(u=c[h])?N.isArray(u)?[...u,f[1]]:[u,f[1]]:f[1]}a(c,t)}else e!=null&&i(t,e,r);return this}get(e,t){if(e=kr(e),e){const r=N.findKey(this,e);if(r){const s=this[r];if(!t)return s;if(t===!0)return wg(s);if(N.isFunction(t))return t.call(this,s,r);if(N.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=kr(e),e){const r=N.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||so(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let s=!1;function i(a){if(a=kr(a),a){const c=N.findKey(r,a);c&&(!t||so(r,r[c],c,t))&&(delete r[c],s=!0)}}return N.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let r=t.length,s=!1;for(;r--;){const i=t[r];(!e||so(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const t=this,r={};return N.forEach(this,(s,i)=>{const a=N.findKey(r,i);if(a){t[a]=Us(s),delete t[i];return}const c=e?Eg(i):String(i).trim();c!==i&&delete t[i],t[c]=Us(s),r[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return N.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&N.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[pl]=this[pl]={accessors:{}}).accessors,s=this.prototype;function i(a){const c=kr(a);r[c]||(Tg(s,a),r[c]=!0)}return N.isArray(e)?e.forEach(i):i(e),this}};it.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);N.reduceDescriptors(it.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});N.freezeMethods(it);function io(n,e){const t=this||rs,r=e||t,s=it.from(r.headers);let i=r.data;return N.forEach(n,function(c){i=c.call(t,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function Oh(n){return!!(n&&n.__CANCEL__)}let ss=class extends Y{constructor(e,t,r){super(e??"canceled",Y.ERR_CANCELED,t,r),this.name="CanceledError",this.__CANCEL__=!0}};function Dh(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Y("Request failed with status code "+t.status,[Y.ERR_BAD_REQUEST,Y.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Ig(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function xg(n,e){n=n||10;const t=new Array(n),r=new Array(n);let s=0,i=0,a;return e=e!==void 0?e:1e3,function(u){const h=Date.now(),f=r[i];a||(a=h),t[s]=u,r[s]=h;let m=i,v=0;for(;m!==s;)v+=t[m++],m=m%n;if(s=(s+1)%n,s===i&&(i=(i+1)%n),h-a<e)return;const S=f&&h-f;return S?Math.round(v*1e3/S):void 0}}function Ag(n,e){let t=0,r=1e3/e,s,i;const a=(h,f=Date.now())=>{t=f,s=null,i&&(clearTimeout(i),i=null),n(...h)};return[(...h)=>{const f=Date.now(),m=f-t;m>=r?a(h,f):(s=h,i||(i=setTimeout(()=>{i=null,a(s)},r-m)))},()=>s&&a(s)]}const ei=(n,e,t=3)=>{let r=0;const s=xg(50,250);return Ag(i=>{const a=i.loaded,c=i.lengthComputable?i.total:void 0,u=a-r,h=s(u),f=a<=c;r=a;const m={loaded:a,total:c,progress:c?a/c:void 0,bytes:u,rate:h||void 0,estimated:h&&c&&f?(c-a)/h:void 0,event:i,lengthComputable:c!=null,[e?"download":"upload"]:!0};n(m)},t)},ml=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},gl=n=>(...e)=>N.asap(()=>n(...e)),Sg=Ye.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,Ye.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(Ye.origin),Ye.navigator&&/(msie|trident)/i.test(Ye.navigator.userAgent)):()=>!0,Rg=Ye.hasStandardBrowserEnv?{write(n,e,t,r,s,i,a){if(typeof document>"u")return;const c=[`${n}=${encodeURIComponent(e)}`];N.isNumber(t)&&c.push(`expires=${new Date(t).toUTCString()}`),N.isString(r)&&c.push(`path=${r}`),N.isString(s)&&c.push(`domain=${s}`),i===!0&&c.push("secure"),N.isString(a)&&c.push(`SameSite=${a}`),document.cookie=c.join("; ")},read(n){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+n+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(n){this.write(n,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Cg(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Pg(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Vh(n,e,t){let r=!Cg(e);return n&&(r||t==!1)?Pg(n,e):e}const yl=n=>n instanceof it?{...n}:n;function Tn(n,e){e=e||{};const t={};function r(h,f,m,v){return N.isPlainObject(h)&&N.isPlainObject(f)?N.merge.call({caseless:v},h,f):N.isPlainObject(f)?N.merge({},f):N.isArray(f)?f.slice():f}function s(h,f,m,v){if(N.isUndefined(f)){if(!N.isUndefined(h))return r(void 0,h,m,v)}else return r(h,f,m,v)}function i(h,f){if(!N.isUndefined(f))return r(void 0,f)}function a(h,f){if(N.isUndefined(f)){if(!N.isUndefined(h))return r(void 0,h)}else return r(void 0,f)}function c(h,f,m){if(m in e)return r(h,f);if(m in n)return r(void 0,h)}const u={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c,headers:(h,f,m)=>s(yl(h),yl(f),m,!0)};return N.forEach(Object.keys({...n,...e}),function(f){const m=u[f]||s,v=m(n[f],e[f],f);N.isUndefined(v)&&m!==c||(t[f]=v)}),t}const Mh=n=>{const e=Tn({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:a,auth:c}=e;if(e.headers=a=it.from(a),e.url=Ph(Vh(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),c&&a.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),N.isFormData(t)){if(Ye.hasStandardBrowserEnv||Ye.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(N.isFunction(t.getHeaders)){const u=t.getHeaders(),h=["content-type","content-length"];Object.entries(u).forEach(([f,m])=>{h.includes(f.toLowerCase())&&a.set(f,m)})}}if(Ye.hasStandardBrowserEnv&&(r&&N.isFunction(r)&&(r=r(e)),r||r!==!1&&Sg(e.url))){const u=s&&i&&Rg.read(i);u&&a.set(s,u)}return e},Ng=typeof XMLHttpRequest<"u",kg=Ng&&function(n){return new Promise(function(t,r){const s=Mh(n);let i=s.data;const a=it.from(s.headers).normalize();let{responseType:c,onUploadProgress:u,onDownloadProgress:h}=s,f,m,v,S,x;function C(){S&&S(),x&&x(),s.cancelToken&&s.cancelToken.unsubscribe(f),s.signal&&s.signal.removeEventListener("abort",f)}let A=new XMLHttpRequest;A.open(s.method.toUpperCase(),s.url,!0),A.timeout=s.timeout;function F(){if(!A)return;const D=it.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders()),$={data:!c||c==="text"||c==="json"?A.responseText:A.response,status:A.status,statusText:A.statusText,headers:D,config:n,request:A};Dh(function(E){t(E),C()},function(E){r(E),C()},$),A=null}"onloadend"in A?A.onloadend=F:A.onreadystatechange=function(){!A||A.readyState!==4||A.status===0&&!(A.responseURL&&A.responseURL.indexOf("file:")===0)||setTimeout(F)},A.onabort=function(){A&&(r(new Y("Request aborted",Y.ECONNABORTED,n,A)),A=null)},A.onerror=function(M){const $=M&&M.message?M.message:"Network Error",H=new Y($,Y.ERR_NETWORK,n,A);H.event=M||null,r(H),A=null},A.ontimeout=function(){let M=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const $=s.transitional||Nh;s.timeoutErrorMessage&&(M=s.timeoutErrorMessage),r(new Y(M,$.clarifyTimeoutError?Y.ETIMEDOUT:Y.ECONNABORTED,n,A)),A=null},i===void 0&&a.setContentType(null),"setRequestHeader"in A&&N.forEach(a.toJSON(),function(M,$){A.setRequestHeader($,M)}),N.isUndefined(s.withCredentials)||(A.withCredentials=!!s.withCredentials),c&&c!=="json"&&(A.responseType=s.responseType),h&&([v,x]=ei(h,!0),A.addEventListener("progress",v)),u&&A.upload&&([m,S]=ei(u),A.upload.addEventListener("progress",m),A.upload.addEventListener("loadend",S)),(s.cancelToken||s.signal)&&(f=D=>{A&&(r(!D||D.type?new ss(null,n,A):D),A.abort(),A=null)},s.cancelToken&&s.cancelToken.subscribe(f),s.signal&&(s.signal.aborted?f():s.signal.addEventListener("abort",f)));const j=Ig(s.url);if(j&&Ye.protocols.indexOf(j)===-1){r(new Y("Unsupported protocol "+j+":",Y.ERR_BAD_REQUEST,n));return}A.send(i||null)})},Og=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,s;const i=function(h){if(!s){s=!0,c();const f=h instanceof Error?h:this.reason;r.abort(f instanceof Y?f:new ss(f instanceof Error?f.message:f))}};let a=e&&setTimeout(()=>{a=null,i(new Y(`timeout of ${e}ms exceeded`,Y.ETIMEDOUT))},e);const c=()=>{n&&(a&&clearTimeout(a),a=null,n.forEach(h=>{h.unsubscribe?h.unsubscribe(i):h.removeEventListener("abort",i)}),n=null)};n.forEach(h=>h.addEventListener("abort",i));const{signal:u}=r;return u.unsubscribe=()=>N.asap(c),u}},Dg=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,s;for(;r<t;)s=r+e,yield n.slice(r,s),r=s},Vg=async function*(n,e){for await(const t of Mg(n))yield*Dg(t,e)},Mg=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},_l=(n,e,t,r)=>{const s=Vg(n,e);let i=0,a,c=u=>{a||(a=!0,r&&r(u))};return new ReadableStream({async pull(u){try{const{done:h,value:f}=await s.next();if(h){c(),u.close();return}let m=f.byteLength;if(t){let v=i+=m;t(v)}u.enqueue(new Uint8Array(f))}catch(h){throw c(h),h}},cancel(u){return c(u),s.return()}},{highWaterMark:2})},vl=64*1024,{isFunction:Ps}=N,Fg=(({Request:n,Response:e})=>({Request:n,Response:e}))(N.global),{ReadableStream:wl,TextEncoder:bl}=N.global,El=(n,...e)=>{try{return!!n(...e)}catch{return!1}},Lg=n=>{n=N.merge.call({skipUndefined:!0},Fg,n);const{fetch:e,Request:t,Response:r}=n,s=e?Ps(e):typeof fetch=="function",i=Ps(t),a=Ps(r);if(!s)return!1;const c=s&&Ps(wl),u=s&&(typeof bl=="function"?(x=>C=>x.encode(C))(new bl):async x=>new Uint8Array(await new t(x).arrayBuffer())),h=i&&c&&El(()=>{let x=!1;const C=new t(Ye.origin,{body:new wl,method:"POST",get duplex(){return x=!0,"half"}}).headers.has("Content-Type");return x&&!C}),f=a&&c&&El(()=>N.isReadableStream(new r("").body)),m={stream:f&&(x=>x.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(x=>{!m[x]&&(m[x]=(C,A)=>{let F=C&&C[x];if(F)return F.call(C);throw new Y(`Response type '${x}' is not supported`,Y.ERR_NOT_SUPPORT,A)})});const v=async x=>{if(x==null)return 0;if(N.isBlob(x))return x.size;if(N.isSpecCompliantForm(x))return(await new t(Ye.origin,{method:"POST",body:x}).arrayBuffer()).byteLength;if(N.isArrayBufferView(x)||N.isArrayBuffer(x))return x.byteLength;if(N.isURLSearchParams(x)&&(x=x+""),N.isString(x))return(await u(x)).byteLength},S=async(x,C)=>{const A=N.toFiniteNumber(x.getContentLength());return A??v(C)};return async x=>{let{url:C,method:A,data:F,signal:j,cancelToken:D,timeout:M,onDownloadProgress:$,onUploadProgress:H,responseType:E,headers:_,withCredentials:y="same-origin",fetchOptions:T}=Mh(x),b=e||fetch;E=E?(E+"").toLowerCase():"text";let I=Og([j,D&&D.toAbortSignal()],M),w=null;const k=I&&I.unsubscribe&&(()=>{I.unsubscribe()});let Q;try{if(H&&h&&A!=="get"&&A!=="head"&&(Q=await S(_,F))!==0){let Oe=new t(C,{method:"POST",body:F,duplex:"half"}),ne;if(N.isFormData(F)&&(ne=Oe.headers.get("content-type"))&&_.setContentType(ne),Oe.body){const[B,me]=ml(Q,ei(gl(H)));F=_l(Oe.body,vl,B,me)}}N.isString(y)||(y=y?"include":"omit");const oe=i&&"credentials"in t.prototype,Le={...T,signal:I,method:A.toUpperCase(),headers:_.normalize().toJSON(),body:F,duplex:"half",credentials:oe?y:void 0};w=i&&new t(C,Le);let G=await(i?b(w,T):b(C,Le));const be=f&&(E==="stream"||E==="response");if(f&&($||be&&k)){const Oe={};["status","statusText","headers"].forEach(ae=>{Oe[ae]=G[ae]});const ne=N.toFiniteNumber(G.headers.get("content-length")),[B,me]=$&&ml(ne,ei(gl($),!0))||[];G=new r(_l(G.body,vl,B,()=>{me&&me(),k&&k()}),Oe)}E=E||"text";let At=await m[N.findKey(m,E)||"text"](G,x);return!be&&k&&k(),await new Promise((Oe,ne)=>{Dh(Oe,ne,{data:At,headers:it.from(G.headers),status:G.status,statusText:G.statusText,config:x,request:w})})}catch(oe){throw k&&k(),oe&&oe.name==="TypeError"&&/Load failed|fetch/i.test(oe.message)?Object.assign(new Y("Network Error",Y.ERR_NETWORK,x,w),{cause:oe.cause||oe}):Y.from(oe,oe&&oe.code,x,w)}}},jg=new Map,Fh=n=>{let e=n&&n.env||{};const{fetch:t,Request:r,Response:s}=e,i=[r,s,t];let a=i.length,c=a,u,h,f=jg;for(;c--;)u=i[c],h=f.get(u),h===void 0&&f.set(u,h=c?new Map:Lg(e)),f=h;return h};Fh();const ga={http:ng,xhr:kg,fetch:{get:Fh}};N.forEach(ga,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Tl=n=>`- ${n}`,Ug=n=>N.isFunction(n)||n===null||n===!1;function Bg(n,e){n=N.isArray(n)?n:[n];const{length:t}=n;let r,s;const i={};for(let a=0;a<t;a++){r=n[a];let c;if(s=r,!Ug(r)&&(s=ga[(c=String(r)).toLowerCase()],s===void 0))throw new Y(`Unknown adapter '${c}'`);if(s&&(N.isFunction(s)||(s=s.get(e))))break;i[c||"#"+a]=s}if(!s){const a=Object.entries(i).map(([u,h])=>`adapter ${u} `+(h===!1?"is not supported by the environment":"is not available in the build"));let c=t?a.length>1?`since :
`+a.map(Tl).join(`
`):" "+Tl(a[0]):"as no adapter specified";throw new Y("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return s}const Lh={getAdapter:Bg,adapters:ga};function oo(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new ss(null,n)}function Il(n){return oo(n),n.headers=it.from(n.headers),n.data=io.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Lh.getAdapter(n.adapter||rs.adapter,n)(n).then(function(r){return oo(n),r.data=io.call(n,n.transformResponse,r),r.headers=it.from(r.headers),r},function(r){return Oh(r)||(oo(n),r&&r.response&&(r.response.data=io.call(n,n.transformResponse,r.response),r.response.headers=it.from(r.response.headers))),Promise.reject(r)})}const jh="1.13.4",Ti={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Ti[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const xl={};Ti.transitional=function(e,t,r){function s(i,a){return"[Axios v"+jh+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return(i,a,c)=>{if(e===!1)throw new Y(s(a," has been removed"+(t?" in "+t:"")),Y.ERR_DEPRECATED);return t&&!xl[a]&&(xl[a]=!0,console.warn(s(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,c):!0}};Ti.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function $g(n,e,t){if(typeof n!="object")throw new Y("options must be an object",Y.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let s=r.length;for(;s-- >0;){const i=r[s],a=e[i];if(a){const c=n[i],u=c===void 0||a(c,i,n);if(u!==!0)throw new Y("option "+i+" must be "+u,Y.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Y("Unknown option "+i,Y.ERR_BAD_OPTION)}}const Bs={assertOptions:$g,validators:Ti},gt=Bs.validators;let _n=class{constructor(e){this.defaults=e||{},this.interceptors={request:new fl,response:new fl}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Tn(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:i}=t;r!==void 0&&Bs.assertOptions(r,{silentJSONParsing:gt.transitional(gt.boolean),forcedJSONParsing:gt.transitional(gt.boolean),clarifyTimeoutError:gt.transitional(gt.boolean)},!1),s!=null&&(N.isFunction(s)?t.paramsSerializer={serialize:s}:Bs.assertOptions(s,{encode:gt.function,serialize:gt.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Bs.assertOptions(t,{baseUrl:gt.spelling("baseURL"),withXsrfToken:gt.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&N.merge(i.common,i[t.method]);i&&N.forEach(["delete","get","head","post","put","patch","common"],x=>{delete i[x]}),t.headers=it.concat(a,i);const c=[];let u=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(t)===!1||(u=u&&C.synchronous,c.unshift(C.fulfilled,C.rejected))});const h=[];this.interceptors.response.forEach(function(C){h.push(C.fulfilled,C.rejected)});let f,m=0,v;if(!u){const x=[Il.bind(this),void 0];for(x.unshift(...c),x.push(...h),v=x.length,f=Promise.resolve(t);m<v;)f=f.then(x[m++],x[m++]);return f}v=c.length;let S=t;for(;m<v;){const x=c[m++],C=c[m++];try{S=x(S)}catch(A){C.call(this,A);break}}try{f=Il.call(this,S)}catch(x){return Promise.reject(x)}for(m=0,v=h.length;m<v;)f=f.then(h[m++],h[m++]);return f}getUri(e){e=Tn(this.defaults,e);const t=Vh(e.baseURL,e.url,e.allowAbsoluteUrls);return Ph(t,e.params,e.paramsSerializer)}};N.forEach(["delete","get","head","options"],function(e){_n.prototype[e]=function(t,r){return this.request(Tn(r||{},{method:e,url:t,data:(r||{}).data}))}});N.forEach(["post","put","patch"],function(e){function t(r){return function(i,a,c){return this.request(Tn(c||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}_n.prototype[e]=t(),_n.prototype[e+"Form"]=t(!0)});let qg=class Uh{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const a=new Promise(c=>{r.subscribe(c),i=c}).then(s);return a.cancel=function(){r.unsubscribe(i)},a},e(function(i,a,c){r.reason||(r.reason=new ss(i,a,c),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Uh(function(s){e=s}),cancel:e}}};function zg(n){return function(t){return n.apply(null,t)}}function Hg(n){return N.isObject(n)&&n.isAxiosError===!0}const Do={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Do).forEach(([n,e])=>{Do[e]=n});function Bh(n){const e=new _n(n),t=vh(_n.prototype.request,e);return N.extend(t,_n.prototype,e,{allOwnKeys:!0}),N.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return Bh(Tn(n,s))},t}const Ne=Bh(rs);Ne.Axios=_n;Ne.CanceledError=ss;Ne.CancelToken=qg;Ne.isCancel=Oh;Ne.VERSION=jh;Ne.toFormData=Ei;Ne.AxiosError=Y;Ne.Cancel=Ne.CanceledError;Ne.all=function(e){return Promise.all(e)};Ne.spread=zg;Ne.isAxiosError=Hg;Ne.mergeConfig=Tn;Ne.AxiosHeaders=it;Ne.formToJSON=n=>kh(N.isHTMLForm(n)?new FormData(n):n);Ne.getAdapter=Lh.getAdapter;Ne.HttpStatusCode=Do;Ne.default=Ne;const{Axios:YT,AxiosError:XT,CanceledError:ZT,isCancel:eI,CancelToken:tI,VERSION:nI,all:rI,Cancel:sI,isAxiosError:iI,spread:oI,toFormData:aI,AxiosHeaders:cI,HttpStatusCode:lI,formToJSON:uI,getAdapter:hI,mergeConfig:dI}=Ne;function Gg(n,e){const t=n.length,r=e/255*(t-1),s=Math.floor(r),i=Math.min(s+1,t-1),a=r-s;return[Math.round(n[s][0]+a*(n[i][0]-n[s][0])),Math.round(n[s][1]+a*(n[i][1]-n[s][1])),Math.round(n[s][2]+a*(n[i][2]-n[s][2]))]}function Vn(n){return Array.from({length:256},(e,t)=>[...Gg(n,t)])}const Al={white_hot:Array.from({length:256},(n,e)=>[e,e,e]),black_hot:Array.from({length:256},(n,e)=>[255-e,255-e,255-e]),hot_iron:Vn([[0,0,0],[51,0,102],[102,0,153],[153,0,102],[204,51,0],[255,102,0],[255,204,51],[255,255,255]]),iron_red:Vn([[0,0,10],[30,10,60],[75,8,104],[125,17,119],[174,30,84],[217,50,22],[245,109,0],[255,169,0],[255,229,102],[255,255,255]]),fulgurite:Vn([[51,0,0],[102,0,0],[153,51,0],[204,102,0],[255,153,51],[255,204,102],[255,255,153],[255,255,255]]),medical:Vn([[0,0,51],[51,0,102],[102,0,153],[153,0,204],[204,0,255],[255,102,255],[255,204,255],[255,255,255]]),arctic:Vn([[0,0,102],[0,51,204],[0,153,255],[102,204,255],[204,255,255],[255,255,255]]),rainbow:Vn([[0,0,255],[0,255,255],[0,255,0],[255,255,0],[255,0,0]]),tint:(()=>{const n=[];for(let e=0;e<256;e++)if(e<200){const t=Math.round(e/200*180);n.push([t,t,t])}else{const t=(e-200)/55;n.push([Math.round(180+t*75),Math.round(180*(1-t*.8)),Math.round(180*(1-t*.8))])}return n})()},Sl=new Map;async function Cn(n,e){const t=Sl.get(n);if(t)return t;const r=`${e}/thermal/${n}.bin.gz`,s=await fetch(r);if(!s.ok)throw new Error(`Failed to load thermal data: ${s.status}`);const i=await s.blob(),a=new DecompressionStream("gzip"),u=i.stream().pipeThrough(a).getReader(),h=[];let f=0;for(;;){const{done:_,value:y}=await u.read();if(_)break;h.push(y),f+=y.byteLength}const m=new Uint8Array(f);let v=0;for(const _ of h)m.set(_,v),v+=_.byteLength;const S=new Float32Array(m.buffer),x=S.length;let C=640,A=512;const F=[[512,640],[256,336],[480,640],[384,512]];for(const[_,y]of F)if(_*y===x){C=y,A=_;break}let j=1/0,D=-1/0,M=0;for(let _=0;_<S.length;_++){const y=S[_];y<j&&(j=y),y>D&&(D=y),M+=y}const $=M/S.length,E={data:S,width:C,height:A,stats:{minTemp:j,maxTemp:D,meanTemp:$,width:C,height:A}};return Sl.set(n,E),E}function Ii(n,e,t,r){const{data:s,width:i,height:a}=n,c=new ImageData(i,a),u=Al[e]||Al.hot_iron,h=r-t;for(let f=0;f<s.length;f++){const m=Math.max(0,Math.min(1,(s[f]-t)/(h+1e-6))),v=Math.round(m*255),[S,x,C]=u[v],A=f*4;c.data[A]=S,c.data[A+1]=x,c.data[A+2]=C,c.data[A+3]=255}return c}function $s(n,e,t){const r=t*n.width+e,s=n.data[r],i=(s-32)*5/9;return{tempFahrenheit:s,tempCelsius:i}}function Wg(n){const{data:e,width:t,height:r}=n,s=[];s.push(`# Thermal data (Fahrenheit), ${t}x${r}`),s.push(Array.from({length:t},(i,a)=>`col_${a}`).join(","));for(let i=0;i<r;i++){const a=[];for(let c=0;c<t;c++)a.push(e[i*t+c].toFixed(2));s.push(a.join(","))}return s.join(`
`)}const Kg="/thermal-viewer-web/data";let Ge=Kg;function Rl(n){Ge=n,Dr=null}let Dr=null;async function or(){if(Dr)return Dr;const n=`${Ge}/manifest.json`,e=await fetch(n);if(!e.ok)throw new Error(`Failed to load manifest: ${e.status} from ${n}`);return Dr=await e.json(),Dr}function Qg(n){return{id:n.id,thermalPath:`${Ge}/thermal/${n.id}.bin.gz`,visiblePath:n.hasVisible?`${Ge}/visible/${n.id}.jpg`:"",thermalTiffPath:"",timestamp:n.timestamp,flightGroup:n.flightGroup,filename:n.filename,gps:n.gps,gimbalYaw:n.gimbalYaw,gimbalPitch:n.gimbalPitch,relativeAltitude:n.relativeAltitude}}async function Jg(){const n=await or();return{images:n.images.map(Qg),totalCount:n.totalCount,flightGroups:n.flightGroups,photoGroups:n.photoGroups}}async function Yg(n){const t=(await or()).images.find(s=>s.id===n);return t?t.stats:(await Cn(n,Ge)).stats}function Xg(n){return`${Ge}/visible/${n}.jpg`}function Zg(n,e,t,r){return`${Ge}/visible/${n}.jpg`}async function ey(n){return Cn(n,Ge)}async function ty(n,e,t){const r=await Cn(n,Ge),{tempCelsius:s,tempFahrenheit:i}=$s(r,e,t);return{x:e,y:t,tempCelsius:s,tempFahrenheit:i}}async function ny(n){const e=await Cn(n,Ge),t=Wg(e);return new Blob([t],{type:"text/csv"})}function ya(n,e,t,r){const s=Ii(n,e,t,r),i=document.createElement("canvas");return i.width=n.width,i.height=n.height,i.getContext("2d").putImageData(s,0,0),i}function ry(n,e,t,r,s,i,a,c){const u=c-30,h={data:new Float32Array(Array.from({length:256},(v,S)=>t+S/255*(r-t))),width:256,height:1},f=Ii(h,e,t,r),m=document.createElement("canvas");m.width=256,m.height=1,m.getContext("2d").putImageData(f,0,0),n.save(),n.translate(s,i+u),n.rotate(-Math.PI/2),n.drawImage(m,0,0,256,1,0,0,u,a),n.restore(),n.fillStyle="#ffffff",n.font="bold 11px sans-serif",n.textAlign="center",n.fillText(`${r.toFixed(1)}F`,s+a/2,i-2),n.fillText(`${t.toFixed(1)}F`,s+a/2,i+c)}function $h(n,e,t,r,s){e.forEach(i=>{const a=r+i.x*t,c=s+i.y*t;n.strokeStyle="#ffff00",n.lineWidth=2,n.beginPath(),n.moveTo(a-8,c),n.lineTo(a+8,c),n.moveTo(a,c-8),n.lineTo(a,c+8),n.stroke();const u=`${i.tempF.toFixed(1)}F`;n.font="bold 11px sans-serif";const h=n.measureText(u).width;n.fillStyle="rgba(0,0,0,0.8)",n.fillRect(a+6,c-8,h+6,16),n.fillStyle="#ffff00",n.fillText(u,a+9,c+4)})}async function sy(n,e){const t=await Cn(n,Ge),r=e.colormap||"hot_iron",s=e.minTemp??t.stats.minTemp,i=e.maxTemp??t.stats.maxTemp,a=ya(t,r,s,i),c=50,u=10,h=t.width+c+u,f=t.height,m=document.createElement("canvas");m.width=h,m.height=f;const v=m.getContext("2d");return v.fillStyle="#0a0a0a",v.fillRect(0,0,h,f),v.drawImage(a,0,0),ry(v,r,s,i,t.width+u,20,30,f-40),e.includeAnnotations&&e.markers&&e.markers.length>0&&$h(v,e.markers,1,0,0),new Promise((S,x)=>{m.toBlob(C=>C?S(C):x(new Error("Canvas export failed")),"image/png")})}function qh(n){return new Promise((e,t)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>e(r),r.onerror=t,r.src=n})}async function iy(n,e){const t=(await ca(async()=>{const{default:M}=await import("./gif-CuT8qcG1.js").then($=>$.g);return{default:M}},__vite__mapDeps([0,1,2]))).default,r=await Cn(n,Ge),s=e.colormap||"hot_iron",i=e.minTemp??r.stats.minTemp,a=e.maxTemp??r.stats.maxTemp,c=Math.min(e.fps,10),u=12,h=ya(r,s,i,a),f=Math.round(r.width/2),m=Math.round(r.height/2),v=`${Ge}/visible/${n}.jpg`;let S=null;try{S=await qh(v)}catch{}const x=new t({workers:2,quality:15,width:f,height:m,workerScript:"/thermal-viewer-web/gif.worker.js"}),C=document.createElement("canvas");C.width=f,C.height=m;const A=C.getContext("2d"),F=[];for(let M=0;M<u;M++){const $=M/(u-1);A.clearRect(0,0,f,m),S?(A.globalAlpha=1,A.drawImage(S,0,0,f,m),A.globalAlpha=$,A.drawImage(h,0,0,f,m),A.globalAlpha=1):A.drawImage(h,0,0,f,m),F.push(A.getImageData(0,0,f,m))}const j=Math.round(1e3/c),D=500;A.putImageData(F[0],0,0),x.addFrame(A,{copy:!0,delay:D});for(let M=1;M<u;M++)A.putImageData(F[M],0,0),x.addFrame(A,{copy:!0,delay:j});A.putImageData(F[u-1],0,0),x.addFrame(A,{copy:!0,delay:D});for(let M=u-2;M>0;M--)A.putImageData(F[M],0,0),x.addFrame(A,{copy:!0,delay:j});return new Promise(M=>{x.on("finished",$=>M($)),x.render()})}async function oy(n){const{jsPDF:e}=await ca(async()=>{const{jsPDF:a}=await import("./jspdf.es.min-DW0aJyem.js").then(c=>c.j);return{jsPDF:a}},__vite__mapDeps([3,1,2])),t=await or(),r=new e({orientation:"landscape",unit:"mm",format:"letter"}),s=r.internal.pageSize.getWidth(),i=r.internal.pageSize.getHeight();for(let a=0;a<n.images.length;a++){const c=n.images[a];a>0&&r.addPage("letter","landscape");const u=await Cn(c.imageId,Ge),h=t.images.find(E=>E.id===c.imageId),f=c.colormap||"hot_iron",m=c.minTemp??u.stats.minTemp,v=c.maxTemp??u.stats.maxTemp;r.setFillColor(26,26,26),r.rect(0,0,s,i,"F"),r.setFontSize(16),r.setTextColor(255,102,0),r.text("AR Drone Ops  Thermal Inspection Report",10,12),r.setFontSize(9),r.setTextColor(180,180,180),r.text(`Image: ${h?.filename||c.imageId}`,10,19),r.text(`Date: ${h?.timestamp?new Date(h.timestamp).toLocaleString():"N/A"}`,10,24);let S=29;if(h?.gps&&(r.text(`GPS: ${h.gps.lat.toFixed(6)}, ${h.gps.lon.toFixed(6)}`,10,S),S+=5),h?.gimbalYaw!=null){const _=["N","NE","E","SE","S","SW","W","NW"][Math.round((h.gimbalYaw%360+360)%360/45)%8];r.text(`Direction: ${_} (${h.gimbalYaw.toFixed(0)})`,10,S),S+=5}h?.relativeAltitude!=null&&(r.text(`Altitude: ${(h.relativeAltitude*3.281).toFixed(0)} ft`,10,S),S+=5),r.setTextColor(255,102,0),r.text("Temperature Statistics:",10,S+2),r.setTextColor(200,200,200),S+=7,r.text(`Min: ${u.stats.minTemp.toFixed(1)}F`,10,S),r.text(`Max: ${u.stats.maxTemp.toFixed(1)}F`,50,S),r.text(`Mean: ${u.stats.meanTemp.toFixed(1)}F`,90,S);const x=ya(u,f,m,v);if(c.markers&&c.markers.length>0){const E=x.getContext("2d");$h(E,c.markers,1,0,0)}const C=x.toDataURL("image/jpeg",.92),A=S+8,F=i-A-8,j=u.width/u.height;let D,M;const $=n.sideBySide&&h?.hasVisible,H=$?(s-30)/2:s-20;if(j>H/F?(D=H,M=D/j):(M=F,D=M*j),r.addImage(C,"JPEG",10,A,D,M),$)try{const E=await qh(`${Ge}/visible/${c.imageId}.jpg`),_=document.createElement("canvas");_.width=E.width,_.height=E.height,_.getContext("2d").drawImage(E,0,0);const y=_.toDataURL("image/jpeg",.92);r.addImage(y,"JPEG",10+D+10,A,D,M)}catch{}{const E=s-18,_=A,y=6,T=M,b=50;for(let I=0;I<b;I++){const w=I/b,k=v-w*(v-m),Q={data:new Float32Array([k]),width:1,height:1},oe=Ii(Q,f,m,v);r.setFillColor(oe.data[0],oe.data[1],oe.data[2]),r.rect(E,_+w*T,y,T/b+.5,"F")}r.setFontSize(7),r.setTextColor(255,255,255),r.text(`${v.toFixed(1)}F`,E,_-1),r.text(`${m.toFixed(1)}F`,E,_+T+4)}r.setFontSize(7),r.setTextColor(100,100,100),r.text("Generated by AR Drone Ops Thermal Viewer",10,i-3),r.text(`Page ${a+1} of ${n.images.length}`,s-40,i-3)}return r.output("blob")}async function ay(){return(await or()).mapData??null}async function cy(){const n=await or();return n.model3D?{...n.model3D,url:`${Ge}/${n.model3D.url}`}:null}async function ly(){const n=await or();return n.orthophoto?{...n.orthophoto,url:`${Ge}/${n.orthophoto.url}`}:null}const ao=!0,uy="/api";Ne.create({baseURL:uy,timeout:3e4});async function hy(n){return Jg()}async function dy(n){return Yg(n)}function fy(n,e=2,t=0,r=0){return Zg(n)}function zh(n){return Xg(n)}async function co(n,e,t){return ty(n,e,t)}async function py(n,e){return sy(n,e)}async function my(n,e){return iy(n,e)}async function gy(n){return ny(n)}async function yy(n){return oy(n)}async function _y(){return ay()}async function vy(){return cy()}async function wy(){return ly()}function qs(n,e){const t=URL.createObjectURL(n),r=document.createElement("a");r.href=t,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}let Ns=null,Cl=null;const Lr="/thermal-viewer-web/data";async function by(n){if(Ns&&Cl===(n??null))return Ns;let e;if(n?(e=await fetch(`${Lr}/projects/${n}/project.json`),e.ok||(e=await fetch(`${Lr}/project.json`))):e=await fetch(`${Lr}/project.json`),!e.ok)throw new Error(`Failed to load project config: ${e.status}`);return Ns=await e.json(),Cl=n??null,Ns}function Ey(n){return`${Lr}/buildings/${n}`}function Ty(n){return`${Lr}/projects/${n}`}function Hh({isOpen:n,onClose:e,selectedImages:t,imageSettings:r}){const{colormap:s,displayMinTemp:i,displayMaxTemp:a,markers:c}=St(),[u,h]=L.useState(!1),[f,m]=L.useState(!1),[v,S]=L.useState(null);if(!n)return null;const x=async()=>{if(t.length!==0){m(!0),S(null);try{const A=t.map(D=>{const M=r?.get(D.id),H=(M?.markers||c).map(E=>({x:E.x,y:E.y,tempF:E.tempFahrenheit??E.tempF??0}));return{imageId:D.id,colormap:M?.colormap||s,minTemp:M?.minTemp??i,maxTemp:M?.maxTemp??a,markers:H}}),F=await yy({images:A,sideBySide:u,includeMetadata:!0,includeColorbar:!0}),j=t.length===1?`${t[0].filename.replace(/\.(tiff|jpg|JPG)$/i,"")}_report.pdf`:`thermal_report_${t.length}_images.pdf`;qs(F,j),e()}catch(A){console.error("PDF export failed:",A),S(A instanceof Error?A.message:"PDF export failed")}finally{m(!1)}}},C=t.some(A=>A.visiblePath);return p.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",children:p.jsxs("div",{className:"bg-[#2d2d2d] rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl border border-[#444]",children:[p.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-[#444]",children:[p.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[p.jsx("span",{className:"text-2xl",children:""}),"Export PDF Report"]}),p.jsx("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white hover:bg-[#444] rounded-lg transition-all",children:""})]}),p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-3",children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("span",{className:"text-sm text-gray-400",children:"Selected Images"}),p.jsx("span",{className:"text-[#ff6600] font-bold",children:t.length})]}),t.length<=4?p.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(A=>p.jsx("span",{className:"text-xs bg-[#333] text-gray-300 px-2 py-1 rounded truncate max-w-[120px]",title:A.filename,children:A.filename.replace(/\.(tiff|jpg|JPG)$/i,"")},A.id))}):p.jsxs("p",{className:"text-xs text-gray-500",children:[t[0].filename.replace(/\.(tiff|jpg|JPG)$/i,"")," and ",t.length-1," more..."]})]}),p.jsx("div",{className:"space-y-3",children:p.jsxs("label",{className:"flex items-center gap-3 p-3 bg-[#1a1a1a] rounded-lg cursor-pointer hover:bg-[#222] transition-colors",children:[p.jsx("input",{type:"checkbox",checked:u,onChange:A=>h(A.target.checked),disabled:!C,className:"w-5 h-5 rounded accent-[#ff6600]"}),p.jsxs("div",{className:"flex-1",children:[p.jsx("span",{className:"text-white text-sm font-medium",children:"Side-by-side with visible"}),p.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:C?"Show thermal and visible images next to each other":"No visible images available for selected images"})]})]})}),p.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-3 space-y-2",children:[p.jsx("span",{className:"text-sm text-gray-400",children:"Report includes:"}),p.jsxs("ul",{className:"text-xs text-gray-500 space-y-1 ml-4",children:[p.jsx("li",{children:" AR Drone Ops branding"}),p.jsx("li",{children:" Your colormap, temperature range, and markers"}),p.jsx("li",{children:" GPS coordinates, direction, altitude"}),p.jsx("li",{children:" Per-image temperature statistics (min/max/mean)"}),p.jsx("li",{children:" Temperature colorbar"})]})]}),v&&p.jsx("div",{className:"bg-red-600/20 border border-red-600/50 text-red-400 text-sm rounded-lg p-3",children:v})]}),p.jsxs("div",{className:"flex gap-3 p-4 border-t border-[#444]",children:[p.jsx("button",{onClick:e,className:"flex-1 py-3 text-sm bg-[#3d3d3d] hover:bg-[#4d4d4d] text-white rounded-lg transition-all font-medium",children:"Cancel"}),p.jsx("button",{onClick:x,disabled:f||t.length===0,className:"flex-1 py-3 text-sm bg-[#ff6600] hover:bg-[#ff8833] disabled:bg-[#555] disabled:text-gray-500 text-white rounded-lg transition-all font-medium",children:f?p.jsxs("span",{className:"flex items-center justify-center gap-2",children:[p.jsxs("svg",{className:"animate-spin w-4 h-4",viewBox:"0 0 24 24",children:[p.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),p.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating PDF..."]}):`Export ${t.length} Image${t.length>1?"s":""}`})]})]})})}const Pl=new Map;function Iy({yaw:n,isRoof:e}){return e?p.jsxs("svg",{className:"w-5 h-5 text-[#ff6600]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[p.jsx("circle",{cx:"12",cy:"12",r:"10"}),p.jsx("path",{d:"M12 8v8M8 12l4 4 4-4"})]}):p.jsxs("svg",{className:"w-5 h-5 text-[#ff6600]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{transform:`rotate(${n}deg)`},children:[p.jsx("circle",{cx:"12",cy:"12",r:"10"}),p.jsx("path",{d:"M12 8v8M8 12l4-4 4 4",fill:"currentColor"})]})}function Nl({image:n,isSelected:e,isSelectionMode:t,isChecked:r,onClick:s,onToggleSelect:i}){const a=()=>{t?i():s()};return p.jsxs("button",{onClick:a,className:`thumbnail-card relative rounded overflow-hidden border-2 transition-all ${t&&r?"border-[#0066cc] ring-1 ring-[#0066cc]/50":e?"selected border-[#ff6600] ring-1 ring-[#ff6600]/50":"border-transparent hover:border-[#555]"}`,children:[p.jsx("img",{src:zh(n.id),alt:n.filename,className:"w-full h-20 object-cover bg-[#1a1a1a]",loading:"lazy"}),t&&p.jsx("div",{className:"absolute top-1 left-1",children:p.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-all ${r?"bg-[#0066cc] border-[#0066cc]":"bg-black/50 border-white/60"}`,children:r&&p.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:p.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})}),p.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 px-1 py-0.5",children:p.jsxs("span",{className:"text-[10px] text-white",children:["#",n.filename.match(/_(\d+)_T/)?.[1]||""]})})]})}function xy({images:n,flightGroups:e,photoGroups:t,isLoading:r}){const{currentImage:s,setCurrentImage:i,clearMarkers:a}=St(),[c,u]=L.useState("area"),[h,f]=L.useState(0),[m,v]=L.useState(!1),[S,x]=L.useState(new Set),[C,A]=L.useState(!1),F=y=>{x(T=>{const b=new Set(T);return b.has(y)?b.delete(y):b.add(y),b})},j=()=>{x(new Set(n.map(y=>y.id)))},D=()=>{x(new Set)},M=()=>{v(!1),x(new Set)},$=L.useMemo(()=>n.filter(y=>S.has(y.id)),[n,S]);L.useEffect(()=>{if(n.length===0)return;let y=!1;return(async()=>{for(let I=0;I<n.length&&!y;I+=6){const w=n.slice(I,I+6);await Promise.all(w.map(k=>Pl.has(k.id)?Promise.resolve():new Promise(Q=>{const oe=new Image;oe.onload=()=>{Pl.set(k.id,oe),Q()},oe.onerror=()=>Q(),oe.src=zh(k.id)}))),y||f(Math.min(100,Math.round((I+6)/n.length*100)))}})(),()=>{y=!0}},[n]);const H=L.useMemo(()=>{const y={};for(const T of n)y[T.id]=T;return y},[n]),E=L.useMemo(()=>{const y={};for(const T of n)y[T.flightGroup]||(y[T.flightGroup]=[]),y[T.flightGroup].push(T);return y},[n]),_=y=>{a(),i(y)};return r?p.jsx("div",{className:"p-4 h-full flex items-center justify-center",children:p.jsx("div",{className:"spinner"})}):p.jsxs("div",{className:"h-full flex flex-col",children:[p.jsxs("div",{className:"p-4 border-b border-[#444]",children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("h2",{className:"text-lg font-bold text-[#ff6600]",children:"Images"}),p.jsx("button",{onClick:()=>m?M():v(!0),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${m?"bg-[#0066cc] text-white":"bg-[#3d3d3d] text-gray-300 hover:bg-[#4d4d4d]"}`,children:m?"Cancel":"Select"})]}),p.jsx("p",{className:"text-sm text-gray-400 mb-3",children:m?p.jsxs("span",{className:"text-[#0066cc]",children:[S.size," selected for PDF export"]}):p.jsxs(p.Fragment,{children:[n.length," thermal images",h<100&&p.jsxs("span",{className:"text-[#ff6600] ml-2",children:["(",h,"% cached)"]})]})}),m?p.jsxs("div",{className:"flex gap-2",children:[p.jsx("button",{onClick:j,className:"flex-1 px-3 py-1.5 text-xs font-medium rounded-lg bg-[#1a1a1a] text-gray-300 hover:bg-[#333] transition-all",children:"Select All"}),p.jsx("button",{onClick:D,disabled:S.size===0,className:"flex-1 px-3 py-1.5 text-xs font-medium rounded-lg bg-[#1a1a1a] text-gray-300 hover:bg-[#333] disabled:opacity-50 transition-all",children:"Clear"})]}):p.jsxs("div",{className:"flex gap-1 bg-[#1a1a1a] p-1 rounded-lg",children:[p.jsx("button",{onClick:()=>u("area"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-all ${c==="area"?"bg-[#ff6600] text-white shadow-sm":"text-gray-400 hover:text-white hover:bg-[#333]"}`,children:"By Area"}),p.jsx("button",{onClick:()=>u("flight"),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-all ${c==="flight"?"bg-[#ff6600] text-white shadow-sm":"text-gray-400 hover:text-white hover:bg-[#333]"}`,children:"By Flight"})]})]}),p.jsx("div",{className:"flex-1 overflow-y-auto sidebar-scroll p-2",children:c==="area"?p.jsx(p.Fragment,{children:t.length>0?t.map(y=>p.jsxs("div",{className:"mb-4",children:[p.jsxs("div",{className:"px-2 py-1 mb-2 flex items-center gap-2",children:[p.jsx(Iy,{yaw:y.dominantYaw,isRoof:y.isRoofView}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-sm font-semibold text-white",children:y.name}),p.jsxs("p",{className:"text-xs text-gray-500",children:[y.imageIds.length," image",y.imageIds.length!==1?"s":""]})]})]}),p.jsx("div",{className:"grid grid-cols-2 gap-2",children:y.imageIds.map(T=>{const b=H[T];return b?p.jsx(Nl,{image:b,isSelected:s?.id===T,isSelectionMode:m,isChecked:S.has(T),onClick:()=>_(b),onToggleSelect:()=>F(T)},T):null})})]},y.id)):p.jsxs("div",{className:"text-center py-8 text-gray-500",children:[p.jsx("p",{children:"No photo groups found"}),p.jsx("p",{className:"text-xs mt-1",children:'Try switching to "By Flight" view'})]})}):e.map(y=>p.jsxs("div",{className:"mb-4",children:[p.jsxs("div",{className:"px-2 py-1 mb-2",children:[p.jsx("h3",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider",children:y.replace("DJI_","Flight ")}),p.jsxs("p",{className:"text-xs text-gray-500",children:[E[y]?.length||0," images"]})]}),p.jsx("div",{className:"grid grid-cols-2 gap-2",children:E[y]?.map(T=>p.jsx(Nl,{image:T,isSelected:s?.id===T.id,isSelectionMode:m,isChecked:S.has(T.id),onClick:()=>_(T),onToggleSelect:()=>F(T.id)},T.id))})]},y))}),p.jsx("div",{className:"p-3 border-t border-[#444] bg-[#252525]",children:m?p.jsx("button",{onClick:()=>A(!0),disabled:S.size===0,className:"w-full py-2.5 text-sm font-medium rounded-lg transition-all bg-[#0066cc] hover:bg-[#0077ee] disabled:bg-[#333] disabled:text-gray-500 text-white",children:S.size>0?`Export ${S.size} Image${S.size>1?"s":""} to PDF`:"Select images to export"}):p.jsx("p",{className:"text-xs text-gray-500 text-center",children:c==="area"?`${t.length} areas  ${n.length} images`:`${e.length} flights  ${n.length} images`})}),p.jsx(Hh,{isOpen:C,onClose:()=>{A(!1),M()},selectedImages:$})]})}const Gh=[{id:"white_hot",name:"White Hot",colors:["#000000","#FFFFFF"]},{id:"black_hot",name:"Black Hot",colors:["#FFFFFF","#000000"]},{id:"hot_iron",name:"Hot Iron",colors:["#000000","#330066","#660099","#990066","#CC3300","#FF6600","#FFCC33","#FFFFFF"]},{id:"fulgurite",name:"Fulgurite",colors:["#330000","#660000","#993300","#CC6600","#FF9933","#FFCC66","#FFFF99","#FFFFFF"]},{id:"medical",name:"Medical",colors:["#000033","#330066","#660099","#9900CC","#CC00FF","#FF66FF","#FFCCFF","#FFFFFF"]},{id:"arctic",name:"Arctic",colors:["#000066","#0033CC","#0099FF","#66CCFF","#CCFFFF","#FFFFFF"]},{id:"rainbow",name:"Rainbow",colors:["#0000FF","#00FFFF","#00FF00","#FFFF00","#FF0000"]},{id:"tint",name:"Tint",colors:["#000000","#333333","#666666","#999999","#FF0000","#FF3333","#FF6666"]}];function kl(n){const e=Gh.find(t=>t.id===n);return e?`linear-gradient(to right, ${e.colors.join(", ")})`:"linear-gradient(to right, #000, #fff)"}function $t(n,e=1){return`${n.toFixed(e)}F`}const Ol={white_hot:Ay(),black_hot:Sy(),hot_iron:Ry(),fulgurite:Cy(),medical:Py(),arctic:Ny(),rainbow:ky(),tint:Oy()};function is(n,e){const t=n.length,r=e/255*(t-1),s=Math.floor(r),i=Math.min(s+1,t-1),a=r-s;return[Math.round(n[s][0]+a*(n[i][0]-n[s][0])),Math.round(n[s][1]+a*(n[i][1]-n[s][1])),Math.round(n[s][2]+a*(n[i][2]-n[s][2]))]}function Ay(){return Array.from({length:256},(n,e)=>[e,e,e])}function Sy(){return Array.from({length:256},(n,e)=>[255-e,255-e,255-e])}function Ry(){const n=[[0,0,0],[51,0,102],[102,0,153],[153,0,102],[204,51,0],[255,102,0],[255,204,51],[255,255,255]];return Array.from({length:256},(e,t)=>[...is(n,t)])}function Cy(){const n=[[51,0,0],[102,0,0],[153,51,0],[204,102,0],[255,153,51],[255,204,102],[255,255,153],[255,255,255]];return Array.from({length:256},(e,t)=>[...is(n,t)])}function Py(){const n=[[0,0,51],[51,0,102],[102,0,153],[153,0,204],[204,0,255],[255,102,255],[255,204,255],[255,255,255]];return Array.from({length:256},(e,t)=>[...is(n,t)])}function Ny(){const n=[[0,0,102],[0,51,204],[0,153,255],[102,204,255],[204,255,255],[255,255,255]];return Array.from({length:256},(e,t)=>[...is(n,t)])}function ky(){const n=[[0,0,255],[0,255,255],[0,255,0],[255,255,0],[255,0,0]];return Array.from({length:256},(e,t)=>[...is(n,t)])}function Oy(){const n=[];for(let e=0;e<256;e++)if(e<200){const t=Math.round(e/200*180);n.push([t,t,t])}else{const t=(e-200)/55,r=Math.round(180+t*75),s=Math.round(180*(1-t*.8)),i=Math.round(180*(1-t*.8));n.push([r,s,i])}return n}function Dy(){const n=L.useRef(null),e=L.useRef(null),{currentImage:t,viewMode:r,colormap:s,opacity:i,minTemp:a,maxTemp:c,displayMinTemp:u,displayMaxTemp:h,markers:f,hoverTemp:m,zoom:v,panX:S,panY:x,thermalZoom:C,alignOffsetX:A,alignOffsetY:F,setThermalStats:j,addMarker:D,setHoverTemp:M,setLoading:$}=St(),[H,E]=L.useState(!1),[_,y]=L.useState(null),[T,b]=L.useState(null);L.useRef(null);const[I,w]=L.useState(null);L.useEffect(()=>{t&&($(!0),dy(t.id).then(j).catch(console.error).finally(()=>$(!1)))},[t,j,$]),L.useEffect(()=>{t&&(E(!1),w(null),ey(t.id).then(ne=>{w(ne),E(!0)}).catch(ne=>{console.error("Failed to load static thermal data:",ne),E(!0)}))},[t]),L.useEffect(()=>{},[t,a,c]),L.useEffect(()=>{if(!t)return;const ne=r==="visible"||r==="overlay"||r==="split";if(ne){const B=fy(t.id,C,A,F),me=new Image;me.crossOrigin="anonymous",me.onload=()=>b(me),me.onerror=()=>console.error("Failed to load visible image"),me.src=B}else!ne&&T&&b(null)},[t,r,C,A,F]);const k=L.useMemo(()=>{if(I)return Ii(I,s,u,h);if(!_)return null;const{width:ne,height:B,data:me}=_,ae=new ImageData(ne,B),ge=Ol[s]||Ol.hot_iron,_e=c-a,fe=h-u,we=u-a;for(let Ee=0;Ee<me.length;Ee+=4){let se=me[Ee]/255*_e;se=(se-we)/fe,se=Math.max(0,Math.min(1,se));const ye=Math.round(se*255),[Te,K,J]=ge[ye];ae.data[Ee]=Te,ae.data[Ee+1]=K,ae.data[Ee+2]=J,ae.data[Ee+3]=255}return ae},[_,I,s,a,c,u,h]);L.useEffect(()=>{if(!n.current||!e.current||!k)return;const ne=n.current,B=ne.getContext("2d");if(!B)return;const me=e.current,ae=me.clientWidth,ge=me.clientHeight;ne.width=ae,ne.height=ge,B.fillStyle="#0a0a0a",B.fillRect(0,0,ne.width,ne.height);const _e=k.width,fe=k.height,we=_e/fe,Ee=ae/ge;let pe,se;if(r==="split"){const ye=ae/2,Te=ye/ge;we>Te?(pe=ye*v,se=pe/we):(se=ge*v,pe=se*we);const K=(ye-pe)/2+S,J=(ge-se)/2+x,Ie=ye+(ye-pe)/2+S,De=J,re=document.createElement("canvas");re.width=_e,re.height=fe;const ce=re.getContext("2d");ce&&(ce.putImageData(k,0,0),B.drawImage(re,K,J,pe,se)),T&&B.drawImage(T,Ie,De,pe,se),B.strokeStyle="#ff6600",B.lineWidth=2,B.beginPath(),B.moveTo(ae/2,0),B.lineTo(ae/2,ge),B.stroke(),B.fillStyle="rgba(0,0,0,0.7)",B.fillRect(10,10,70,24),B.fillRect(ae/2+10,10,60,24),B.fillStyle="#ff6600",B.font='bold 12px "Gravesend Sans", sans-serif',B.fillText("THERMAL",15,26),B.fillText("VISIBLE",ae/2+15,26)}else{we>Ee?(pe=ae*v,se=pe/we):(se=ge*v,pe=se*we);const ye=(ae-pe)/2+S,Te=(ge-se)/2+x;if(r==="thermal"){const K=document.createElement("canvas");K.width=_e,K.height=fe;const J=K.getContext("2d");J&&(J.putImageData(k,0,0),B.drawImage(K,ye,Te,pe,se))}else if(r==="visible"&&T)B.drawImage(T,ye,Te,pe,se);else if(r==="overlay"&&T){B.drawImage(T,ye,Te,pe,se),B.globalAlpha=i;const K=document.createElement("canvas");K.width=_e,K.height=fe;const J=K.getContext("2d");J&&(J.putImageData(k,0,0),B.drawImage(K,ye,Te,pe,se)),B.globalAlpha=1}else{const K=document.createElement("canvas");K.width=_e,K.height=fe;const J=K.getContext("2d");J&&(J.putImageData(k,0,0),B.drawImage(K,ye,Te,pe,se))}if(f.forEach(K=>{const J=ye+K.x/_e*pe,Ie=Te+K.y/fe*se;B.strokeStyle="#ffff00",B.lineWidth=2,B.beginPath(),B.moveTo(J-10,Ie),B.lineTo(J+10,Ie),B.moveTo(J,Ie-10),B.lineTo(J,Ie+10),B.stroke(),B.beginPath(),B.arc(J,Ie,8,0,Math.PI*2),B.stroke();const De=$t(K.tempFahrenheit);B.font='bold 12px "Gravesend Sans", sans-serif';const re=B.measureText(De).width;B.fillStyle="rgba(0, 0, 0, 0.8)",B.fillRect(J+12,Ie-8,re+8,18),B.fillStyle="#ffff00",B.fillText(De,J+16,Ie+5)}),m){const K=ye+m.x/_e*pe,J=Te+m.y/fe*se;B.strokeStyle="rgba(255, 255, 255, 0.5)",B.lineWidth=1,B.beginPath(),B.moveTo(K-5,J),B.lineTo(K+5,J),B.moveTo(K,J-5),B.lineTo(K,J+5),B.stroke()}}},[k,T,r,i,v,S,x,f,m]);const Q=L.useCallback(async ne=>{if(!n.current||!e.current||!t||!k||r==="split")return;const me=n.current.getBoundingClientRect(),ae=ne.clientX-me.left,ge=ne.clientY-me.top,_e=e.current,fe=_e.clientWidth,we=_e.clientHeight,Ee=k.width,pe=k.height,se=Ee/pe,ye=fe/we;let Te,K;se>ye?(Te=fe*v,K=Te/se):(K=we*v,Te=K*se);const J=(fe-Te)/2+S,Ie=(we-K)/2+x;if(ae<J||ae>J+Te||ge<Ie||ge>Ie+K)return;const De=Math.floor((ae-J)/Te*Ee),re=Math.floor((ge-Ie)/K*pe);try{if(ao&&I){const{tempCelsius:ce,tempFahrenheit:je}=$s(I,De,re),an={id:`marker-${Date.now()}`,x:De,y:re,tempCelsius:ce,tempFahrenheit:je};D(an)}else{const ce=await co(t.id,De,re),je={id:`marker-${Date.now()}`,x:De,y:re,tempCelsius:ce.tempCelsius,tempFahrenheit:ce.tempFahrenheit};D(je)}}catch(ce){console.error("Failed to get temperature:",ce)}},[t,k,I,r,v,S,x,D]),oe=L.useRef(0),Le=L.useCallback(async ne=>{const B=Date.now();if(B-oe.current<100||(oe.current=B,!n.current||!e.current||!t||!k)||r==="split")return;const ae=n.current.getBoundingClientRect(),ge=ne.clientX-ae.left,_e=ne.clientY-ae.top,fe=e.current,we=fe.clientWidth,Ee=fe.clientHeight,pe=k.width,se=k.height,ye=pe/se,Te=we/Ee;let K,J;ye>Te?(K=we*v,J=K/ye):(J=Ee*v,K=J*ye);const Ie=(we-K)/2+S,De=(Ee-J)/2+x;if(ge<Ie||ge>Ie+K||_e<De||_e>De+J){M(null);return}const re=Math.floor((ge-Ie)/K*pe),ce=Math.floor((_e-De)/J*se);try{if(ao&&I){const{tempFahrenheit:je}=$s(I,re,ce);M({x:re,y:ce,tempF:je})}else{const je=await co(t.id,re,ce);M({x:re,y:ce,tempF:je.tempFahrenheit})}}catch{M(null)}},[t,k,I,r,v,S,x,M]),G=()=>M(null),be=L.useCallback(ne=>{ne.preventDefault(),St.getState().clearMarkers()},[]),At=L.useCallback(async ne=>{if(!n.current||!e.current||!t||!k||r==="split")return;ne.preventDefault();const B=ne.changedTouches[0],ae=n.current.getBoundingClientRect(),ge=B.clientX-ae.left,_e=B.clientY-ae.top,fe=e.current,we=fe.clientWidth,Ee=fe.clientHeight,pe=k.width,se=k.height,ye=pe/se,Te=we/Ee;let K,J;ye>Te?(K=we*v,J=K/ye):(J=Ee*v,K=J*ye);const Ie=(we-K)/2+S,De=(Ee-J)/2+x;if(ge<Ie||ge>Ie+K||_e<De||_e>De+J)return;const re=Math.floor((ge-Ie)/K*pe),ce=Math.floor((_e-De)/J*se);try{if(ao&&I){const{tempCelsius:je,tempFahrenheit:an}=$s(I,re,ce),gs={id:`marker-${Date.now()}`,x:re,y:ce,tempCelsius:je,tempFahrenheit:an};D(gs)}else{const je=await co(t.id,re,ce),an={id:`marker-${Date.now()}`,x:re,y:ce,tempCelsius:je.tempCelsius,tempFahrenheit:je.tempFahrenheit};D(an)}}catch(je){console.error("Failed to get temperature:",je)}},[t,k,I,r,v,S,x,D]),Oe=St(ne=>ne.thermalStats);return p.jsxs("div",{ref:e,className:"canvas-container",children:[p.jsx("canvas",{ref:n,onClick:Q,onMouseMove:Le,onMouseLeave:G,onContextMenu:be,onTouchEnd:At,className:"cursor-crosshair touch-none"}),H&&Oe&&p.jsx("div",{className:"absolute top-4 right-4 bg-black/85 backdrop-blur-sm text-white px-3 py-2 rounded-lg shadow-lg",children:p.jsxs("div",{className:"flex flex-col gap-1",children:[p.jsxs("div",{className:"flex items-center justify-between gap-4",children:[p.jsx("span",{className:"text-blue-400 font-bold text-xs",children:"MIN"}),p.jsx("span",{className:"font-mono text-sm",children:$t(Oe.minTemp)})]}),p.jsxs("div",{className:"flex items-center justify-between gap-4",children:[p.jsx("span",{className:"text-red-400 font-bold text-xs",children:"MAX"}),p.jsx("span",{className:"font-mono text-sm",children:$t(Oe.maxTemp)})]}),p.jsxs("div",{className:"flex items-center justify-between gap-4 text-gray-400 text-xs border-t border-gray-600 pt-1 mt-1",children:[p.jsx("span",{children:"AVG"}),p.jsx("span",{className:"font-mono",children:$t(Oe.meanTemp)})]})]})}),m&&p.jsxs("div",{className:"absolute top-4 left-4 bg-black/85 backdrop-blur-sm text-white px-3 py-2 rounded-lg shadow-lg hidden md:block",children:[p.jsx("span",{className:"text-[#ff6600] font-bold text-lg",children:$t(m.tempF)}),p.jsxs("span",{className:"text-gray-400 text-sm ml-2",children:["(",m.x,", ",m.y,")"]})]}),f.length>0&&r!=="split"&&p.jsx("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2 md:hidden",children:p.jsxs("button",{onClick:()=>St.getState().clearMarkers(),className:"bg-red-600/90 backdrop-blur-sm text-white px-4 py-3 rounded-full shadow-lg flex items-center gap-2 active:scale-95 transition-transform",children:[p.jsx("span",{children:""}),p.jsxs("span",{className:"text-sm font-medium",children:["Clear (",f.length,")"]})]})}),f.length>0&&r!=="split"&&p.jsxs("div",{className:"absolute bottom-4 left-4 bg-black/80 text-white px-3 py-2 rounded-lg text-sm hidden md:block",children:[f.length," marker",f.length!==1?"s":"","  Right-click to clear"]}),f.length===0&&H&&r!=="split"&&p.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 backdrop-blur-sm text-gray-200 px-4 py-2 rounded-full text-sm md:hidden shadow-lg",children:" Tap to add temperature marker"}),!H&&p.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:p.jsx("div",{className:"spinner"})})]})}function fn({title:n,children:e,defaultOpen:t=!0,badge:r}){const[s,i]=L.useState(t);return p.jsxs("section",{className:"border-b border-[#444] last:border-0",children:[p.jsxs("button",{onClick:()=>i(!s),className:"w-full flex items-center justify-between py-3 px-1 text-left",children:[p.jsxs("span",{className:"text-sm font-bold text-[#ff6600] flex items-center gap-2",children:[n,r!==void 0&&p.jsx("span",{className:"bg-[#ff6600] text-white text-xs px-1.5 py-0.5 rounded-full",children:r})]}),p.jsx("span",{className:"text-gray-500 text-lg",children:s?"":"+"})]}),s&&p.jsx("div",{className:"pb-4",children:e})]})}function Vy(){const{currentImage:n,thermalStats:e,colormap:t,opacity:r,minTemp:s,maxTemp:i,displayMinTemp:a,displayMaxTemp:c,markers:u,thermalZoom:h,alignOffsetX:f,alignOffsetY:m,setColormap:v,setOpacity:S,setDisplayTempRange:x,clearMarkers:C,removeMarker:A,resetView:F,setThermalZoom:j,setAlignOffset:D}=St(),M=async()=>{if(n)try{const k=await py(n.id,{format:"png",colormap:t,minTemp:a,maxTemp:c,includeAnnotations:u.length>0,includeColorbar:!0,markers:u.map(Q=>({x:Q.x,y:Q.y,tempF:Q.tempFahrenheit}))});qs(k,`${n.filename.replace(".tiff","")}_thermal.png`)}catch(k){console.error("Export failed:",k)}},$=async()=>{if(n)try{const k=await gy(n.id);qs(k,`${n.filename.replace(".tiff","")}_temps.csv`)}catch(k){console.error("CSV export failed:",k)}},[H,E]=L.useState(!1),[_,y]=L.useState(""),[T,b]=L.useState(!1),I=n?.visiblePath!=null,w=async()=>{if(n){if(!I){alert("No visible image available for this thermal image. GIF export requires both thermal and visible images.");return}E(!0),y("Generating frames...");try{const k=await my(n.id,{colormap:t,minTemp:a,maxTemp:c,duration:5,fps:12,thermalZoom:h,offsetX:f,offsetY:m});if(!k||k.size===0)throw new Error("Received empty response from server");y("Saving...");const Q=n.filename.replace(".tiff","").replace(".JPG","").replace(".jpg","")+"_thermal_visible.gif";qs(k,Q),y("Done!"),setTimeout(()=>y(""),2e3)}catch(k){console.error("GIF export failed:",k);const Q=k instanceof Error?k.message:"Unknown error";alert(`GIF export failed: ${Q}`),y("")}finally{E(!1)}}};return p.jsxs("div",{className:"p-4 space-y-0",children:[p.jsx(fn,{title:"Color Palette",defaultOpen:!0,children:p.jsx("div",{className:"grid grid-cols-4 gap-2",children:Gh.map(k=>p.jsxs("button",{onClick:()=>v(k.id),className:`relative rounded-lg overflow-hidden border-2 transition-all ${t===k.id?"border-[#ff6600] ring-2 ring-[#ff6600]/50 scale-105":"border-transparent hover:border-[#555] active:scale-95"}`,children:[p.jsx("div",{className:"h-8",style:{background:kl(k.id)}}),p.jsx("div",{className:"bg-[#2d2d2d] px-1 py-1",children:p.jsx("span",{className:"text-[10px] text-gray-300 block truncate",children:k.name})})]},k.id))})}),p.jsx(fn,{title:"Temperature Range",defaultOpen:!0,children:p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"h-6 rounded-lg",style:{background:kl(t)}}),e&&p.jsx("div",{className:"absolute top-0 h-6 border-l-2 border-r-2 border-white/80 pointer-events-none rounded",style:{left:`${(a-s)/(i-s)*100}%`,right:`${100-(c-s)/(i-s)*100}%`}})]}),p.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-3",children:[p.jsxs("div",{className:"flex justify-between text-xs mb-2",children:[p.jsx("span",{className:"text-blue-400 font-bold",children:"MIN"}),p.jsx("span",{className:"text-blue-400 font-mono text-base",children:$t(a)})]}),p.jsx("input",{type:"range",min:s,max:i,step:.5,value:a,onChange:k=>x(parseFloat(k.target.value),c),className:"w-full h-8 appearance-none bg-transparent cursor-pointer touch-pan-y",style:{WebkitAppearance:"none"}})]}),p.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-3",children:[p.jsxs("div",{className:"flex justify-between text-xs mb-2",children:[p.jsx("span",{className:"text-red-400 font-bold",children:"MAX"}),p.jsx("span",{className:"text-red-400 font-mono text-base",children:$t(c)})]}),p.jsx("input",{type:"range",min:s,max:i,step:.5,value:c,onChange:k=>x(a,parseFloat(k.target.value)),className:"w-full h-8 appearance-none bg-transparent cursor-pointer touch-pan-y"})]}),p.jsx("button",{onClick:()=>x(s,i),className:"w-full py-3 text-sm text-gray-400 hover:text-white active:bg-[#4d4d4d] bg-[#3d3d3d] rounded-lg transition-all",children:"Reset to Auto Range"})]})}),p.jsx(fn,{title:"Overlay Blend",defaultOpen:!0,children:p.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-3",children:[p.jsxs("div",{className:"flex justify-between items-center mb-3",children:[p.jsx("span",{className:"text-gray-400 text-sm",children:"Thermal Visibility"}),p.jsxs("span",{className:"text-[#ff6600] font-mono text-lg font-bold",children:[Math.round(r*100),"%"]})]}),p.jsx("input",{type:"range",min:0,max:1,step:.05,value:r,onChange:k=>S(parseFloat(k.target.value)),className:"w-full h-10 appearance-none bg-transparent cursor-pointer touch-pan-y"}),p.jsx("div",{className:"flex gap-2 mt-3",children:[.25,.5,.75].map(k=>p.jsxs("button",{onClick:()=>S(k),className:`flex-1 py-2 text-xs rounded-lg transition-all ${Math.abs(r-k)<.05?"bg-[#ff6600] text-white":"bg-[#3d3d3d] text-gray-400 active:bg-[#4d4d4d]"}`,children:[Math.round(k*100),"%"]},k))})]})}),p.jsx(fn,{title:"Alignment",defaultOpen:!1,children:p.jsxs("div",{className:"space-y-4",children:[p.jsx("p",{className:"text-xs text-gray-500 -mt-2 mb-2",children:"Adjust to align thermal overlay with visible image"}),p.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-3",children:[p.jsxs("div",{className:"flex justify-between text-xs mb-2",children:[p.jsx("span",{className:"text-gray-400",children:"Visible Crop Zoom"}),p.jsxs("span",{className:"text-white font-mono text-base",children:[h.toFixed(2),"x"]})]}),p.jsx("input",{type:"range",min:1,max:4,step:.05,value:h,onChange:k=>j(parseFloat(k.target.value)),className:"w-full h-8"}),p.jsx("div",{className:"flex gap-2 mt-2",children:[1,1.5,2,2.5].map(k=>p.jsxs("button",{onClick:()=>j(k),className:`flex-1 py-1.5 text-xs rounded transition-all ${Math.abs(h-k)<.05?"bg-[#ff6600] text-white":"bg-[#3d3d3d] text-gray-400"}`,children:[k,"x"]},k))})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-3",children:[p.jsxs("div",{className:"flex justify-between text-xs mb-2",children:[p.jsx("span",{className:"text-gray-400",children:"X Offset"}),p.jsxs("span",{className:"text-white font-mono",children:[f,"px"]})]}),p.jsx("input",{type:"range",min:-150,max:150,step:1,value:f,onChange:k=>D(parseInt(k.target.value),m),className:"w-full h-6"}),p.jsxs("div",{className:"flex gap-1 mt-2",children:[p.jsx("button",{onClick:()=>D(f-10,m),className:"flex-1 py-1 text-xs bg-[#3d3d3d] rounded",children:"-10"}),p.jsx("button",{onClick:()=>D(f-1,m),className:"flex-1 py-1 text-xs bg-[#3d3d3d] rounded",children:"-1"}),p.jsx("button",{onClick:()=>D(0,m),className:"flex-1 py-1 text-xs bg-[#3d3d3d] rounded text-[#ff6600]",children:"0"}),p.jsx("button",{onClick:()=>D(f+1,m),className:"flex-1 py-1 text-xs bg-[#3d3d3d] rounded",children:"+1"}),p.jsx("button",{onClick:()=>D(f+10,m),className:"flex-1 py-1 text-xs bg-[#3d3d3d] rounded",children:"+10"})]})]}),p.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-3",children:[p.jsxs("div",{className:"flex justify-between text-xs mb-2",children:[p.jsx("span",{className:"text-gray-400",children:"Y Offset"}),p.jsxs("span",{className:"text-white font-mono",children:[m,"px"]})]}),p.jsx("input",{type:"range",min:-150,max:150,step:1,value:m,onChange:k=>D(f,parseInt(k.target.value)),className:"w-full h-6"}),p.jsxs("div",{className:"flex gap-1 mt-2",children:[p.jsx("button",{onClick:()=>D(f,m-10),className:"flex-1 py-1 text-xs bg-[#3d3d3d] rounded",children:"-10"}),p.jsx("button",{onClick:()=>D(f,m-1),className:"flex-1 py-1 text-xs bg-[#3d3d3d] rounded",children:"-1"}),p.jsx("button",{onClick:()=>D(f,0),className:"flex-1 py-1 text-xs bg-[#3d3d3d] rounded text-[#ff6600]",children:"0"}),p.jsx("button",{onClick:()=>D(f,m+1),className:"flex-1 py-1 text-xs bg-[#3d3d3d] rounded",children:"+1"}),p.jsx("button",{onClick:()=>D(f,m+10),className:"flex-1 py-1 text-xs bg-[#3d3d3d] rounded",children:"+10"})]})]})]}),p.jsx("button",{onClick:()=>{j(1),D(0,0)},className:"w-full py-3 text-sm text-gray-400 hover:text-white active:bg-[#4d4d4d] bg-[#3d3d3d] rounded-lg",children:"Reset Alignment"})]})}),u.length>0&&p.jsx(fn,{title:"Markers",badge:u.length,defaultOpen:!0,children:p.jsxs("div",{className:"space-y-2",children:[p.jsx("button",{onClick:C,className:"w-full py-3 text-sm bg-red-600/20 text-red-400 hover:bg-red-600/30 active:bg-red-600/40 rounded-lg border border-red-600/30 transition-all",children:" Clear All Markers"}),p.jsx("div",{className:"bg-[#1a1a1a] rounded-lg overflow-hidden max-h-48 overflow-y-auto",children:u.map((k,Q)=>p.jsxs("div",{className:"flex justify-between items-center px-3 py-3 border-b border-[#333] last:border-0",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("span",{className:"w-6 h-6 rounded-full bg-yellow-500/20 text-yellow-400 text-xs flex items-center justify-center font-bold",children:Q+1}),p.jsx("span",{className:"text-lg font-mono text-[#ff6600] font-bold",children:$t(k.tempFahrenheit)})]}),p.jsx("button",{onClick:()=>A(k.id),className:"w-8 h-8 flex items-center justify-center text-gray-500 hover:text-red-400 hover:bg-red-500/20 rounded-full transition-all",children:""})]},k.id))})]})}),p.jsx(fn,{title:"Export",defaultOpen:!1,children:p.jsxs("div",{className:"space-y-3",children:[p.jsx("button",{onClick:M,disabled:!n,className:"w-full py-4 text-sm bg-[#ff6600] hover:bg-[#ff8833] active:bg-[#e65c00] disabled:bg-[#555] disabled:text-gray-500 text-white rounded-lg transition-all font-medium",children:" Export Image (PNG)"}),p.jsx("button",{onClick:w,disabled:!n||H||!I,className:"w-full py-4 text-sm bg-[#6b21a8] hover:bg-[#7c3aed] active:bg-[#581c87] disabled:bg-[#555] disabled:text-gray-500 text-white rounded-lg transition-all font-medium",children:H?` ${_||"Processing..."}`:" Export Animated GIF"}),p.jsx("p",{className:"text-xs text-gray-500 -mt-1 px-1",children:I?"5-second loop fading between thermal & visible":" No visible image - GIF export unavailable"}),p.jsx("button",{onClick:$,disabled:!n,className:"w-full py-4 text-sm bg-[#3d3d3d] hover:bg-[#4d4d4d] active:bg-[#555] disabled:bg-[#333] disabled:text-gray-500 text-white rounded-lg transition-all font-medium",children:" Export Temperature CSV"}),p.jsx("button",{onClick:()=>b(!0),disabled:!n,className:"w-full py-4 text-sm bg-[#0066cc] hover:bg-[#0077ee] active:bg-[#0055aa] disabled:bg-[#333] disabled:text-gray-500 text-white rounded-lg transition-all font-medium",children:" Export PDF Report"}),p.jsx("p",{className:"text-xs text-gray-500 -mt-1 px-1",children:"Professional report with metadata, colorbar, and markers"})]})}),p.jsx(fn,{title:"View Controls",defaultOpen:!1,children:p.jsx("button",{onClick:F,className:"w-full py-3 text-sm bg-[#3d3d3d] hover:bg-[#4d4d4d] active:bg-[#555] text-white rounded-lg transition-all",children:"Reset Zoom & Pan"})}),p.jsxs("div",{className:"text-xs text-gray-500 space-y-1.5 pt-4 border-t border-[#444]",children:[p.jsxs("p",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-base",children:""}),p.jsx("span",{children:"Tap image to add temperature marker"})]}),p.jsxs("p",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-base",children:""}),p.jsx("span",{children:'Use "Clear All Markers" button above'})]})]}),p.jsx(Hh,{isOpen:T,onClose:()=>b(!1),selectedImages:n?[n]:[]})]})}const Dl={"North Face":"#ef4444","South Face":"#3b82f6","East Face":"#22c55e","West Face":"#eab308","Roof View":"#a855f7"},My="#6b7280",yt=[[0,0,0],[51,0,102],[102,0,153],[153,0,102],[204,51,0],[255,102,0],[255,204,51],[255,255,255]];function Fy(){const n=[],e=yt.length;for(let t=0;t<256;t++){const r=t/255*(e-1),s=Math.floor(r),i=Math.min(s+1,e-1),a=r-s;n.push([Math.round(yt[s][0]+a*(yt[i][0]-yt[s][0])),Math.round(yt[s][1]+a*(yt[i][1]-yt[s][1])),Math.round(yt[s][2]+a*(yt[i][2]-yt[s][2]))])}return n}const lo=Fy();function Ly(n,e,t){let r=0,s=1/0;for(let i=0;i<256;i++){const a=n-lo[i][0],c=e-lo[i][1],u=t-lo[i][2],h=a*a+c*c+u*u;h<s&&(s=h,r=i)}return r/255}function jy(n,e,t){const r=t?40:30,s=t?3:2;return`
    <svg xmlns="http://www.w3.org/2000/svg" width="${r}" height="${r}" viewBox="0 0 40 40">
      <g transform="rotate(${n}, 20, 20)" opacity="${t?1:.85}">
        <polygon points="20,4 28,22 20,18 12,22" fill="${e}" stroke="#fff" stroke-width="${s}"/>
        <circle cx="20" cy="24" r="6" fill="${e}" stroke="#fff" stroke-width="${s}"/>
        ${t?'<circle cx="20" cy="24" r="3" fill="#fff"/>':""}
      </g>
    </svg>
  `}function Uy(n,e){const a=(n-30.5-90)*Math.PI/180,c=(n+30.5-90)*Math.PI/180,u=40+60*Math.cos(a),h=40+60*Math.sin(a),f=40+60*Math.cos(c),m=40+60*Math.sin(c);return`
    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 80 80">
      <polygon points="40,40 ${u},${h} ${f},${m}" fill="${e}" opacity="0.2" stroke="${e}" stroke-width="1" stroke-opacity="0.4"/>
    </svg>
  `}function By({images:n,photoGroups:e,mapData:t,orthophoto:r}){const s=L.useRef(null),i=L.useRef(null),a=L.useRef([]),c=L.useRef([]),u=L.useRef(null),h=L.useRef(null),f=L.useRef(null),m=L.useRef(null),[v,S]=L.useState(!1),[x,C]=L.useState(!1),[A,F]=L.useState(!0),[j,D]=L.useState(.7),[M,$]=L.useState(null),{currentImage:H,setCurrentImage:E}=St(),_=t?.markers||n.filter(b=>b.gps?.lat&&b.gps?.lon).map(b=>{let I="Unknown";for(const w of e)if(w.imageIds.includes(b.id)){I=w.name;break}return{imageId:b.id,lat:b.gps.lat,lon:b.gps.lon,yaw:b.gimbalYaw??0,pitch:b.gimbalPitch??0,altitude:b.relativeAltitude??0,facadeGroup:I}}),y=t?.center||(()=>{if(_.length===0)return{lat:42.34,lon:-71.12};const b=_.reduce((w,k)=>w+k.lat,0)/_.length,I=_.reduce((w,k)=>w+k.lon,0)/_.length;return{lat:b,lon:I}})();L.useEffect(()=>{if(!s.current||i.current)return;const b=()=>{if(!window.google?.maps){setTimeout(b,200);return}const I=new google.maps.Map(s.current,{center:{lat:y.lat,lng:y.lon},zoom:19,mapTypeId:"satellite",tilt:0,mapId:"thermal-viewer-map",gestureHandling:"greedy"});i.current=I,m.current=new google.maps.InfoWindow,S(!0)};b()},[y.lat,y.lon]),L.useEffect(()=>{if(!v||!i.current||!r)return;const b=i.current;if(u.current&&(u.current.setMap(null),u.current=null),!A)return;const I=new google.maps.LatLngBounds({lat:r.bounds.south,lng:r.bounds.west},{lat:r.bounds.north,lng:r.bounds.east}),w=new google.maps.GroundOverlay(r.url,I,{opacity:j,clickable:!0});w.setMap(b),u.current=w;const k=new Image;return k.crossOrigin="anonymous",k.onload=()=>{f.current=k;const Q=document.createElement("canvas");Q.width=k.width,Q.height=k.height,Q.getContext("2d").drawImage(k,0,0),h.current=Q},k.src=r.url,w.addListener("click",Q=>{if(!h.current||!Q.latLng)return;const oe=Q.latLng.lat(),Le=Q.latLng.lng(),G=h.current,be=r.bounds,At=(Le-be.west)/(be.east-be.west)*G.width,Oe=(be.north-oe)/(be.north-be.south)*G.height;if(At<0||At>=G.width||Oe<0||Oe>=G.height)return;const B=G.getContext("2d").getImageData(Math.floor(At),Math.floor(Oe),1,1).data,[me,ae,ge]=B;if(B[3]<128||me===0&&ae===0&&ge===0){$(null);return}const _e=Ly(me,ae,ge),fe=r.tempRange,we=fe.minTempF+_e*(fe.maxTempF-fe.minTempF),Ee=fe.minTempC+_e*(fe.maxTempC-fe.minTempC);$({lat:oe,lon:Le,tempF:we,tempC:Ee}),m.current?.setContent(`
        <div style="font-family: sans-serif; font-size: 14px; color: #333; min-width: 120px;">
          <div style="font-weight: bold; font-size: 18px; color: #ff6600; margin-bottom: 4px;">
            ${we.toFixed(1)}F
          </div>
          <div style="color: #666;">${Ee.toFixed(1)}C</div>
        </div>
      `),m.current?.setPosition(Q.latLng),m.current?.open(b)}),()=>{w.setMap(null)}},[v,r,A,j]),L.useEffect(()=>{u.current&&u.current.setOpacity(j)},[j]),L.useEffect(()=>{if(!v||!i.current)return;const b=i.current;a.current.forEach(I=>I.map=null),a.current=[],c.current.forEach(I=>I.map=null),c.current=[],_.forEach(I=>{const w=H?.id===I.imageId,k=Dl[I.facadeGroup]||My,Q=document.createElement("div");Q.innerHTML=jy(I.yaw,k,w),Q.style.cursor="pointer",Q.style.transition="transform 0.15s ease",w&&(Q.style.zIndex="10",Q.style.filter="drop-shadow(0 0 6px rgba(255,255,255,0.8))");const oe=new google.maps.marker.AdvancedMarkerElement({map:b,position:{lat:I.lat,lng:I.lon},content:Q,title:`${I.facadeGroup}  ${I.imageId}`,zIndex:w?100:1});if(oe.addListener("click",()=>{const Le=n.find(G=>G.id===I.imageId);Le&&E(Le)}),Q.addEventListener("mouseenter",()=>{const G=["N","NE","E","SE","S","SW","W","NW"][Math.round((I.yaw%360+360)%360/45)%8],be=(I.altitude*3.281).toFixed(0);m.current?.setContent(`
          <div style="font-family: sans-serif; font-size: 13px; color: #333; min-width: 140px;">
            <div style="font-weight: bold; margin-bottom: 4px;">${I.facadeGroup}</div>
            <div>Direction: ${G} (${I.yaw.toFixed(0)})</div>
            <div>Altitude: ${be} ft</div>
            <div>Pitch: ${I.pitch.toFixed(0)}</div>
            <div style="color: #888; font-size: 11px; margin-top: 4px;">Click to view</div>
          </div>
        `),m.current?.open(b,oe)}),Q.addEventListener("mouseleave",()=>{m.current?.close()}),a.current.push(oe),x){const Le=document.createElement("div");Le.innerHTML=Uy(I.yaw,k),Le.style.pointerEvents="none";const G=new google.maps.marker.AdvancedMarkerElement({map:b,position:{lat:I.lat,lng:I.lon},content:Le,zIndex:0});c.current.push(G)}})},[v,_,H?.id,n,E,x]),L.useEffect(()=>{!i.current||!H?.gps||i.current.panTo({lat:H.gps.lat,lng:H.gps.lon})},[H?.id,H?.gps]);const T=!!r;return p.jsxs("div",{className:"relative w-full h-full",children:[p.jsx("div",{ref:s,className:"w-full h-full"}),!v&&p.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#1a1a1a]",children:p.jsxs("div",{className:"text-center text-gray-500",children:[p.jsx("div",{className:"spinner mb-4"}),p.jsx("p",{children:"Loading Google Maps..."})]})}),p.jsxs("div",{className:"absolute bottom-4 left-4 bg-[#2d2d2d]/90 backdrop-blur-sm rounded-lg p-3 text-xs text-gray-300 z-10",children:[p.jsx("div",{className:"font-bold text-white mb-2",children:"Photo Locations"}),Object.entries(Dl).map(([b,I])=>p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:I}}),p.jsx("span",{children:b})]},b)),p.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-600 space-y-2",children:[p.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[p.jsx("input",{type:"checkbox",checked:x,onChange:b=>C(b.target.checked),className:"rounded"}),p.jsx("span",{children:"Show FOV cones"})]}),T&&p.jsxs(p.Fragment,{children:[p.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[p.jsx("input",{type:"checkbox",checked:A,onChange:b=>F(b.target.checked),className:"rounded"}),p.jsx("span",{children:"Thermal overlay"})]}),A&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-gray-500",children:"Opacity:"}),p.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:j,onChange:b=>D(parseFloat(b.target.value)),className:"w-20 accent-[#ff6600]"})]})]})]}),p.jsxs("div",{className:"mt-1 text-gray-500",children:[_.length," photos"]}),T&&A&&p.jsx("div",{className:"mt-1 text-[#ff6600] text-[10px]",children:"Click overlay for temp"})]}),M&&p.jsxs("div",{className:"absolute top-4 right-4 bg-[#2d2d2d]/95 backdrop-blur-sm rounded-lg p-4 z-10 text-center",children:[p.jsxs("div",{className:"text-2xl font-bold text-[#ff6600]",children:[M.tempF.toFixed(1),"F"]}),p.jsxs("div",{className:"text-sm text-gray-400",children:[M.tempC.toFixed(1),"C"]}),p.jsx("button",{onClick:()=>$(null),className:"mt-2 text-xs text-gray-500 hover:text-white",children:"dismiss"})]})]})}function $y({building:n,isSelected:e,onClick:t}){const r=!n.hasData;return p.jsxs("button",{onClick:t,disabled:r,className:`
        relative rounded-lg border-2 p-3 text-left transition-all font-gravesend
        ${e?"border-[#ff6600] bg-[#ff6600]/10":r?"border-gray-200 bg-gray-50 cursor-not-allowed opacity-60":"border-gray-200 bg-white hover:border-[#ff6600]/50 hover:shadow-md cursor-pointer"}
      `,children:[p.jsx("div",{className:"text-lg font-bold text-black leading-tight",children:n.label}),p.jsx("div",{className:`text-xs mt-1 ${r?"text-gray-400":"text-gray-600"}`,children:n.hasData?`${n.imageCount??0} image${(n.imageCount??0)!==1?"s":""}`:"Survey Pending"})]})}function qy({project:n,selectedBuildingId:e,onSelectBuilding:t}){const r=L.useMemo(()=>{const i={};for(const a of n.buildings??[])i[a.type]||(i[a.type]=[]),i[a.type].push(a);return i},[n.buildings]),s=L.useMemo(()=>Object.keys(r).sort(),[r]);return p.jsxs("div",{className:"h-full flex flex-col bg-white font-gravesend",children:[p.jsxs("div",{className:"p-5 border-b border-gray-200",children:[p.jsx("h1",{className:"text-xl font-bold text-black leading-tight",children:n.name}),p.jsx("p",{className:"text-sm text-gray-500 mt-1",children:n.location})]}),p.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:s.map(i=>{const a=r[i],c=n.buildingTypes?.[i],u=a.length;return p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-baseline gap-2 mb-3",children:[p.jsxs("h2",{className:"text-sm font-bold text-black uppercase tracking-wide",children:["Type ",i," Buildings"]}),p.jsxs("span",{className:"text-xs text-gray-400",children:["(",u,")"]})]}),c?.description&&p.jsx("p",{className:"text-xs text-gray-400 -mt-2 mb-3",children:c.description}),p.jsx("div",{className:"grid grid-cols-3 gap-2",children:a.map(h=>p.jsx($y,{building:h,isSelected:e===h.id,onClick:()=>t(h.id)},h.id))})]},i)})}),p.jsx("div",{className:"p-4 border-t border-gray-200",children:p.jsx("p",{className:"text-xs text-gray-400 text-center",children:n.client})})]})}const zy=()=>{};var Vl={};const Wh=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Hy=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],c=n[t++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},Kh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,c=a?n[s+1]:0,u=s+2<n.length,h=u?n[s+2]:0,f=i>>2,m=(i&3)<<4|c>>4;let v=(c&15)<<2|h>>6,S=h&63;u||(S=64,a||(v=64)),r.push(t[f],t[m],t[v],t[S])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Wh(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Hy(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],c=s<n.length?t[n.charAt(s)]:0;++s;const h=s<n.length?t[n.charAt(s)]:64;++s;const m=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||c==null||h==null||m==null)throw new Gy;const v=i<<2|c>>4;if(r.push(v),h!==64){const S=c<<4&240|h>>2;if(r.push(S),m!==64){const x=h<<6&192|m;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Gy extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Wy=function(n){const e=Wh(n);return Kh.encodeByteArray(e,!0)},ti=function(n){return Wy(n).replace(/\./g,"")},Qh=function(n){try{return Kh.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Ky(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Qy=()=>Ky().__FIREBASE_DEFAULTS__,Jy=()=>{if(typeof process>"u"||typeof Vl>"u")return;const n=Vl.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Yy=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Qh(n[1]);return e&&JSON.parse(e)},xi=()=>{try{return zy()||Qy()||Jy()||Yy()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Jh=n=>xi()?.emulatorHosts?.[n],Xy=n=>{const e=Jh(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Yh=()=>xi()?.config,Xh=n=>xi()?.[`_${n}`];class Zy{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function ar(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Zh(n){return(await fetch(n,{credentials:"include"})).ok}function e_(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[ti(JSON.stringify(t)),ti(JSON.stringify(a)),""].join(".")}const jr={};function t_(){const n={prod:[],emulator:[]};for(const e of Object.keys(jr))jr[e]?n.emulator.push(e):n.prod.push(e);return n}function n_(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Ml=!1;function ed(n,e){if(typeof window>"u"||typeof document>"u"||!ar(window.location.host)||jr[n]===e||jr[n]||Ml)return;jr[n]=e;function t(v){return`__firebase__banner__${v}`}const r="__firebase__banner",i=t_().prod.length>0;function a(){const v=document.getElementById(r);v&&v.remove()}function c(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function u(v,S){v.setAttribute("width","24"),v.setAttribute("id",S),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function h(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Ml=!0,a()},v}function f(v,S){v.setAttribute("id",S),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function m(){const v=n_(r),S=t("text"),x=document.getElementById(S)||document.createElement("span"),C=t("learnmore"),A=document.getElementById(C)||document.createElement("a"),F=t("preprendIcon"),j=document.getElementById(F)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const D=v.element;c(D),f(A,C);const M=h();u(j,F),D.append(j,x,A,M),document.body.appendChild(D)}i?(x.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function Ze(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function r_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ze())}function s_(){const n=xi()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function i_(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function o_(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function a_(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function c_(){const n=Ze();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function l_(){return!s_()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function u_(){try{return typeof indexedDB=="object"}catch{return!1}}function h_(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const d_="FirebaseError";class Dt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=d_,Object.setPrototypeOf(this,Dt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,os.prototype.create)}}class os{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?f_(i,r):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new Dt(s,c,r)}}function f_(n,e){return n.replace(p_,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const p_=/\{\$([^}]+)}/g;function m_(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function In(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(Fl(i)&&Fl(a)){if(!In(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Fl(n){return n!==null&&typeof n=="object"}function as(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function g_(n,e){const t=new y_(n,e);return t.subscribe.bind(t)}class y_{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");__(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=uo),s.error===void 0&&(s.error=uo),s.complete===void 0&&(s.complete=uo);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function __(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function uo(){}function ht(n){return n&&n._delegate?n._delegate:n}class xn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const pn="[DEFAULT]";class v_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Zy;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(b_(e))try{this.getOrInitializeService({instanceIdentifier:pn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=pn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=pn){return this.instances.has(e)}getOptions(e=pn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);r===c&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:w_(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=pn){return this.component?this.component.multipleInstances?e:pn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function w_(n){return n===pn?void 0:n}function b_(n){return n.instantiationMode==="EAGER"}class E_{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new v_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var ie;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ie||(ie={}));const T_={debug:ie.DEBUG,verbose:ie.VERBOSE,info:ie.INFO,warn:ie.WARN,error:ie.ERROR,silent:ie.SILENT},I_=ie.INFO,x_={[ie.DEBUG]:"log",[ie.VERBOSE]:"log",[ie.INFO]:"info",[ie.WARN]:"warn",[ie.ERROR]:"error"},A_=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=x_[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class _a{constructor(e){this.name=e,this._logLevel=I_,this._logHandler=A_,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ie))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?T_[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ie.DEBUG,...e),this._logHandler(this,ie.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ie.VERBOSE,...e),this._logHandler(this,ie.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ie.INFO,...e),this._logHandler(this,ie.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ie.WARN,...e),this._logHandler(this,ie.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ie.ERROR,...e),this._logHandler(this,ie.ERROR,...e)}}const S_=(n,e)=>e.some(t=>n instanceof t);let Ll,jl;function R_(){return Ll||(Ll=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function C_(){return jl||(jl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const td=new WeakMap,Vo=new WeakMap,nd=new WeakMap,ho=new WeakMap,va=new WeakMap;function P_(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(Jt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&td.set(t,n)}).catch(()=>{}),va.set(e,n),e}function N_(n){if(Vo.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});Vo.set(n,e)}let Mo={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Vo.get(n);if(e==="objectStoreNames")return n.objectStoreNames||nd.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Jt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function k_(n){Mo=n(Mo)}function O_(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(fo(this),e,...t);return nd.set(r,e.sort?e.sort():[e]),Jt(r)}:C_().includes(n)?function(...e){return n.apply(fo(this),e),Jt(td.get(this))}:function(...e){return Jt(n.apply(fo(this),e))}}function D_(n){return typeof n=="function"?O_(n):(n instanceof IDBTransaction&&N_(n),S_(n,R_())?new Proxy(n,Mo):n)}function Jt(n){if(n instanceof IDBRequest)return P_(n);if(ho.has(n))return ho.get(n);const e=D_(n);return e!==n&&(ho.set(n,e),va.set(e,n)),e}const fo=n=>va.get(n);function V_(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),c=Jt(a);return r&&a.addEventListener("upgradeneeded",u=>{r(Jt(a.result),u.oldVersion,u.newVersion,Jt(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",h=>s(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const M_=["get","getKey","getAll","getAllKeys","count"],F_=["put","add","delete","clear"],po=new Map;function Ul(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(po.get(e))return po.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=F_.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||M_.includes(t)))return;const i=async function(a,...c){const u=this.transaction(a,s?"readwrite":"readonly");let h=u.store;return r&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),s&&u.done]))[0]};return po.set(e,i),i}k_(n=>({...n,get:(e,t,r)=>Ul(e,t)||n.get(e,t,r),has:(e,t)=>!!Ul(e,t)||n.has(e,t)}));class L_{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(j_(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function j_(n){return n.getComponent()?.type==="VERSION"}const Fo="@firebase/app",Bl="0.14.8";const Pt=new _a("@firebase/app"),U_="@firebase/app-compat",B_="@firebase/analytics-compat",$_="@firebase/analytics",q_="@firebase/app-check-compat",z_="@firebase/app-check",H_="@firebase/auth",G_="@firebase/auth-compat",W_="@firebase/database",K_="@firebase/data-connect",Q_="@firebase/database-compat",J_="@firebase/functions",Y_="@firebase/functions-compat",X_="@firebase/installations",Z_="@firebase/installations-compat",ev="@firebase/messaging",tv="@firebase/messaging-compat",nv="@firebase/performance",rv="@firebase/performance-compat",sv="@firebase/remote-config",iv="@firebase/remote-config-compat",ov="@firebase/storage",av="@firebase/storage-compat",cv="@firebase/firestore",lv="@firebase/ai",uv="@firebase/firestore-compat",hv="firebase",dv="12.9.0";const Lo="[DEFAULT]",fv={[Fo]:"fire-core",[U_]:"fire-core-compat",[$_]:"fire-analytics",[B_]:"fire-analytics-compat",[z_]:"fire-app-check",[q_]:"fire-app-check-compat",[H_]:"fire-auth",[G_]:"fire-auth-compat",[W_]:"fire-rtdb",[K_]:"fire-data-connect",[Q_]:"fire-rtdb-compat",[J_]:"fire-fn",[Y_]:"fire-fn-compat",[X_]:"fire-iid",[Z_]:"fire-iid-compat",[ev]:"fire-fcm",[tv]:"fire-fcm-compat",[nv]:"fire-perf",[rv]:"fire-perf-compat",[sv]:"fire-rc",[iv]:"fire-rc-compat",[ov]:"fire-gcs",[av]:"fire-gcs-compat",[cv]:"fire-fst",[uv]:"fire-fst-compat",[lv]:"fire-vertex","fire-js":"fire-js",[hv]:"fire-js-all"};const ni=new Map,pv=new Map,jo=new Map;function $l(n,e){try{n.container.addComponent(e)}catch(t){Pt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Yn(n){const e=n.name;if(jo.has(e))return Pt.debug(`There were multiple attempts to register component ${e}.`),!1;jo.set(e,n);for(const t of ni.values())$l(t,n);for(const t of pv.values())$l(t,n);return!0}function wa(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function vt(n){return n==null?!1:n.settings!==void 0}const mv={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Yt=new os("app","Firebase",mv);class gv{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new xn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Yt.create("app-deleted",{appName:this._name})}}const cr=dv;function rd(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Lo,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Yt.create("bad-app-name",{appName:String(s)});if(t||(t=Yh()),!t)throw Yt.create("no-options");const i=ni.get(s);if(i){if(In(t,i.options)&&In(r,i.config))return i;throw Yt.create("duplicate-app",{appName:s})}const a=new E_(s);for(const u of jo.values())a.addComponent(u);const c=new gv(t,r,a);return ni.set(s,c),c}function sd(n=Lo){const e=ni.get(n);if(!e&&n===Lo&&Yh())return rd();if(!e)throw Yt.create("no-app",{appName:n});return e}function Xt(n,e,t){let r=fv[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Pt.warn(a.join(" "));return}Yn(new xn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const yv="firebase-heartbeat-database",_v=1,Wr="firebase-heartbeat-store";let mo=null;function id(){return mo||(mo=V_(yv,_v,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Wr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Yt.create("idb-open",{originalErrorMessage:n.message})})),mo}async function vv(n){try{const t=(await id()).transaction(Wr),r=await t.objectStore(Wr).get(od(n));return await t.done,r}catch(e){if(e instanceof Dt)Pt.warn(e.message);else{const t=Yt.create("idb-get",{originalErrorMessage:e?.message});Pt.warn(t.message)}}}async function ql(n,e){try{const r=(await id()).transaction(Wr,"readwrite");await r.objectStore(Wr).put(e,od(n)),await r.done}catch(t){if(t instanceof Dt)Pt.warn(t.message);else{const r=Yt.create("idb-set",{originalErrorMessage:t?.message});Pt.warn(r.message)}}}function od(n){return`${n.name}!${n.options.appId}`}const wv=1024,bv=30;class Ev{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Iv(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=zl();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>bv){const s=xv(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Pt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=zl(),{heartbeatsToSend:t,unsentEntries:r}=Tv(this._heartbeatsCache.heartbeats),s=ti(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Pt.warn(e),""}}}function zl(){return new Date().toISOString().substring(0,10)}function Tv(n,e=wv){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Hl(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Hl(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Iv{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return u_()?h_().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await vv(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ql(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ql(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Hl(n){return ti(JSON.stringify({version:2,heartbeats:n})).length}function xv(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Av(n){Yn(new xn("platform-logger",e=>new L_(e),"PRIVATE")),Yn(new xn("heartbeat",e=>new Ev(e),"PRIVATE")),Xt(Fo,Bl,n),Xt(Fo,Bl,"esm2020"),Xt("fire-js","")}Av("");var Gl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Zt,ad;(function(){var n;function e(E,_){function y(){}y.prototype=_.prototype,E.F=_.prototype,E.prototype=new y,E.prototype.constructor=E,E.D=function(T,b,I){for(var w=Array(arguments.length-2),k=2;k<arguments.length;k++)w[k-2]=arguments[k];return _.prototype[b].apply(T,w)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,_,y){y||(y=0);const T=Array(16);if(typeof _=="string")for(var b=0;b<16;++b)T[b]=_.charCodeAt(y++)|_.charCodeAt(y++)<<8|_.charCodeAt(y++)<<16|_.charCodeAt(y++)<<24;else for(b=0;b<16;++b)T[b]=_[y++]|_[y++]<<8|_[y++]<<16|_[y++]<<24;_=E.g[0],y=E.g[1],b=E.g[2];let I=E.g[3],w;w=_+(I^y&(b^I))+T[0]+3614090360&4294967295,_=y+(w<<7&4294967295|w>>>25),w=I+(b^_&(y^b))+T[1]+3905402710&4294967295,I=_+(w<<12&4294967295|w>>>20),w=b+(y^I&(_^y))+T[2]+606105819&4294967295,b=I+(w<<17&4294967295|w>>>15),w=y+(_^b&(I^_))+T[3]+3250441966&4294967295,y=b+(w<<22&4294967295|w>>>10),w=_+(I^y&(b^I))+T[4]+4118548399&4294967295,_=y+(w<<7&4294967295|w>>>25),w=I+(b^_&(y^b))+T[5]+1200080426&4294967295,I=_+(w<<12&4294967295|w>>>20),w=b+(y^I&(_^y))+T[6]+2821735955&4294967295,b=I+(w<<17&4294967295|w>>>15),w=y+(_^b&(I^_))+T[7]+4249261313&4294967295,y=b+(w<<22&4294967295|w>>>10),w=_+(I^y&(b^I))+T[8]+1770035416&4294967295,_=y+(w<<7&4294967295|w>>>25),w=I+(b^_&(y^b))+T[9]+2336552879&4294967295,I=_+(w<<12&4294967295|w>>>20),w=b+(y^I&(_^y))+T[10]+4294925233&4294967295,b=I+(w<<17&4294967295|w>>>15),w=y+(_^b&(I^_))+T[11]+2304563134&4294967295,y=b+(w<<22&4294967295|w>>>10),w=_+(I^y&(b^I))+T[12]+1804603682&4294967295,_=y+(w<<7&4294967295|w>>>25),w=I+(b^_&(y^b))+T[13]+4254626195&4294967295,I=_+(w<<12&4294967295|w>>>20),w=b+(y^I&(_^y))+T[14]+2792965006&4294967295,b=I+(w<<17&4294967295|w>>>15),w=y+(_^b&(I^_))+T[15]+1236535329&4294967295,y=b+(w<<22&4294967295|w>>>10),w=_+(b^I&(y^b))+T[1]+4129170786&4294967295,_=y+(w<<5&4294967295|w>>>27),w=I+(y^b&(_^y))+T[6]+3225465664&4294967295,I=_+(w<<9&4294967295|w>>>23),w=b+(_^y&(I^_))+T[11]+643717713&4294967295,b=I+(w<<14&4294967295|w>>>18),w=y+(I^_&(b^I))+T[0]+3921069994&4294967295,y=b+(w<<20&4294967295|w>>>12),w=_+(b^I&(y^b))+T[5]+3593408605&4294967295,_=y+(w<<5&4294967295|w>>>27),w=I+(y^b&(_^y))+T[10]+38016083&4294967295,I=_+(w<<9&4294967295|w>>>23),w=b+(_^y&(I^_))+T[15]+3634488961&4294967295,b=I+(w<<14&4294967295|w>>>18),w=y+(I^_&(b^I))+T[4]+3889429448&4294967295,y=b+(w<<20&4294967295|w>>>12),w=_+(b^I&(y^b))+T[9]+568446438&4294967295,_=y+(w<<5&4294967295|w>>>27),w=I+(y^b&(_^y))+T[14]+3275163606&4294967295,I=_+(w<<9&4294967295|w>>>23),w=b+(_^y&(I^_))+T[3]+4107603335&4294967295,b=I+(w<<14&4294967295|w>>>18),w=y+(I^_&(b^I))+T[8]+1163531501&4294967295,y=b+(w<<20&4294967295|w>>>12),w=_+(b^I&(y^b))+T[13]+2850285829&4294967295,_=y+(w<<5&4294967295|w>>>27),w=I+(y^b&(_^y))+T[2]+4243563512&4294967295,I=_+(w<<9&4294967295|w>>>23),w=b+(_^y&(I^_))+T[7]+1735328473&4294967295,b=I+(w<<14&4294967295|w>>>18),w=y+(I^_&(b^I))+T[12]+2368359562&4294967295,y=b+(w<<20&4294967295|w>>>12),w=_+(y^b^I)+T[5]+4294588738&4294967295,_=y+(w<<4&4294967295|w>>>28),w=I+(_^y^b)+T[8]+2272392833&4294967295,I=_+(w<<11&4294967295|w>>>21),w=b+(I^_^y)+T[11]+1839030562&4294967295,b=I+(w<<16&4294967295|w>>>16),w=y+(b^I^_)+T[14]+4259657740&4294967295,y=b+(w<<23&4294967295|w>>>9),w=_+(y^b^I)+T[1]+2763975236&4294967295,_=y+(w<<4&4294967295|w>>>28),w=I+(_^y^b)+T[4]+1272893353&4294967295,I=_+(w<<11&4294967295|w>>>21),w=b+(I^_^y)+T[7]+4139469664&4294967295,b=I+(w<<16&4294967295|w>>>16),w=y+(b^I^_)+T[10]+3200236656&4294967295,y=b+(w<<23&4294967295|w>>>9),w=_+(y^b^I)+T[13]+681279174&4294967295,_=y+(w<<4&4294967295|w>>>28),w=I+(_^y^b)+T[0]+3936430074&4294967295,I=_+(w<<11&4294967295|w>>>21),w=b+(I^_^y)+T[3]+3572445317&4294967295,b=I+(w<<16&4294967295|w>>>16),w=y+(b^I^_)+T[6]+76029189&4294967295,y=b+(w<<23&4294967295|w>>>9),w=_+(y^b^I)+T[9]+3654602809&4294967295,_=y+(w<<4&4294967295|w>>>28),w=I+(_^y^b)+T[12]+3873151461&4294967295,I=_+(w<<11&4294967295|w>>>21),w=b+(I^_^y)+T[15]+530742520&4294967295,b=I+(w<<16&4294967295|w>>>16),w=y+(b^I^_)+T[2]+3299628645&4294967295,y=b+(w<<23&4294967295|w>>>9),w=_+(b^(y|~I))+T[0]+4096336452&4294967295,_=y+(w<<6&4294967295|w>>>26),w=I+(y^(_|~b))+T[7]+1126891415&4294967295,I=_+(w<<10&4294967295|w>>>22),w=b+(_^(I|~y))+T[14]+2878612391&4294967295,b=I+(w<<15&4294967295|w>>>17),w=y+(I^(b|~_))+T[5]+4237533241&4294967295,y=b+(w<<21&4294967295|w>>>11),w=_+(b^(y|~I))+T[12]+1700485571&4294967295,_=y+(w<<6&4294967295|w>>>26),w=I+(y^(_|~b))+T[3]+2399980690&4294967295,I=_+(w<<10&4294967295|w>>>22),w=b+(_^(I|~y))+T[10]+4293915773&4294967295,b=I+(w<<15&4294967295|w>>>17),w=y+(I^(b|~_))+T[1]+2240044497&4294967295,y=b+(w<<21&4294967295|w>>>11),w=_+(b^(y|~I))+T[8]+1873313359&4294967295,_=y+(w<<6&4294967295|w>>>26),w=I+(y^(_|~b))+T[15]+4264355552&4294967295,I=_+(w<<10&4294967295|w>>>22),w=b+(_^(I|~y))+T[6]+2734768916&4294967295,b=I+(w<<15&4294967295|w>>>17),w=y+(I^(b|~_))+T[13]+1309151649&4294967295,y=b+(w<<21&4294967295|w>>>11),w=_+(b^(y|~I))+T[4]+4149444226&4294967295,_=y+(w<<6&4294967295|w>>>26),w=I+(y^(_|~b))+T[11]+3174756917&4294967295,I=_+(w<<10&4294967295|w>>>22),w=b+(_^(I|~y))+T[2]+718787259&4294967295,b=I+(w<<15&4294967295|w>>>17),w=y+(I^(b|~_))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(b+(w<<21&4294967295|w>>>11))&4294967295,E.g[2]=E.g[2]+b&4294967295,E.g[3]=E.g[3]+I&4294967295}r.prototype.v=function(E,_){_===void 0&&(_=E.length);const y=_-this.blockSize,T=this.C;let b=this.h,I=0;for(;I<_;){if(b==0)for(;I<=y;)s(this,E,I),I+=this.blockSize;if(typeof E=="string"){for(;I<_;)if(T[b++]=E.charCodeAt(I++),b==this.blockSize){s(this,T),b=0;break}}else for(;I<_;)if(T[b++]=E[I++],b==this.blockSize){s(this,T),b=0;break}}this.h=b,this.o+=_},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;_=this.o*8;for(var y=E.length-8;y<E.length;++y)E[y]=_&255,_/=256;for(this.v(E),E=Array(16),_=0,y=0;y<4;++y)for(let T=0;T<32;T+=8)E[_++]=this.g[y]>>>T&255;return E};function i(E,_){var y=c;return Object.prototype.hasOwnProperty.call(y,E)?y[E]:y[E]=_(E)}function a(E,_){this.h=_;const y=[];let T=!0;for(let b=E.length-1;b>=0;b--){const I=E[b]|0;T&&I==_||(y[b]=I,T=!1)}this.g=y}var c={};function u(E){return-128<=E&&E<128?i(E,function(_){return new a([_|0],_<0?-1:0)}):new a([E|0],E<0?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return m;if(E<0)return A(h(-E));const _=[];let y=1;for(let T=0;E>=y;T++)_[T]=E/y|0,y*=4294967296;return new a(_,0)}function f(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return A(f(E.substring(1),_));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=h(Math.pow(_,8));let T=m;for(let I=0;I<E.length;I+=8){var b=Math.min(8,E.length-I);const w=parseInt(E.substring(I,I+b),_);b<8?(b=h(Math.pow(_,b)),T=T.j(b).add(h(w))):(T=T.j(y),T=T.add(h(w)))}return T}var m=u(0),v=u(1),S=u(16777216);n=a.prototype,n.m=function(){if(C(this))return-A(this).m();let E=0,_=1;for(let y=0;y<this.g.length;y++){const T=this.i(y);E+=(T>=0?T:4294967296+T)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(x(this))return"0";if(C(this))return"-"+A(this).toString(E);const _=h(Math.pow(E,6));var y=this;let T="";for(;;){const b=M(y,_).g;y=F(y,b.j(_));let I=((y.g.length>0?y.g[0]:y.h)>>>0).toString(E);if(y=b,x(y))return I+T;for(;I.length<6;)I="0"+I;T=I+T}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function x(E){if(E.h!=0)return!1;for(let _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function C(E){return E.h==-1}n.l=function(E){return E=F(this,E),C(E)?-1:x(E)?0:1};function A(E){const _=E.g.length,y=[];for(let T=0;T<_;T++)y[T]=~E.g[T];return new a(y,~E.h).add(v)}n.abs=function(){return C(this)?A(this):this},n.add=function(E){const _=Math.max(this.g.length,E.g.length),y=[];let T=0;for(let b=0;b<=_;b++){let I=T+(this.i(b)&65535)+(E.i(b)&65535),w=(I>>>16)+(this.i(b)>>>16)+(E.i(b)>>>16);T=w>>>16,I&=65535,w&=65535,y[b]=w<<16|I}return new a(y,y[y.length-1]&-2147483648?-1:0)};function F(E,_){return E.add(A(_))}n.j=function(E){if(x(this)||x(E))return m;if(C(this))return C(E)?A(this).j(A(E)):A(A(this).j(E));if(C(E))return A(this.j(A(E)));if(this.l(S)<0&&E.l(S)<0)return h(this.m()*E.m());const _=this.g.length+E.g.length,y=[];for(var T=0;T<2*_;T++)y[T]=0;for(T=0;T<this.g.length;T++)for(let b=0;b<E.g.length;b++){const I=this.i(T)>>>16,w=this.i(T)&65535,k=E.i(b)>>>16,Q=E.i(b)&65535;y[2*T+2*b]+=w*Q,j(y,2*T+2*b),y[2*T+2*b+1]+=I*Q,j(y,2*T+2*b+1),y[2*T+2*b+1]+=w*k,j(y,2*T+2*b+1),y[2*T+2*b+2]+=I*k,j(y,2*T+2*b+2)}for(E=0;E<_;E++)y[E]=y[2*E+1]<<16|y[2*E];for(E=_;E<2*_;E++)y[E]=0;return new a(y,0)};function j(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function D(E,_){this.g=E,this.h=_}function M(E,_){if(x(_))throw Error("division by zero");if(x(E))return new D(m,m);if(C(E))return _=M(A(E),_),new D(A(_.g),A(_.h));if(C(_))return _=M(E,A(_)),new D(A(_.g),_.h);if(E.g.length>30){if(C(E)||C(_))throw Error("slowDivide_ only works with positive integers.");for(var y=v,T=_;T.l(E)<=0;)y=$(y),T=$(T);var b=H(y,1),I=H(T,1);for(T=H(T,2),y=H(y,2);!x(T);){var w=I.add(T);w.l(E)<=0&&(b=b.add(y),I=w),T=H(T,1),y=H(y,1)}return _=F(E,b.j(_)),new D(b,_)}for(b=m;E.l(_)>=0;){for(y=Math.max(1,Math.floor(E.m()/_.m())),T=Math.ceil(Math.log(y)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),I=h(y),w=I.j(_);C(w)||w.l(E)>0;)y-=T,I=h(y),w=I.j(_);x(I)&&(I=v),b=b.add(I),E=F(E,w)}return new D(b,E)}n.B=function(E){return M(this,E).h},n.and=function(E){const _=Math.max(this.g.length,E.g.length),y=[];for(let T=0;T<_;T++)y[T]=this.i(T)&E.i(T);return new a(y,this.h&E.h)},n.or=function(E){const _=Math.max(this.g.length,E.g.length),y=[];for(let T=0;T<_;T++)y[T]=this.i(T)|E.i(T);return new a(y,this.h|E.h)},n.xor=function(E){const _=Math.max(this.g.length,E.g.length),y=[];for(let T=0;T<_;T++)y[T]=this.i(T)^E.i(T);return new a(y,this.h^E.h)};function $(E){const _=E.g.length+1,y=[];for(let T=0;T<_;T++)y[T]=E.i(T)<<1|E.i(T-1)>>>31;return new a(y,E.h)}function H(E,_){const y=_>>5;_%=32;const T=E.g.length-y,b=[];for(let I=0;I<T;I++)b[I]=_>0?E.i(I+y)>>>_|E.i(I+y+1)<<32-_:E.i(I+y);return new a(b,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,ad=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,Zt=a}).apply(typeof Gl<"u"?Gl:typeof self<"u"?self:typeof window<"u"?window:{});var ks=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var cd,Vr,ld,zs,Uo,ud,hd,dd;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ks=="object"&&ks];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function s(o,l){if(l)e:{var d=r;o=o.split(".");for(var g=0;g<o.length-1;g++){var R=o[g];if(!(R in d))break e;d=d[R]}o=o[o.length-1],g=d[o],l=l(g),l!=g&&l!=null&&e(d,o,{configurable:!0,writable:!0,value:l})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(l){var d=[],g;for(g in l)Object.prototype.hasOwnProperty.call(l,g)&&d.push([g,l[g]]);return d}});var i=i||{},a=this||self;function c(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function u(o,l,d){return o.call.apply(o.bind,arguments)}function h(o,l,d){return h=u,h.apply(null,arguments)}function f(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var g=d.slice();return g.push.apply(g,arguments),o.apply(this,g)}}function m(o,l){function d(){}d.prototype=l.prototype,o.Z=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Ob=function(g,R,P){for(var U=Array(arguments.length-2),te=2;te<arguments.length;te++)U[te-2]=arguments[te];return l.prototype[R].apply(g,U)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function S(o){const l=o.length;if(l>0){const d=Array(l);for(let g=0;g<l;g++)d[g]=o[g];return d}return[]}function x(o,l){for(let g=1;g<arguments.length;g++){const R=arguments[g];var d=typeof R;if(d=d!="object"?d:R?Array.isArray(R)?"array":d:"null",d=="array"||d=="object"&&typeof R.length=="number"){d=o.length||0;const P=R.length||0;o.length=d+P;for(let U=0;U<P;U++)o[d+U]=R[U]}else o.push(R)}}class C{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function A(o){a.setTimeout(()=>{throw o},0)}function F(){var o=E;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class j{constructor(){this.h=this.g=null}add(l,d){const g=D.get();g.set(l,d),this.h?this.h.next=g:this.g=g,this.h=g}}var D=new C(()=>new M,o=>o.reset());class M{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let $,H=!1,E=new j,_=()=>{const o=Promise.resolve(void 0);$=()=>{o.then(y)}};function y(){for(var o;o=F();){try{o.h.call(o.g)}catch(d){A(d)}var l=D;l.j(o),l.h<100&&(l.h++,o.next=l.g,l.g=o)}H=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function b(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}b.prototype.h=function(){this.defaultPrevented=!0};var I=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};a.addEventListener("test",d,l),a.removeEventListener("test",d,l)}catch{}return o})();function w(o){return/^[\s\xa0]*$/.test(o)}function k(o,l){b.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,l)}m(k,b),k.prototype.init=function(o,l){const d=this.type=o.type,g=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget,l||(d=="mouseover"?l=o.fromElement:d=="mouseout"&&(l=o.toElement)),this.relatedTarget=l,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&k.Z.h.call(this)},k.prototype.h=function(){k.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Q="closure_listenable_"+(Math.random()*1e6|0),oe=0;function Le(o,l,d,g,R){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!g,this.ha=R,this.key=++oe,this.da=this.fa=!1}function G(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function be(o,l,d){for(const g in o)l.call(d,o[g],g,o)}function At(o,l){for(const d in o)l.call(void 0,o[d],d,o)}function Oe(o){const l={};for(const d in o)l[d]=o[d];return l}const ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function B(o,l){let d,g;for(let R=1;R<arguments.length;R++){g=arguments[R];for(d in g)o[d]=g[d];for(let P=0;P<ne.length;P++)d=ne[P],Object.prototype.hasOwnProperty.call(g,d)&&(o[d]=g[d])}}function me(o){this.src=o,this.g={},this.h=0}me.prototype.add=function(o,l,d,g,R){const P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);const U=ge(o,l,g,R);return U>-1?(l=o[U],d||(l.fa=!1)):(l=new Le(l,this.src,P,!!g,R),l.fa=d,o.push(l)),l};function ae(o,l){const d=l.type;if(d in o.g){var g=o.g[d],R=Array.prototype.indexOf.call(g,l,void 0),P;(P=R>=0)&&Array.prototype.splice.call(g,R,1),P&&(G(l),o.g[d].length==0&&(delete o.g[d],o.h--))}}function ge(o,l,d,g){for(let R=0;R<o.length;++R){const P=o[R];if(!P.da&&P.listener==l&&P.capture==!!d&&P.ha==g)return R}return-1}var _e="closure_lm_"+(Math.random()*1e6|0),fe={};function we(o,l,d,g,R){if(Array.isArray(l)){for(let P=0;P<l.length;P++)we(o,l[P],d,g,R);return null}return d=De(d),o&&o[Q]?o.J(l,d,c(g)?!!g.capture:!1,R):Ee(o,l,d,!1,g,R)}function Ee(o,l,d,g,R,P){if(!l)throw Error("Invalid event type");const U=c(R)?!!R.capture:!!R;let te=J(o);if(te||(o[_e]=te=new me(o)),d=te.add(l,d,g,U,P),d.proxy)return d;if(g=pe(),d.proxy=g,g.src=o,g.listener=d,o.addEventListener)I||(R=U),R===void 0&&(R=!1),o.addEventListener(l.toString(),g,R);else if(o.attachEvent)o.attachEvent(Te(l.toString()),g);else if(o.addListener&&o.removeListener)o.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return d}function pe(){function o(d){return l.call(o.src,o.listener,d)}const l=K;return o}function se(o,l,d,g,R){if(Array.isArray(l))for(var P=0;P<l.length;P++)se(o,l[P],d,g,R);else g=c(g)?!!g.capture:!!g,d=De(d),o&&o[Q]?(o=o.i,P=String(l).toString(),P in o.g&&(l=o.g[P],d=ge(l,d,g,R),d>-1&&(G(l[d]),Array.prototype.splice.call(l,d,1),l.length==0&&(delete o.g[P],o.h--)))):o&&(o=J(o))&&(l=o.g[l.toString()],o=-1,l&&(o=ge(l,d,g,R)),(d=o>-1?l[o]:null)&&ye(d))}function ye(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[Q])ae(l.i,o);else{var d=o.type,g=o.proxy;l.removeEventListener?l.removeEventListener(d,g,o.capture):l.detachEvent?l.detachEvent(Te(d),g):l.addListener&&l.removeListener&&l.removeListener(g),(d=J(l))?(ae(d,o),d.h==0&&(d.src=null,l[_e]=null)):G(o)}}}function Te(o){return o in fe?fe[o]:fe[o]="on"+o}function K(o,l){if(o.da)o=!0;else{l=new k(l,this);const d=o.listener,g=o.ha||o.src;o.fa&&ye(o),o=d.call(g,l)}return o}function J(o){return o=o[_e],o instanceof me?o:null}var Ie="__closure_events_fn_"+(Math.random()*1e9>>>0);function De(o){return typeof o=="function"?o:(o[Ie]||(o[Ie]=function(l){return o.handleEvent(l)}),o[Ie])}function re(){T.call(this),this.i=new me(this),this.M=this,this.G=null}m(re,T),re.prototype[Q]=!0,re.prototype.removeEventListener=function(o,l,d,g){se(this,o,l,d,g)};function ce(o,l){var d,g=o.G;if(g)for(d=[];g;g=g.G)d.push(g);if(o=o.M,g=l.type||l,typeof l=="string")l=new b(l,o);else if(l instanceof b)l.target=l.target||o;else{var R=l;l=new b(g,o),B(l,R)}R=!0;let P,U;if(d)for(U=d.length-1;U>=0;U--)P=l.g=d[U],R=je(P,g,!0,l)&&R;if(P=l.g=o,R=je(P,g,!0,l)&&R,R=je(P,g,!1,l)&&R,d)for(U=0;U<d.length;U++)P=l.g=d[U],R=je(P,g,!1,l)&&R}re.prototype.N=function(){if(re.Z.N.call(this),this.i){var o=this.i;for(const l in o.g){const d=o.g[l];for(let g=0;g<d.length;g++)G(d[g]);delete o.g[l],o.h--}}this.G=null},re.prototype.J=function(o,l,d,g){return this.i.add(String(o),l,!1,d,g)},re.prototype.K=function(o,l,d,g){return this.i.add(String(o),l,!0,d,g)};function je(o,l,d,g){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();let R=!0;for(let P=0;P<l.length;++P){const U=l[P];if(U&&!U.da&&U.capture==d){const te=U.listener,Ue=U.ha||U.src;U.fa&&ae(o.i,U),R=te.call(Ue,g)!==!1&&R}}return R&&!g.defaultPrevented}function an(o,l){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=h(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(l)>2147483647?-1:a.setTimeout(o,l||0)}function gs(o){o.g=an(()=>{o.g=null,o.i&&(o.i=!1,gs(o))},o.l);const l=o.h;o.h=null,o.m.apply(null,l)}class op extends T{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:gs(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function mr(o){T.call(this),this.h=o,this.g={}}m(mr,T);var rc=[];function sc(o){be(o.g,function(l,d){this.g.hasOwnProperty(d)&&ye(l)},o),o.g={}}mr.prototype.N=function(){mr.Z.N.call(this),sc(this)},mr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Bi=a.JSON.stringify,ap=a.JSON.parse,cp=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function ic(){}function oc(){}var gr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function $i(){b.call(this,"d")}m($i,b);function qi(){b.call(this,"c")}m(qi,b);var cn={},ac=null;function ys(){return ac=ac||new re}cn.Ia="serverreachability";function cc(o){b.call(this,cn.Ia,o)}m(cc,b);function yr(o){const l=ys();ce(l,new cc(l))}cn.STAT_EVENT="statevent";function lc(o,l){b.call(this,cn.STAT_EVENT,o),this.stat=l}m(lc,b);function et(o){const l=ys();ce(l,new lc(l,o))}cn.Ja="timingevent";function uc(o,l){b.call(this,cn.Ja,o),this.size=l}m(uc,b);function _r(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},l)}function vr(){this.g=!0}vr.prototype.ua=function(){this.g=!1};function lp(o,l,d,g,R,P){o.info(function(){if(o.g)if(P){var U="",te=P.split("&");for(let ve=0;ve<te.length;ve++){var Ue=te[ve].split("=");if(Ue.length>1){const $e=Ue[0];Ue=Ue[1];const mt=$e.split("_");U=mt.length>=2&&mt[1]=="type"?U+($e+"="+Ue+"&"):U+($e+"=redacted&")}}}else U=null;else U=P;return"XMLHTTP REQ ("+g+") [attempt "+R+"]: "+l+`
`+d+`
`+U})}function up(o,l,d,g,R,P,U){o.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+R+"]: "+l+`
`+d+`
`+P+" "+U})}function Nn(o,l,d,g){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+dp(o,d)+(g?" "+g:"")})}function hp(o,l){o.info(function(){return"TIMEOUT: "+l})}vr.prototype.info=function(){};function dp(o,l){if(!o.g)return l;if(!l)return null;try{const P=JSON.parse(l);if(P){for(o=0;o<P.length;o++)if(Array.isArray(P[o])){var d=P[o];if(!(d.length<2)){var g=d[1];if(Array.isArray(g)&&!(g.length<1)){var R=g[0];if(R!="noop"&&R!="stop"&&R!="close")for(let U=1;U<g.length;U++)g[U]=""}}}}return Bi(P)}catch{return l}}var _s={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},hc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},dc;function zi(){}m(zi,ic),zi.prototype.g=function(){return new XMLHttpRequest},dc=new zi;function wr(o){return encodeURIComponent(String(o))}function fp(o){var l=1;o=o.split(":");const d=[];for(;l>0&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function Vt(o,l,d,g){this.j=o,this.i=l,this.l=d,this.S=g||1,this.V=new mr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new fc}function fc(){this.i=null,this.g="",this.h=!1}var pc={},Hi={};function Gi(o,l,d){o.M=1,o.A=ws(pt(l)),o.u=d,o.R=!0,mc(o,null)}function mc(o,l){o.F=Date.now(),vs(o),o.B=pt(o.A);var d=o.B,g=o.S;Array.isArray(g)||(g=[String(g)]),Rc(d.i,"t",g),o.C=0,d=o.j.L,o.h=new fc,o.g=Gc(o.j,d?l:null,!o.u),o.P>0&&(o.O=new op(h(o.Y,o,o.g),o.P)),l=o.V,d=o.g,g=o.ba;var R="readystatechange";Array.isArray(R)||(R&&(rc[0]=R.toString()),R=rc);for(let P=0;P<R.length;P++){const U=we(d,R[P],g||l.handleEvent,!1,l.h||l);if(!U)break;l.g[U.key]=U}l=o.J?Oe(o.J):{},o.u?(o.v||(o.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,l)):(o.v="GET",o.g.ea(o.B,o.v,null,l)),yr(),lp(o.i,o.v,o.B,o.l,o.S,o.u)}Vt.prototype.ba=function(o){o=o.target;const l=this.O;l&&Lt(o)==3?l.j():this.Y(o)},Vt.prototype.Y=function(o){try{if(o==this.g)e:{const te=Lt(this.g),Ue=this.g.ya(),ve=this.g.ca();if(!(te<3)&&(te!=3||this.g&&(this.h.h||this.g.la()||Vc(this.g)))){this.K||te!=4||Ue==7||(Ue==8||ve<=0?yr(3):yr(2)),Wi(this);var l=this.g.ca();this.X=l;var d=pp(this);if(this.o=l==200,up(this.i,this.v,this.B,this.l,this.S,te,l),this.o){if(this.U&&!this.L){t:{if(this.g){var g,R=this.g;if((g=R.g?R.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(g)){var P=g;break t}}P=null}if(o=P)Nn(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ki(this,o);else{this.o=!1,this.m=3,et(12),ln(this),br(this);break e}}if(this.R){o=!0;let $e;for(;!this.K&&this.C<d.length;)if($e=mp(this,d),$e==Hi){te==4&&(this.m=4,et(14),o=!1),Nn(this.i,this.l,null,"[Incomplete Response]");break}else if($e==pc){this.m=4,et(15),Nn(this.i,this.l,d,"[Invalid Chunk]"),o=!1;break}else Nn(this.i,this.l,$e,null),Ki(this,$e);if(gc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),te!=4||d.length!=0||this.h.h||(this.m=1,et(16),o=!1),this.o=this.o&&o,!o)Nn(this.i,this.l,d,"[Invalid Chunked Response]"),ln(this),br(this);else if(d.length>0&&!this.W){this.W=!0;var U=this.j;U.g==this&&U.aa&&!U.P&&(U.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),no(U),U.P=!0,et(11))}}else Nn(this.i,this.l,d,null),Ki(this,d);te==4&&ln(this),this.o&&!this.K&&(te==4?$c(this.j,this):(this.o=!1,vs(this)))}else Cp(this.g),l==400&&d.indexOf("Unknown SID")>0?(this.m=3,et(12)):(this.m=0,et(13)),ln(this),br(this)}}}catch{}};function pp(o){if(!gc(o))return o.g.la();const l=Vc(o.g);if(l==="")return"";let d="";const g=l.length,R=Lt(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return ln(o),br(o),"";o.h.i=new a.TextDecoder}for(let P=0;P<g;P++)o.h.h=!0,d+=o.h.i.decode(l[P],{stream:!(R&&P==g-1)});return l.length=0,o.h.g+=d,o.C=0,o.h.g}function gc(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function mp(o,l){var d=o.C,g=l.indexOf(`
`,d);return g==-1?Hi:(d=Number(l.substring(d,g)),isNaN(d)?pc:(g+=1,g+d>l.length?Hi:(l=l.slice(g,g+d),o.C=g+d,l)))}Vt.prototype.cancel=function(){this.K=!0,ln(this)};function vs(o){o.T=Date.now()+o.H,yc(o,o.H)}function yc(o,l){if(o.D!=null)throw Error("WatchDog timer not null");o.D=_r(h(o.aa,o),l)}function Wi(o){o.D&&(a.clearTimeout(o.D),o.D=null)}Vt.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(hp(this.i,this.B),this.M!=2&&(yr(),et(17)),ln(this),this.m=2,br(this)):yc(this,this.T-o)};function br(o){o.j.I==0||o.K||$c(o.j,o)}function ln(o){Wi(o);var l=o.O;l&&typeof l.dispose=="function"&&l.dispose(),o.O=null,sc(o.V),o.g&&(l=o.g,o.g=null,l.abort(),l.dispose())}function Ki(o,l){try{var d=o.j;if(d.I!=0&&(d.g==o||Qi(d.h,o))){if(!o.L&&Qi(d.h,o)&&d.I==3){try{var g=d.Ba.g.parse(l)}catch{g=null}if(Array.isArray(g)&&g.length==3){var R=g;if(R[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<o.F)xs(d),Ts(d);else break e;to(d),et(18)}}else d.xa=R[1],0<d.xa-d.K&&R[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=_r(h(d.Va,d),6e3));wc(d.h)<=1&&d.ta&&(d.ta=void 0)}else hn(d,11)}else if((o.L||d.g==o)&&xs(d),!w(l))for(R=d.Ba.g.parse(l),l=0;l<R.length;l++){let ve=R[l];const $e=ve[0];if(!($e<=d.K))if(d.K=$e,ve=ve[1],d.I==2)if(ve[0]=="c"){d.M=ve[1],d.ba=ve[2];const mt=ve[3];mt!=null&&(d.ka=mt,d.j.info("VER="+d.ka));const dn=ve[4];dn!=null&&(d.za=dn,d.j.info("SVER="+d.za));const jt=ve[5];jt!=null&&typeof jt=="number"&&jt>0&&(g=1.5*jt,d.O=g,d.j.info("backChannelRequestTimeoutMs_="+g)),g=d;const Ut=o.g;if(Ut){const Ss=Ut.g?Ut.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ss){var P=g.h;P.g||Ss.indexOf("spdy")==-1&&Ss.indexOf("quic")==-1&&Ss.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Ji(P,P.h),P.h=null))}if(g.G){const ro=Ut.g?Ut.g.getResponseHeader("X-HTTP-Session-Id"):null;ro&&(g.wa=ro,xe(g.J,g.G,ro))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-o.F,d.j.info("Handshake RTT: "+d.T+"ms")),g=d;var U=o;if(g.na=Hc(g,g.L?g.ba:null,g.W),U.L){bc(g.h,U);var te=U,Ue=g.O;Ue&&(te.H=Ue),te.D&&(Wi(te),vs(te)),g.g=U}else Uc(g);d.i.length>0&&Is(d)}else ve[0]!="stop"&&ve[0]!="close"||hn(d,7);else d.I==3&&(ve[0]=="stop"||ve[0]=="close"?ve[0]=="stop"?hn(d,7):eo(d):ve[0]!="noop"&&d.l&&d.l.qa(ve),d.A=0)}}yr(4)}catch{}}var gp=class{constructor(o,l){this.g=o,this.map=l}};function _c(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function vc(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function wc(o){return o.h?1:o.g?o.g.size:0}function Qi(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function Ji(o,l){o.g?o.g.add(l):o.h=l}function bc(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}_c.prototype.cancel=function(){if(this.i=Ec(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Ec(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let l=o.i;for(const d of o.g.values())l=l.concat(d.G);return l}return S(o.i)}var Tc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function yp(o,l){if(o){o=o.split("&");for(let d=0;d<o.length;d++){const g=o[d].indexOf("=");let R,P=null;g>=0?(R=o[d].substring(0,g),P=o[d].substring(g+1)):R=o[d],l(R,P?decodeURIComponent(P.replace(/\+/g," ")):"")}}}function Mt(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let l;o instanceof Mt?(this.l=o.l,Er(this,o.j),this.o=o.o,this.g=o.g,Tr(this,o.u),this.h=o.h,Yi(this,Cc(o.i)),this.m=o.m):o&&(l=String(o).match(Tc))?(this.l=!1,Er(this,l[1]||"",!0),this.o=Ir(l[2]||""),this.g=Ir(l[3]||"",!0),Tr(this,l[4]),this.h=Ir(l[5]||"",!0),Yi(this,l[6]||"",!0),this.m=Ir(l[7]||"")):(this.l=!1,this.i=new Ar(null,this.l))}Mt.prototype.toString=function(){const o=[];var l=this.j;l&&o.push(xr(l,Ic,!0),":");var d=this.g;return(d||l=="file")&&(o.push("//"),(l=this.o)&&o.push(xr(l,Ic,!0),"@"),o.push(wr(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&o.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(xr(d,d.charAt(0)=="/"?wp:vp,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",xr(d,Ep)),o.join("")},Mt.prototype.resolve=function(o){const l=pt(this);let d=!!o.j;d?Er(l,o.j):d=!!o.o,d?l.o=o.o:d=!!o.g,d?l.g=o.g:d=o.u!=null;var g=o.h;if(d)Tr(l,o.u);else if(d=!!o.h){if(g.charAt(0)!="/")if(this.g&&!this.h)g="/"+g;else{var R=l.h.lastIndexOf("/");R!=-1&&(g=l.h.slice(0,R+1)+g)}if(R=g,R==".."||R==".")g="";else if(R.indexOf("./")!=-1||R.indexOf("/.")!=-1){g=R.lastIndexOf("/",0)==0,R=R.split("/");const P=[];for(let U=0;U<R.length;){const te=R[U++];te=="."?g&&U==R.length&&P.push(""):te==".."?((P.length>1||P.length==1&&P[0]!="")&&P.pop(),g&&U==R.length&&P.push("")):(P.push(te),g=!0)}g=P.join("/")}else g=R}return d?l.h=g:d=o.i.toString()!=="",d?Yi(l,Cc(o.i)):d=!!o.m,d&&(l.m=o.m),l};function pt(o){return new Mt(o)}function Er(o,l,d){o.j=d?Ir(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function Tr(o,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);o.u=l}else o.u=null}function Yi(o,l,d){l instanceof Ar?(o.i=l,Tp(o.i,o.l)):(d||(l=xr(l,bp)),o.i=new Ar(l,o.l))}function xe(o,l,d){o.i.set(l,d)}function ws(o){return xe(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function Ir(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function xr(o,l,d){return typeof o=="string"?(o=encodeURI(o).replace(l,_p),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function _p(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Ic=/[#\/\?@]/g,vp=/[#\?:]/g,wp=/[#\?]/g,bp=/[#\?@]/g,Ep=/#/g;function Ar(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function un(o){o.g||(o.g=new Map,o.h=0,o.i&&yp(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}n=Ar.prototype,n.add=function(o,l){un(this),this.i=null,o=kn(this,o);let d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this};function xc(o,l){un(o),l=kn(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function Ac(o,l){return un(o),l=kn(o,l),o.g.has(l)}n.forEach=function(o,l){un(this),this.g.forEach(function(d,g){d.forEach(function(R){o.call(l,R,g,this)},this)},this)};function Sc(o,l){un(o);let d=[];if(typeof l=="string")Ac(o,l)&&(d=d.concat(o.g.get(kn(o,l))));else for(o=Array.from(o.g.values()),l=0;l<o.length;l++)d=d.concat(o[l]);return d}n.set=function(o,l){return un(this),this.i=null,o=kn(this,o),Ac(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},n.get=function(o,l){return o?(o=Sc(this,o),o.length>0?String(o[0]):l):l};function Rc(o,l,d){xc(o,l),d.length>0&&(o.i=null,o.g.set(kn(o,l),S(d)),o.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],l=Array.from(this.g.keys());for(let g=0;g<l.length;g++){var d=l[g];const R=wr(d);d=Sc(this,d);for(let P=0;P<d.length;P++){let U=R;d[P]!==""&&(U+="="+wr(d[P])),o.push(U)}}return this.i=o.join("&")};function Cc(o){const l=new Ar;return l.i=o.i,o.g&&(l.g=new Map(o.g),l.h=o.h),l}function kn(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function Tp(o,l){l&&!o.j&&(un(o),o.i=null,o.g.forEach(function(d,g){const R=g.toLowerCase();g!=R&&(xc(this,g),Rc(this,R,d))},o)),o.j=l}function Ip(o,l){const d=new vr;if(a.Image){const g=new Image;g.onload=f(Ft,d,"TestLoadImage: loaded",!0,l,g),g.onerror=f(Ft,d,"TestLoadImage: error",!1,l,g),g.onabort=f(Ft,d,"TestLoadImage: abort",!1,l,g),g.ontimeout=f(Ft,d,"TestLoadImage: timeout",!1,l,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=o}else l(!1)}function xp(o,l){const d=new vr,g=new AbortController,R=setTimeout(()=>{g.abort(),Ft(d,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:g.signal}).then(P=>{clearTimeout(R),P.ok?Ft(d,"TestPingServer: ok",!0,l):Ft(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(R),Ft(d,"TestPingServer: error",!1,l)})}function Ft(o,l,d,g,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),g(d)}catch{}}function Ap(){this.g=new cp}function Xi(o){this.i=o.Sb||null,this.h=o.ab||!1}m(Xi,ic),Xi.prototype.g=function(){return new bs(this.i,this.h)};function bs(o,l){re.call(this),this.H=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(bs,re),n=bs.prototype,n.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=l,this.readyState=1,Rr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(l.body=o),(this.H||a).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Sr(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Rr(this)),this.g&&(this.readyState=3,Rr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Pc(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function Pc(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?Sr(this):Rr(this),this.readyState==3&&Pc(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,Sr(this))},n.Na=function(o){this.g&&(this.response=o,Sr(this))},n.ga=function(){this.g&&Sr(this)};function Sr(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Rr(o)}n.setRequestHeader=function(o,l){this.A.append(o,l)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=l.next();return o.join(`\r
`)};function Rr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(bs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Nc(o){let l="";return be(o,function(d,g){l+=g,l+=":",l+=d,l+=`\r
`}),l}function Zi(o,l,d){e:{for(g in d){var g=!1;break e}g=!0}g||(d=Nc(d),typeof o=="string"?d!=null&&wr(d):xe(o,l,d))}function Ce(o){re.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(Ce,re);var Sp=/^https?$/i,Rp=["POST","PUT"];n=Ce.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,l,d,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():dc.g(),this.g.onreadystatechange=v(h(this.Ca,this));try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(P){kc(this,P);return}if(o=d||"",d=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var R in g)d.set(R,g[R]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(const P of g.keys())d.set(P,g.get(P));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(d.keys()).find(P=>P.toLowerCase()=="content-type"),R=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(Rp,l,void 0)>=0)||g||R||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[P,U]of d)this.g.setRequestHeader(P,U);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(P){kc(this,P)}};function kc(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.o=5,Oc(o),Es(o)}function Oc(o){o.A||(o.A=!0,ce(o,"complete"),ce(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,ce(this,"complete"),ce(this,"abort"),Es(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Es(this,!0)),Ce.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Dc(this):this.Xa())},n.Xa=function(){Dc(this)};function Dc(o){if(o.h&&typeof i<"u"){if(o.v&&Lt(o)==4)setTimeout(o.Ca.bind(o),0);else if(ce(o,"readystatechange"),Lt(o)==4){o.h=!1;try{const P=o.ca();e:switch(P){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var g;if(g=P===0){let U=String(o.D).match(Tc)[1]||null;!U&&a.self&&a.self.location&&(U=a.self.location.protocol.slice(0,-1)),g=!Sp.test(U?U.toLowerCase():"")}d=g}if(d)ce(o,"complete"),ce(o,"success");else{o.o=6;try{var R=Lt(o)>2?o.g.statusText:""}catch{R=""}o.l=R+" ["+o.ca()+"]",Oc(o)}}finally{Es(o)}}}}function Es(o,l){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const d=o.g;o.g=null,l||ce(o,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Lt(o){return o.g?o.g.readyState:0}n.ca=function(){try{return Lt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),ap(l)}};function Vc(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Cp(o){const l={};o=(o.g&&Lt(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<o.length;g++){if(w(o[g]))continue;var d=fp(o[g]);const R=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const P=l[R]||[];l[R]=P,P.push(d)}At(l,function(g){return g.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Cr(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function Mc(o){this.za=0,this.i=[],this.j=new vr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Cr("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Cr("baseRetryDelayMs",5e3,o),this.Za=Cr("retryDelaySeedMs",1e4,o),this.Ta=Cr("forwardChannelMaxRetries",2,o),this.va=Cr("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new _c(o&&o.concurrentRequestLimit),this.Ba=new Ap,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Mc.prototype,n.ka=8,n.I=1,n.connect=function(o,l,d,g){et(0),this.W=o,this.H=l||{},d&&g!==void 0&&(this.H.OSID=d,this.H.OAID=g),this.F=this.X,this.J=Hc(this,null,this.W),Is(this)};function eo(o){if(Fc(o),o.I==3){var l=o.V++,d=pt(o.J);if(xe(d,"SID",o.M),xe(d,"RID",l),xe(d,"TYPE","terminate"),Pr(o,d),l=new Vt(o,o.j,l),l.M=2,l.A=ws(pt(d)),d=!1,a.navigator&&a.navigator.sendBeacon)try{d=a.navigator.sendBeacon(l.A.toString(),"")}catch{}!d&&a.Image&&(new Image().src=l.A,d=!0),d||(l.g=Gc(l.j,null),l.g.ea(l.A)),l.F=Date.now(),vs(l)}zc(o)}function Ts(o){o.g&&(no(o),o.g.cancel(),o.g=null)}function Fc(o){Ts(o),o.v&&(a.clearTimeout(o.v),o.v=null),xs(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function Is(o){if(!vc(o.h)&&!o.m){o.m=!0;var l=o.Ea;$||_(),H||($(),H=!0),E.add(l,o),o.D=0}}function Pp(o,l){return wc(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=l.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=_r(h(o.Ea,o,l),qc(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const R=new Vt(this,this.j,o);let P=this.o;if(this.U&&(P?(P=Oe(P),B(P,this.U)):P=this.U),this.u!==null||this.R||(R.J=P,P=null),this.S)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var g=this.i[d];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(l+=g,l>4096){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=jc(this,R,l),d=pt(this.J),xe(d,"RID",o),xe(d,"CVER",22),this.G&&xe(d,"X-HTTP-Session-Id",this.G),Pr(this,d),P&&(this.R?l="headers="+wr(Nc(P))+"&"+l:this.u&&Zi(d,this.u,P)),Ji(this.h,R),this.Ra&&xe(d,"TYPE","init"),this.S?(xe(d,"$req",l),xe(d,"SID","null"),R.U=!0,Gi(R,d,null)):Gi(R,d,l),this.I=2}}else this.I==3&&(o?Lc(this,o):this.i.length==0||vc(this.h)||Lc(this))};function Lc(o,l){var d;l?d=l.l:d=o.V++;const g=pt(o.J);xe(g,"SID",o.M),xe(g,"RID",d),xe(g,"AID",o.K),Pr(o,g),o.u&&o.o&&Zi(g,o.u,o.o),d=new Vt(o,o.j,d,o.D+1),o.u===null&&(d.J=o.o),l&&(o.i=l.G.concat(o.i)),l=jc(o,d,1e3),d.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Ji(o.h,d),Gi(d,g,l)}function Pr(o,l){o.H&&be(o.H,function(d,g){xe(l,g,d)}),o.l&&be({},function(d,g){xe(l,g,d)})}function jc(o,l,d){d=Math.min(o.i.length,d);const g=o.l?h(o.l.Ka,o.l,o):null;e:{var R=o.i;let te=-1;for(;;){const Ue=["count="+d];te==-1?d>0?(te=R[0].g,Ue.push("ofs="+te)):te=0:Ue.push("ofs="+te);let ve=!0;for(let $e=0;$e<d;$e++){var P=R[$e].g;const mt=R[$e].map;if(P-=te,P<0)te=Math.max(0,R[$e].g-100),ve=!1;else try{P="req"+P+"_"||"";try{var U=mt instanceof Map?mt:Object.entries(mt);for(const[dn,jt]of U){let Ut=jt;c(jt)&&(Ut=Bi(jt)),Ue.push(P+dn+"="+encodeURIComponent(Ut))}}catch(dn){throw Ue.push(P+"type="+encodeURIComponent("_badmap")),dn}}catch{g&&g(mt)}}if(ve){U=Ue.join("&");break e}}U=void 0}return o=o.i.splice(0,d),l.G=o,U}function Uc(o){if(!o.g&&!o.v){o.Y=1;var l=o.Da;$||_(),H||($(),H=!0),E.add(l,o),o.A=0}}function to(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=_r(h(o.Da,o),qc(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,Bc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=_r(h(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,et(10),Ts(this),Bc(this))};function no(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function Bc(o){o.g=new Vt(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var l=pt(o.na);xe(l,"RID","rpc"),xe(l,"SID",o.M),xe(l,"AID",o.K),xe(l,"CI",o.F?"0":"1"),!o.F&&o.ia&&xe(l,"TO",o.ia),xe(l,"TYPE","xmlhttp"),Pr(o,l),o.u&&o.o&&Zi(l,o.u,o.o),o.O&&(o.g.H=o.O);var d=o.g;o=o.ba,d.M=1,d.A=ws(pt(l)),d.u=null,d.R=!0,mc(d,o)}n.Va=function(){this.C!=null&&(this.C=null,Ts(this),to(this),et(19))};function xs(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function $c(o,l){var d=null;if(o.g==l){xs(o),no(o),o.g=null;var g=2}else if(Qi(o.h,l))d=l.G,bc(o.h,l),g=1;else return;if(o.I!=0){if(l.o)if(g==1){d=l.u?l.u.length:0,l=Date.now()-l.F;var R=o.D;g=ys(),ce(g,new uc(g,d)),Is(o)}else Uc(o);else if(R=l.m,R==3||R==0&&l.X>0||!(g==1&&Pp(o,l)||g==2&&to(o)))switch(d&&d.length>0&&(l=o.h,l.i=l.i.concat(d)),R){case 1:hn(o,5);break;case 4:hn(o,10);break;case 3:hn(o,6);break;default:hn(o,2)}}}function qc(o,l){let d=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(d*=2),d*l}function hn(o,l){if(o.j.info("Error code "+l),l==2){var d=h(o.bb,o),g=o.Ua;const R=!g;g=new Mt(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Er(g,"https"),ws(g),R?Ip(g.toString(),d):xp(g.toString(),d)}else et(2);o.I=0,o.l&&o.l.pa(l),zc(o),Fc(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),et(2)):(this.j.info("Failed to ping google.com"),et(1))};function zc(o){if(o.I=0,o.ja=[],o.l){const l=Ec(o.h);(l.length!=0||o.i.length!=0)&&(x(o.ja,l),x(o.ja,o.i),o.h.i.length=0,S(o.i),o.i.length=0),o.l.oa()}}function Hc(o,l,d){var g=d instanceof Mt?pt(d):new Mt(d);if(g.g!="")l&&(g.g=l+"."+g.g),Tr(g,g.u);else{var R=a.location;g=R.protocol,l=l?l+"."+R.hostname:R.hostname,R=+R.port;const P=new Mt(null);g&&Er(P,g),l&&(P.g=l),R&&Tr(P,R),d&&(P.h=d),g=P}return d=o.G,l=o.wa,d&&l&&xe(g,d,l),xe(g,"VER",o.ka),Pr(o,g),g}function Gc(o,l,d){if(l&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Aa&&!o.ma?new Ce(new Xi({ab:d})):new Ce(o.ma),l.Fa(o.L),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Wc(){}n=Wc.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function As(){}As.prototype.g=function(o,l){return new ot(o,l)};function ot(o,l){re.call(this),this.g=new Mc(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(o?o["X-WebChannel-Client-Profile"]=l.sa:o={"X-WebChannel-Client-Profile":l.sa}),this.g.U=o,(o=l&&l.Qb)&&!w(o)&&(this.g.u=o),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!w(l)&&(this.g.G=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new On(this)}m(ot,re),ot.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ot.prototype.close=function(){eo(this.g)},ot.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.v&&(d={},d.__data__=Bi(o),o=d);l.i.push(new gp(l.Ya++,o)),l.I==3&&Is(l)},ot.prototype.N=function(){this.g.l=null,delete this.j,eo(this.g),delete this.g,ot.Z.N.call(this)};function Kc(o){$i.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(const d in l){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}m(Kc,$i);function Qc(){qi.call(this),this.status=1}m(Qc,qi);function On(o){this.g=o}m(On,Wc),On.prototype.ra=function(){ce(this.g,"a")},On.prototype.qa=function(o){ce(this.g,new Kc(o))},On.prototype.pa=function(o){ce(this.g,new Qc)},On.prototype.oa=function(){ce(this.g,"b")},As.prototype.createWebChannel=As.prototype.g,ot.prototype.send=ot.prototype.o,ot.prototype.open=ot.prototype.m,ot.prototype.close=ot.prototype.close,dd=function(){return new As},hd=function(){return ys()},ud=cn,Uo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},_s.NO_ERROR=0,_s.TIMEOUT=8,_s.HTTP_ERROR=6,zs=_s,hc.COMPLETE="complete",ld=hc,oc.EventType=gr,gr.OPEN="a",gr.CLOSE="b",gr.ERROR="c",gr.MESSAGE="d",re.prototype.listen=re.prototype.J,Vr=oc,Ce.prototype.listenOnce=Ce.prototype.K,Ce.prototype.getLastError=Ce.prototype.Ha,Ce.prototype.getLastErrorCode=Ce.prototype.ya,Ce.prototype.getStatus=Ce.prototype.ca,Ce.prototype.getResponseJson=Ce.prototype.La,Ce.prototype.getResponseText=Ce.prototype.la,Ce.prototype.send=Ce.prototype.ea,Ce.prototype.setWithCredentials=Ce.prototype.Fa,cd=Ce}).apply(typeof ks<"u"?ks:typeof self<"u"?self:typeof window<"u"?window:{});class Qe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Qe.UNAUTHENTICATED=new Qe(null),Qe.GOOGLE_CREDENTIALS=new Qe("google-credentials-uid"),Qe.FIRST_PARTY=new Qe("first-party-uid"),Qe.MOCK_USER=new Qe("mock-user");let lr="12.9.0";function Sv(n){lr=n}const An=new _a("@firebase/firestore");function Mn(){return An.logLevel}function q(n,...e){if(An.logLevel<=ie.DEBUG){const t=e.map(ba);An.debug(`Firestore (${lr}): ${n}`,...t)}}function Nt(n,...e){if(An.logLevel<=ie.ERROR){const t=e.map(ba);An.error(`Firestore (${lr}): ${n}`,...t)}}function Sn(n,...e){if(An.logLevel<=ie.WARN){const t=e.map(ba);An.warn(`Firestore (${lr}): ${n}`,...t)}}function ba(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function ee(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,fd(n,r,t)}function fd(n,e,t){let r=`FIRESTORE (${lr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Nt(r),new Error(r)}function Re(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||fd(e,s,r)}function he(n,e){return n}const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class z extends Dt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class vn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class pd{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Rv{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Qe.UNAUTHENTICATED)))}shutdown(){}}class Cv{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Pv{constructor(e){this.t=e,this.currentUser=Qe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Re(this.o===void 0,42304);let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let i=new vn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new vn,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const u=i;e.enqueueRetryable((async()=>{await u.promise,await s(this.currentUser)}))},c=u=>{q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>c(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(q("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new vn)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Re(typeof r.accessToken=="string",31837,{l:r}),new pd(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Re(e===null||typeof e=="string",2055,{h:e}),new Qe(e)}}class Nv{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Qe.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class kv{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Nv(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Qe.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Wl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ov{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,vt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Re(this.o===void 0,3512);const r=i=>{i.error!=null&&q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,q("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Wl(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Re(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Wl(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Dv(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class md{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Dv(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function le(n,e){return n<e?-1:n>e?1:0}function Bo(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return go(s)===go(i)?le(s,i):go(s)?1:-1}return le(n.length,e.length)}const Vv=55296,Mv=57343;function go(n){const e=n.charCodeAt(0);return e>=Vv&&e<=Mv}function Xn(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const Kl="__name__";class _t{constructor(e,t,r){t===void 0?t=0:t>e.length&&ee(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ee(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return _t.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof _t?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=_t.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return le(e.length,t.length)}static compareSegments(e,t){const r=_t.isNumericId(e),s=_t.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?_t.extractNumericId(e).compare(_t.extractNumericId(t)):Bo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Zt.fromString(e.substring(4,e.length-2))}}class Ae extends _t{construct(e,t,r){return new Ae(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new z(V.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new Ae(t)}static emptyPath(){return new Ae([])}}const Fv=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Xe extends _t{construct(e,t,r){return new Xe(e,t,r)}static isValidIdentifier(e){return Fv.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xe.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Kl}static keyField(){return new Xe([Kl])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new z(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new z(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new z(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(r+=c,s++):(i(),s++)}if(i(),a)throw new z(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Xe(t)}static emptyPath(){return new Xe([])}}class W{constructor(e){this.path=e}static fromPath(e){return new W(Ae.fromString(e))}static fromName(e){return new W(Ae.fromString(e).popFirst(5))}static empty(){return new W(Ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new W(new Ae(e.slice()))}}function Lv(n,e,t,r){if(e===!0&&r===!0)throw new z(V.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Ql(n){if(W.isDocumentKey(n))throw new z(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function gd(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ai(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ee(12329,{type:typeof n})}function $o(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new z(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ai(n);throw new z(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Fe(n,e){const t={typeString:n};return e&&(t.value=e),t}function cs(n,e){if(!gd(n))throw new z(V.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new z(V.INVALID_ARGUMENT,t);return!0}const Jl=-62135596800,Yl=1e6;class Se{static now(){return Se.fromMillis(Date.now())}static fromDate(e){return Se.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Yl);return new Se(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new z(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new z(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Jl)throw new z(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new z(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Yl}_compareTo(e){return this.seconds===e.seconds?le(this.nanoseconds,e.nanoseconds):le(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Se._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(cs(e,Se._jsonSchema))return new Se(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Jl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Se._jsonSchemaVersion="firestore/timestamp/1.0",Se._jsonSchema={type:Fe("string",Se._jsonSchemaVersion),seconds:Fe("number"),nanoseconds:Fe("number")};class Z{static fromTimestamp(e){return new Z(e)}static min(){return new Z(new Se(0,0))}static max(){return new Z(new Se(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Kr=-1;function jv(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Z.fromTimestamp(r===1e9?new Se(t+1,0):new Se(t,r));return new en(s,W.empty(),e)}function Uv(n){return new en(n.readTime,n.key,Kr)}class en{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new en(Z.min(),W.empty(),Kr)}static max(){return new en(Z.max(),W.empty(),Kr)}}function Bv(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=W.comparator(n.documentKey,e.documentKey),t!==0?t:le(n.largestBatchId,e.largestBatchId))}const $v="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class qv{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Si(n){if(n.code!==V.FAILED_PRECONDITION||n.message!==$v)throw n;q("LocalStore","Unexpectedly lost primary lease")}class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ee(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new O(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof O?t:O.resolve(t)}catch(t){return O.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):O.reject(t)}static resolve(e){return new O(((t,r)=>{t(e)}))}static reject(e){return new O(((t,r)=>{r(e)}))}static waitFor(e){return new O(((t,r)=>{let s=0,i=0,a=!1;e.forEach((c=>{++s,c.next((()=>{++i,a&&i===s&&t()}),(u=>r(u)))})),a=!0,i===s&&t()}))}static or(e){let t=O.resolve(!1);for(const r of e)t=t.next((s=>s?O.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new O(((r,s)=>{const i=e.length,a=new Array(i);let c=0;for(let u=0;u<i;u++){const h=u;t(e[h]).next((f=>{a[h]=f,++c,c===i&&r(a)}),(f=>s(f)))}}))}static doWhile(e,t){return new O(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}function zv(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function ur(n){return n.name==="IndexedDbTransactionError"}class Ri{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ri.ce=-1;const Hv=-1;function Ci(n){return n==null}function ri(n){return n===0&&1/n==-1/0}function Gv(n){return typeof n=="number"&&Number.isInteger(n)&&!ri(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const yd="";function Wv(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Xl(e)),e=Kv(n.get(t),e);return Xl(e)}function Kv(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case yd:t+="";break;default:t+=i}}return t}function Xl(n){return n+yd+""}function Zl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function hr(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function _d(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ke{constructor(e,t){this.comparator=e,this.root=t||ze.EMPTY}insert(e,t){return new ke(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ze.BLACK,null,null))}remove(e){return new ke(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ze.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Os(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Os(this.root,e,this.comparator,!1)}getReverseIterator(){return new Os(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Os(this.root,e,this.comparator,!0)}}class Os{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ze{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??ze.RED,this.left=s??ze.EMPTY,this.right=i??ze.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new ze(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ze.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return ze.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ze.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ze.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ee(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ee(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ee(27949);return e+(this.isRed()?0:1)}}ze.EMPTY=null,ze.RED=!0,ze.BLACK=!1;ze.EMPTY=new class{constructor(){this.size=0}get key(){throw ee(57766)}get value(){throw ee(16141)}get color(){throw ee(16727)}get left(){throw ee(29726)}get right(){throw ee(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new ze(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Be{constructor(e){this.comparator=e,this.data=new ke(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new eu(this.data.getIterator())}getIteratorFrom(e){return new eu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof Be)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Be(this.comparator);return t.data=e,t}}class eu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Wt{constructor(e){this.fields=e,e.sort(Xe.comparator)}static empty(){return new Wt([])}unionWith(e){let t=new Be(Xe.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Wt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Xn(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class vd extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class We{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new vd("Invalid base64 string: "+i):i}})(e);return new We(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(e);return new We(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return le(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}We.EMPTY_BYTE_STRING=new We("");const Qv=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tn(n){if(Re(!!n,39018),typeof n=="string"){let e=0;const t=Qv.exec(n);if(Re(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Pe(n.seconds),nanos:Pe(n.nanos)}}function Pe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function nn(n){return typeof n=="string"?We.fromBase64String(n):We.fromUint8Array(n)}const wd="server_timestamp",bd="__type__",Ed="__previous_value__",Td="__local_write_time__";function Ea(n){return(n?.mapValue?.fields||{})[bd]?.stringValue===wd}function Pi(n){const e=n.mapValue.fields[Ed];return Ea(e)?Pi(e):e}function Qr(n){const e=tn(n.mapValue.fields[Td].timestampValue);return new Se(e.seconds,e.nanos)}class Jv{constructor(e,t,r,s,i,a,c,u,h,f,m){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=f,this.apiKey=m}}const si="(default)";class Jr{constructor(e,t){this.projectId=e,this.database=t||si}static empty(){return new Jr("","")}get isDefaultDatabase(){return this.database===si}isEqual(e){return e instanceof Jr&&e.projectId===this.projectId&&e.database===this.database}}function Yv(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new z(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Jr(n.options.projectId,e)}const Id="__type__",Xv="__max__",Ds={mapValue:{}},xd="__vector__",ii="value";function rn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ea(n)?4:ew(n)?9007199254740991:Zv(n)?10:11:ee(28295,{value:n})}function xt(n,e){if(n===e)return!0;const t=rn(n);if(t!==rn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Qr(n).isEqual(Qr(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=tn(s.timestampValue),c=tn(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return nn(s.bytesValue).isEqual(nn(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return Pe(s.geoPointValue.latitude)===Pe(i.geoPointValue.latitude)&&Pe(s.geoPointValue.longitude)===Pe(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return Pe(s.integerValue)===Pe(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=Pe(s.doubleValue),c=Pe(i.doubleValue);return a===c?ri(a)===ri(c):isNaN(a)&&isNaN(c)}return!1})(n,e);case 9:return Xn(n.arrayValue.values||[],e.arrayValue.values||[],xt);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},c=i.mapValue.fields||{};if(Zl(a)!==Zl(c))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(c[u]===void 0||!xt(a[u],c[u])))return!1;return!0})(n,e);default:return ee(52216,{left:n})}}function Yr(n,e){return(n.values||[]).find((t=>xt(t,e)))!==void 0}function Zn(n,e){if(n===e)return 0;const t=rn(n),r=rn(e);if(t!==r)return le(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return le(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const c=Pe(i.integerValue||i.doubleValue),u=Pe(a.integerValue||a.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1})(n,e);case 3:return tu(n.timestampValue,e.timestampValue);case 4:return tu(Qr(n),Qr(e));case 5:return Bo(n.stringValue,e.stringValue);case 6:return(function(i,a){const c=nn(i),u=nn(a);return c.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const c=i.split("/"),u=a.split("/");for(let h=0;h<c.length&&h<u.length;h++){const f=le(c[h],u[h]);if(f!==0)return f}return le(c.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const c=le(Pe(i.latitude),Pe(a.latitude));return c!==0?c:le(Pe(i.longitude),Pe(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return nu(n.arrayValue,e.arrayValue);case 10:return(function(i,a){const c=i.fields||{},u=a.fields||{},h=c[ii]?.arrayValue,f=u[ii]?.arrayValue,m=le(h?.values?.length||0,f?.values?.length||0);return m!==0?m:nu(h,f)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===Ds.mapValue&&a===Ds.mapValue)return 0;if(i===Ds.mapValue)return 1;if(a===Ds.mapValue)return-1;const c=i.fields||{},u=Object.keys(c),h=a.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){const v=Bo(u[m],f[m]);if(v!==0)return v;const S=Zn(c[u[m]],h[f[m]]);if(S!==0)return S}return le(u.length,f.length)})(n.mapValue,e.mapValue);default:throw ee(23264,{he:t})}}function tu(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return le(n,e);const t=tn(n),r=tn(e),s=le(t.seconds,r.seconds);return s!==0?s:le(t.nanos,r.nanos)}function nu(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Zn(t[s],r[s]);if(i)return i}return le(t.length,r.length)}function er(n){return qo(n)}function qo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=tn(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return nn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return W.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=qo(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${qo(t.fields[a])}`;return s+"}"})(n.mapValue):ee(61005,{value:n})}function Hs(n){switch(rn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Pi(n);return e?16+Hs(e):16;case 5:return 2*n.stringValue.length;case 6:return nn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+Hs(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return hr(r.fields,((i,a)=>{s+=i.length+Hs(a)})),s})(n.mapValue);default:throw ee(13486,{value:n})}}function ru(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function zo(n){return!!n&&"integerValue"in n}function Ta(n){return!!n&&"arrayValue"in n}function su(n){return!!n&&"nullValue"in n}function iu(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function yo(n){return!!n&&"mapValue"in n}function Zv(n){return(n?.mapValue?.fields||{})[Id]?.stringValue===xd}function Ur(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return hr(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Ur(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ur(n.arrayValue.values[t]);return e}return{...n}}function ew(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Xv}class wt{constructor(e){this.value=e}static empty(){return new wt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!yo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ur(t)}setAll(e){let t=Xe.emptyPath(),r={},s=[];e.forEach(((a,c)=>{if(!t.isImmediateParentOf(c)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=c.popLast()}a?r[c.lastSegment()]=Ur(a):s.push(c.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());yo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return xt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];yo(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){hr(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new wt(Ur(this.value))}}class Je{constructor(e,t,r,s,i,a,c){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(e){return new Je(e,0,Z.min(),Z.min(),Z.min(),wt.empty(),0)}static newFoundDocument(e,t,r,s){return new Je(e,1,t,Z.min(),r,s,0)}static newNoDocument(e,t){return new Je(e,2,t,Z.min(),Z.min(),wt.empty(),0)}static newUnknownDocument(e,t){return new Je(e,3,t,Z.min(),Z.min(),wt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=wt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=wt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Je&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Je(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class oi{constructor(e,t){this.position=e,this.inclusive=t}}function ou(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=W.comparator(W.fromName(a.referenceValue),t.key):r=Zn(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function au(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!xt(n.position[t],e.position[t]))return!1;return!0}class ai{constructor(e,t="asc"){this.field=e,this.dir=t}}function tw(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Ad{}class Me extends Ad{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new rw(e,t,r):t==="array-contains"?new ow(e,r):t==="in"?new aw(e,r):t==="not-in"?new cw(e,r):t==="array-contains-any"?new lw(e,r):new Me(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new sw(e,r):new iw(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Zn(t,this.value)):t!==null&&rn(this.value)===rn(t)&&this.matchesComparison(Zn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ee(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class dt extends Ad{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new dt(e,t)}matches(e){return Sd(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Sd(n){return n.op==="and"}function Rd(n){return nw(n)&&Sd(n)}function nw(n){for(const e of n.filters)if(e instanceof dt)return!1;return!0}function Ho(n){if(n instanceof Me)return n.field.canonicalString()+n.op.toString()+er(n.value);if(Rd(n))return n.filters.map((e=>Ho(e))).join(",");{const e=n.filters.map((t=>Ho(t))).join(",");return`${n.op}(${e})`}}function Cd(n,e){return n instanceof Me?(function(r,s){return s instanceof Me&&r.op===s.op&&r.field.isEqual(s.field)&&xt(r.value,s.value)})(n,e):n instanceof dt?(function(r,s){return s instanceof dt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,a,c)=>i&&Cd(a,s.filters[c])),!0):!1})(n,e):void ee(19439)}function Pd(n){return n instanceof Me?(function(t){return`${t.field.canonicalString()} ${t.op} ${er(t.value)}`})(n):n instanceof dt?(function(t){return t.op.toString()+" {"+t.getFilters().map(Pd).join(" ,")+"}"})(n):"Filter"}class rw extends Me{constructor(e,t,r){super(e,t,r),this.key=W.fromName(r.referenceValue)}matches(e){const t=W.comparator(e.key,this.key);return this.matchesComparison(t)}}class sw extends Me{constructor(e,t){super(e,"in",t),this.keys=Nd("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class iw extends Me{constructor(e,t){super(e,"not-in",t),this.keys=Nd("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Nd(n,e){return(e.arrayValue?.values||[]).map((t=>W.fromName(t.referenceValue)))}class ow extends Me{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ta(t)&&Yr(t.arrayValue,this.value)}}class aw extends Me{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Yr(this.value.arrayValue,t)}}class cw extends Me{constructor(e,t){super(e,"not-in",t)}matches(e){if(Yr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Yr(this.value.arrayValue,t)}}class lw extends Me{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ta(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Yr(this.value.arrayValue,r)))}}class uw{constructor(e,t=null,r=[],s=[],i=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.Te=null}}function cu(n,e=null,t=[],r=[],s=null,i=null,a=null){return new uw(n,e,t,r,s,i,a)}function Ia(n){const e=he(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>Ho(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),Ci(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>er(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>er(r))).join(",")),e.Te=t}return e.Te}function xa(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!tw(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Cd(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!au(n.startAt,e.startAt)&&au(n.endAt,e.endAt)}function Go(n){return W.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class ls{constructor(e,t=null,r=[],s=[],i=null,a="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=u,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function hw(n,e,t,r,s,i,a,c){return new ls(n,e,t,r,s,i,a,c)}function kd(n){return new ls(n)}function lu(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function dw(n){return W.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Od(n){return n.collectionGroup!==null}function Br(n){const e=he(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new Be(Xe.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((h=>{h.isInequality()&&(c=c.add(h.field))}))})),c})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new ai(i,r))})),t.has(Xe.keyField().canonicalString())||e.Ie.push(new ai(Xe.keyField(),r))}return e.Ie}function bt(n){const e=he(n);return e.Ee||(e.Ee=fw(e,Br(n))),e.Ee}function fw(n,e){if(n.limitType==="F")return cu(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new ai(s.field,i)}));const t=n.endAt?new oi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new oi(n.startAt.position,n.startAt.inclusive):null;return cu(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Wo(n,e){const t=n.filters.concat([e]);return new ls(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ko(n,e,t){return new ls(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ni(n,e){return xa(bt(n),bt(e))&&n.limitType===e.limitType}function Dd(n){return`${Ia(bt(n))}|lt:${n.limitType}`}function Fn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>Pd(s))).join(", ")}]`),Ci(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>er(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>er(s))).join(",")),`Target(${r})`})(bt(n))}; limitType=${n.limitType})`}function ki(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):W.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of Br(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,c,u){const h=ou(a,c,u);return a.inclusive?h<=0:h<0})(r.startAt,Br(r),s)||r.endAt&&!(function(a,c,u){const h=ou(a,c,u);return a.inclusive?h>=0:h>0})(r.endAt,Br(r),s))})(n,e)}function pw(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Vd(n){return(e,t)=>{let r=!1;for(const s of Br(n)){const i=mw(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function mw(n,e,t){const r=n.field.isKeyField()?W.comparator(e.key,t.key):(function(i,a,c){const u=a.data.field(i),h=c.data.field(i);return u!==null&&h!==null?Zn(u,h):ee(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ee(19790,{direction:n.dir})}}class Pn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){hr(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return _d(this.inner)}size(){return this.innerSize}}const gw=new ke(W.comparator);function sn(){return gw}const Md=new ke(W.comparator);function Mr(...n){let e=Md;for(const t of n)e=e.insert(t.key,t);return e}function yw(n){let e=Md;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function yn(){return $r()}function Fd(){return $r()}function $r(){return new Pn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const _w=new Be(W.comparator);function de(...n){let e=_w;for(const t of n)e=e.add(t);return e}const vw=new Be(le);function ww(){return vw}function Aa(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ri(e)?"-0":e}}function Ld(n){return{integerValue:""+n}}function bw(n,e){return Gv(e)?Ld(e):Aa(n,e)}class Oi{constructor(){this._=void 0}}function Ew(n,e,t){return n instanceof Qo?(function(s,i){const a={fields:{[bd]:{stringValue:wd},[Td]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Ea(i)&&(i=Pi(i)),i&&(a.fields[Ed]=i),{mapValue:a}})(t,e):n instanceof ci?jd(n,e):n instanceof li?Ud(n,e):(function(s,i){const a=Iw(s,i),c=uu(a)+uu(s.Ae);return zo(a)&&zo(s.Ae)?Ld(c):Aa(s.serializer,c)})(n,e)}function Tw(n,e,t){return n instanceof ci?jd(n,e):n instanceof li?Ud(n,e):t}function Iw(n,e){return n instanceof Jo?(function(r){return zo(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class Qo extends Oi{}class ci extends Oi{constructor(e){super(),this.elements=e}}function jd(n,e){const t=Bd(e);for(const r of n.elements)t.some((s=>xt(s,r)))||t.push(r);return{arrayValue:{values:t}}}class li extends Oi{constructor(e){super(),this.elements=e}}function Ud(n,e){let t=Bd(e);for(const r of n.elements)t=t.filter((s=>!xt(s,r)));return{arrayValue:{values:t}}}class Jo extends Oi{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function uu(n){return Pe(n.integerValue||n.doubleValue)}function Bd(n){return Ta(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function xw(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof ci&&s instanceof ci||r instanceof li&&s instanceof li?Xn(r.elements,s.elements,xt):r instanceof Jo&&s instanceof Jo?xt(r.Ae,s.Ae):r instanceof Qo&&s instanceof Qo})(n.transform,e.transform)}class wn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new wn}static exists(e){return new wn(void 0,e)}static updateTime(e){return new wn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Gs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Sa{}function $d(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Sw(n.key,wn.none()):new Ra(n.key,n.data,wn.none());{const t=n.data,r=wt.empty();let s=new Be(Xe.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Di(n.key,r,new Wt(s.toArray()),wn.none())}}function Aw(n,e,t){n instanceof Ra?(function(s,i,a){const c=s.value.clone(),u=du(s.fieldTransforms,i,a.transformResults);c.setAll(u),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(n,e,t):n instanceof Di?(function(s,i,a){if(!Gs(s.precondition,i))return void i.convertToUnknownDocument(a.version);const c=du(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(qd(s)),u.setAll(c),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function qr(n,e,t,r){return n instanceof Ra?(function(i,a,c,u){if(!Gs(i.precondition,a))return c;const h=i.value.clone(),f=fu(i.fieldTransforms,u,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof Di?(function(i,a,c,u){if(!Gs(i.precondition,a))return c;const h=fu(i.fieldTransforms,u,a),f=a.data;return f.setAll(qd(i)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((m=>m.field)))})(n,e,t,r):(function(i,a,c){return Gs(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c})(n,e,t)}function hu(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Xn(r,s,((i,a)=>xw(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ra extends Sa{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Di extends Sa{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function qd(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function du(n,e,t){const r=new Map;Re(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,c=e.data.field(i.field);r.set(i.field,Tw(a,c,t[s]))}return r}function fu(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,Ew(i,a,e))}return r}class Sw extends Sa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Rw{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&Aw(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=qr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=qr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Fd();return this.mutations.forEach((s=>{const i=e.get(s.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=t.has(s.key)?null:c;const u=$d(a,c);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(Z.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),de())}isEqual(e){return this.batchId===e.batchId&&Xn(this.mutations,e.mutations,((t,r)=>hu(t,r)))&&Xn(this.baseMutations,e.baseMutations,((t,r)=>hu(t,r)))}}class Cw{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Pw{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ve,ue;function zd(n){if(n===void 0)return Nt("GRPC error has no .code"),V.UNKNOWN;switch(n){case Ve.OK:return V.OK;case Ve.CANCELLED:return V.CANCELLED;case Ve.UNKNOWN:return V.UNKNOWN;case Ve.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Ve.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Ve.INTERNAL:return V.INTERNAL;case Ve.UNAVAILABLE:return V.UNAVAILABLE;case Ve.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Ve.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Ve.NOT_FOUND:return V.NOT_FOUND;case Ve.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Ve.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Ve.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Ve.ABORTED:return V.ABORTED;case Ve.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Ve.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Ve.DATA_LOSS:return V.DATA_LOSS;default:return ee(39323,{code:n})}}(ue=Ve||(Ve={}))[ue.OK=0]="OK",ue[ue.CANCELLED=1]="CANCELLED",ue[ue.UNKNOWN=2]="UNKNOWN",ue[ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ue[ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ue[ue.NOT_FOUND=5]="NOT_FOUND",ue[ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",ue[ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",ue[ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",ue[ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ue[ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ue[ue.ABORTED=10]="ABORTED",ue[ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",ue[ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",ue[ue.INTERNAL=13]="INTERNAL",ue[ue.UNAVAILABLE=14]="UNAVAILABLE",ue[ue.DATA_LOSS=15]="DATA_LOSS";function Nw(){return new TextEncoder}const kw=new Zt([4294967295,4294967295],0);function pu(n){const e=Nw().encode(n),t=new ad;return t.update(e),new Uint8Array(t.digest())}function mu(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Zt([t,r],0),new Zt([s,i],0)]}class Ca{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Fr(`Invalid padding: ${t}`);if(r<0)throw new Fr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Fr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Fr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Zt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Zt.fromNumber(r)));return s.compare(kw)===1&&(s=new Zt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=pu(e),[r,s]=mu(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Ca(i,s,t);return r.forEach((c=>a.insert(c))),a}insert(e){if(this.ge===0)return;const t=pu(e),[r,s]=mu(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.be(a)}}be(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Fr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Vi{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,us.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Vi(Z.min(),s,new ke(le),sn(),de())}}class us{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new us(r,t,de(),de(),de())}}class Ws{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Hd{constructor(e,t){this.targetId=e,this.Ce=t}}class Gd{constructor(e,t,r=We.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class gu{constructor(){this.ve=0,this.Fe=yu(),this.Me=We.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=de(),t=de(),r=de();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ee(38017,{changeType:i})}})),new us(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=yu()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Re(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Ow{constructor(e){this.Ge=e,this.ze=new Map,this.je=sn(),this.He=Vs(),this.Je=Vs(),this.Ze=new ke(le)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ee(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(Go(i))if(r===0){const a=new W(i.path);this.et(t,a,Je.newNoDocument(a,Z.min()))}else Re(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const c=this.ut(e),u=c?this.ct(c,e,a):1;if(u!==0){this.it(t);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,c;try{a=nn(r).toUint8Array()}catch(u){if(u instanceof vd)return Sn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Ca(a,s,i)}catch(u){return Sn(u instanceof Fr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.ge===0?null:c}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const a=this.Ge.ht(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,a)=>{const c=this.ot(a);if(c){if(i.current&&Go(c.target)){const u=new W(c.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,Je.newNoDocument(u,e))}i.Be&&(t.set(a,i.ke()),i.Ke())}}));let r=de();this.Je.forEach(((i,a)=>{let c=!0;a.forEachWhile((u=>{const h=this.ot(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(r=r.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(e)));const s=new Vi(e,t,this.Ze,this.je,r);return this.je=sn(),this.He=Vs(),this.Je=Vs(),this.Ze=new ke(le),s}Ye(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new gu,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new Be(le),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new Be(le),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||q("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new gu),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Vs(){return new ke(W.comparator)}function yu(){return new ke(W.comparator)}const Dw={asc:"ASCENDING",desc:"DESCENDING"},Vw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Mw={and:"AND",or:"OR"};class Fw{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Yo(n,e){return n.useProto3Json||Ci(e)?e:{value:e}}function Xo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Wd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Bn(n){return Re(!!n,49232),Z.fromTimestamp((function(t){const r=tn(t);return new Se(r.seconds,r.nanos)})(n))}function Kd(n,e){return Zo(n,e).canonicalString()}function Zo(n,e){const t=(function(s){return new Ae(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Qd(n){const e=Ae.fromString(n);return Re(ef(e),10190,{key:e.toString()}),e}function _o(n,e){const t=Qd(e);if(t.get(1)!==n.databaseId.projectId)throw new z(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new z(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new W(Yd(t))}function Jd(n,e){return Kd(n.databaseId,e)}function Lw(n){const e=Qd(n);return e.length===4?Ae.emptyPath():Yd(e)}function _u(n){return new Ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Yd(n){return Re(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function jw(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:ee(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(h,f){return h.useProto3Json?(Re(f===void 0||typeof f=="string",58123),We.fromBase64String(f||"")):(Re(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),We.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&(function(h){const f=h.code===void 0?V.UNKNOWN:zd(h.code);return new z(f,h.message||"")})(a);t=new Gd(r,s,i,c||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=_o(n,r.document.name),i=Bn(r.document.updateTime),a=r.document.createTime?Bn(r.document.createTime):Z.min(),c=new wt({mapValue:{fields:r.document.fields}}),u=Je.newFoundDocument(s,i,a,c),h=r.targetIds||[],f=r.removedTargetIds||[];t=new Ws(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=_o(n,r.document),i=r.readTime?Bn(r.readTime):Z.min(),a=Je.newNoDocument(s,i),c=r.removedTargetIds||[];t=new Ws([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=_o(n,r.document),i=r.removedTargetIds||[];t=new Ws([],i,s,null)}else{if(!("filter"in e))return ee(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new Pw(s,i),c=r.targetId;t=new Hd(c,a)}}return t}function Uw(n,e){return{documents:[Jd(n,e.path)]}}function Bw(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Jd(n,s);const i=(function(h){if(h.length!==0)return Zd(dt.create(h,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(h){if(h.length!==0)return h.map((f=>(function(v){return{field:Ln(v.field),direction:zw(v.dir)}})(f)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const c=Yo(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:s}}function $w(n){let e=Lw(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Re(r===1,65062);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=(function(m){const v=Xd(m);return v instanceof dt&&Rd(v)?v.getFilters():[v]})(t.where));let a=[];t.orderBy&&(a=(function(m){return m.map((v=>(function(x){return new ai(jn(x.field),(function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(x.direction))})(v)))})(t.orderBy));let c=null;t.limit&&(c=(function(m){let v;return v=typeof m=="object"?m.value:m,Ci(v)?null:v})(t.limit));let u=null;t.startAt&&(u=(function(m){const v=!!m.before,S=m.values||[];return new oi(S,v)})(t.startAt));let h=null;return t.endAt&&(h=(function(m){const v=!m.before,S=m.values||[];return new oi(S,v)})(t.endAt)),hw(e,s,a,i,c,"F",u,h)}function qw(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ee(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Xd(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=jn(t.unaryFilter.field);return Me.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=jn(t.unaryFilter.field);return Me.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=jn(t.unaryFilter.field);return Me.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=jn(t.unaryFilter.field);return Me.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ee(61313);default:return ee(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Me.create(jn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ee(58110);default:return ee(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return dt.create(t.compositeFilter.filters.map((r=>Xd(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ee(1026)}})(t.compositeFilter.op))})(n):ee(30097,{filter:n})}function zw(n){return Dw[n]}function Hw(n){return Vw[n]}function Gw(n){return Mw[n]}function Ln(n){return{fieldPath:n.canonicalString()}}function jn(n){return Xe.fromServerFormat(n.fieldPath)}function Zd(n){return n instanceof Me?(function(t){if(t.op==="=="){if(iu(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NAN"}};if(su(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(iu(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NOT_NAN"}};if(su(t.value))return{unaryFilter:{field:Ln(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ln(t.field),op:Hw(t.op),value:t.value}}})(n):n instanceof dt?(function(t){const r=t.getFilters().map((s=>Zd(s)));return r.length===1?r[0]:{compositeFilter:{op:Gw(t.op),filters:r}}})(n):ee(54877,{filter:n})}function ef(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function tf(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}class Kt{constructor(e,t,r,s,i=Z.min(),a=Z.min(),c=We.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new Kt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Kt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Kt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Kt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ww{constructor(e){this.yt=e}}function Kw(n){const e=$w({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ko(e,e.limit,"L"):e}class Qw{constructor(){this.Sn=new Jw}addToCollectionParentIndex(e,t){return this.Sn.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(en.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(en.min())}updateCollectionGroup(e,t,r){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class Jw{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Be(Ae.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Be(Ae.comparator)).toArray()}}const vu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},nf=41943040;class rt{static withCacheSize(e){return new rt(e,rt.DEFAULT_COLLECTION_PERCENTILE,rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}rt.DEFAULT_COLLECTION_PERCENTILE=10,rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,rt.DEFAULT=new rt(nf,rt.DEFAULT_COLLECTION_PERCENTILE,rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),rt.DISABLED=new rt(-1,0,0);class tr{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new tr(0)}static ar(){return new tr(-1)}}const wu="LruGarbageCollector",Yw=1048576;function bu([n,e],[t,r]){const s=le(n,t);return s===0?le(e,r):s}class Xw{constructor(e){this.Pr=e,this.buffer=new Be(bu),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();bu(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Zw{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){q(wu,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ur(t)?q(wu,"Ignoring IndexedDB error during garbage collection: ",t):await Si(t)}await this.Ar(3e5)}))}}class e0{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return O.resolve(Ri.ce);const r=new Xw(t);return this.Vr.forEachTarget(e,(s=>r.Er(s.sequenceNumber))).next((()=>this.Vr.mr(e,(s=>r.Er(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(q("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(vu)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(q("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vu):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,s,i,a,c,u,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(e,s)))).next((m=>(r=m,c=Date.now(),this.removeTargets(e,r,t)))).next((m=>(i=m,u=Date.now(),this.removeOrphanedDocuments(e,r)))).next((m=>(h=Date.now(),Mn()<=ie.DEBUG&&q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${i} targets in `+(u-c)+`ms
	Removed ${m} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),O.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m}))))}}function t0(n,e){return new e0(n,e)}class n0{constructor(){this.changes=new Pn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Je.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?O.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class r0{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class s0{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&qr(r.mutation,s,Wt.empty(),Se.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,de()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=de()){const s=yn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let a=Mr();return i.forEach(((c,u)=>{a=a.insert(c,u.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=yn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,de())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((a,c)=>{t.set(a,c)}))}))}computeViews(e,t,r,s){let i=sn();const a=$r(),c=(function(){return $r()})();return t.forEach(((u,h)=>{const f=r.get(h.key);s.has(h.key)&&(f===void 0||f.mutation instanceof Di)?i=i.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),qr(f.mutation,h,f.mutation.getFieldMask(),Se.now())):a.set(h.key,Wt.empty())})),this.recalculateAndSaveOverlays(e,i).next((u=>(u.forEach(((h,f)=>a.set(h,f))),t.forEach(((h,f)=>c.set(h,new r0(f,a.get(h)??null)))),c)))}recalculateAndSaveOverlays(e,t){const r=$r();let s=new ke(((a,c)=>a-c)),i=de();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const c of a)c.keys().forEach((u=>{const h=t.get(u);if(h===null)return;let f=r.get(u)||Wt.empty();f=c.applyToLocalView(h,f),r.set(u,f);const m=(s.get(c.batchId)||de()).add(u);s=s.insert(c.batchId,m)}))})).next((()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),h=u.key,f=u.value,m=Fd();f.forEach((v=>{if(!i.has(v)){const S=$d(t.get(v),r.get(v));S!==null&&m.set(v,S),i=i.add(v)}})),a.push(this.documentOverlayCache.saveOverlays(e,h,m))}return O.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return dw(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Od(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):O.resolve(yn());let c=Kr,u=i;return a.next((h=>O.forEach(h,((f,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),i.get(f)?O.resolve():this.remoteDocumentCache.getEntry(e,f).next((v=>{u=u.insert(f,v)}))))).next((()=>this.populateOverlays(e,h,i))).next((()=>this.computeViews(e,u,h,de()))).next((f=>({batchId:c,changes:yw(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new W(t)).next((r=>{let s=Mr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=Mr();return this.indexManager.getCollectionParents(e,i).next((c=>O.forEach(c,(u=>{const h=(function(m,v){return new ls(v,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,r,s).next((f=>{f.forEach(((m,v)=>{a=a.insert(m,v)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((a=>{i.forEach(((u,h)=>{const f=h.getKey();a.get(f)===null&&(a=a.insert(f,Je.newInvalidDocument(f)))}));let c=Mr();return a.forEach(((u,h)=>{const f=i.get(u);f!==void 0&&qr(f.mutation,h,Wt.empty(),Se.now()),ki(t,h)&&(c=c.insert(u,h))})),c}))}}class i0{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return O.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Bn(s.createTime)}})(t)),O.resolve()}getNamedQuery(e,t){return O.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(s){return{name:s.name,query:Kw(s.bundledQuery),readTime:Bn(s.readTime)}})(t)),O.resolve()}}class o0{constructor(){this.overlays=new ke(W.comparator),this.Lr=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){const r=yn();return O.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.bt(e,t,i)})),O.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Lr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.Lr.delete(r)),O.resolve()}getOverlaysForCollection(e,t,r){const s=yn(),i=t.length+1,a=new W(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const u=c.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return O.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new ke(((h,f)=>h-f));const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let f=i.get(h.largestBatchId);f===null&&(f=yn(),i=i.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const c=yn(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((h,f)=>c.set(h,f))),!(c.size()>=s)););return O.resolve(c)}bt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Lr.get(s.largestBatchId).delete(r.key);this.Lr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Cw(t,r));let i=this.Lr.get(t);i===void 0&&(i=de(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class a0{constructor(){this.sessionToken=We.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}class Pa{constructor(){this.kr=new Be(qe.Kr),this.qr=new Be(qe.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const r=new qe(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Wr(new qe(e,t))}Qr(e,t){e.forEach((r=>this.removeReference(r,t)))}Gr(e){const t=new W(new Ae([])),r=new qe(t,e),s=new qe(t,e+1),i=[];return this.qr.forEachInRange([r,s],(a=>{this.Wr(a),i.push(a.key)})),i}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new W(new Ae([])),r=new qe(t,e),s=new qe(t,e+1);let i=de();return this.qr.forEachInRange([r,s],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new qe(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class qe{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return W.comparator(e.key,t.key)||le(e.Hr,t.Hr)}static Ur(e,t){return le(e.Hr,t.Hr)||W.comparator(e.key,t.key)}}class c0{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new Be(qe.Kr)}checkEmpty(e){return O.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Rw(i,t,r,s);this.mutationQueue.push(a);for(const c of s)this.Jr=this.Jr.add(new qe(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return O.resolve(a)}lookupMutationBatch(e,t){return O.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Xr(r),i=s<0?0:s;return O.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(this.mutationQueue.length===0?Hv:this.Yn-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new qe(t,0),s=new qe(t,Number.POSITIVE_INFINITY),i=[];return this.Jr.forEachInRange([r,s],(a=>{const c=this.Zr(a.Hr);i.push(c)})),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Be(le);return t.forEach((s=>{const i=new qe(s,0),a=new qe(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([i,a],(c=>{r=r.add(c.Hr)}))})),O.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;W.isDocumentKey(i)||(i=i.child(""));const a=new qe(new W(i),0);let c=new Be(le);return this.Jr.forEachWhile((u=>{const h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===s&&(c=c.add(u.Hr)),!0)}),a),O.resolve(this.Yr(c))}Yr(e){const t=[];return e.forEach((r=>{const s=this.Zr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){Re(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return O.forEach(t.mutations,(s=>{const i=new qe(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Jr=r}))}nr(e){}containsKey(e,t){const r=new qe(t,0),s=this.Jr.firstAfterOrEqual(r);return O.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class l0{constructor(e){this.ti=e,this.docs=(function(){return new ke(W.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return O.resolve(r?r.document.mutableCopy():Je.newInvalidDocument(t))}getEntries(e,t){let r=sn();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Je.newInvalidDocument(s))})),O.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=sn();const a=t.path,c=new W(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:h,value:{document:f}}=u.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Bv(Uv(f),r)<=0||(s.has(f.key)||ki(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return O.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ee(9500)}ni(e,t){return O.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new u0(this)}getSize(e){return O.resolve(this.size)}}class u0 extends n0{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(r)})),O.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class h0{constructor(e){this.persistence=e,this.ri=new Pn((t=>Ia(t)),xa),this.lastRemoteSnapshotVersion=Z.min(),this.highestTargetId=0,this.ii=0,this.si=new Pa,this.targetCount=0,this.oi=tr._r()}forEachTarget(e,t){return this.ri.forEach(((r,s)=>t(s))),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),O.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new tr(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.lr(t),O.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,O.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.ri.forEach(((a,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.ri.delete(a),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)})),O.waitFor(i).next((()=>s))}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){const r=this.ri.get(t)||null;return O.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),O.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((a=>{i.push(s.markPotentiallyOrphaned(e,a))})),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),O.resolve()}getMatchingKeysForTargetId(e,t){const r=this.si.jr(t);return O.resolve(r)}containsKey(e,t){return O.resolve(this.si.containsKey(t))}}class rf{constructor(e,t){this._i={},this.overlays={},this.ai=new Ri(0),this.ui=!1,this.ui=!0,this.ci=new a0,this.referenceDelegate=e(this),this.li=new h0(this),this.indexManager=new Qw,this.remoteDocumentCache=(function(s){return new l0(s)})((r=>this.referenceDelegate.hi(r))),this.serializer=new Ww(t),this.Pi=new i0(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new o0,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new c0(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){q("MemoryPersistence","Starting transaction:",e);const s=new d0(this.ai.next());return this.referenceDelegate.Ti(),r(s).next((i=>this.referenceDelegate.Ii(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ei(e,t){return O.or(Object.values(this._i).map((r=>()=>r.containsKey(e,t))))}}class d0 extends qv{constructor(e){super(),this.currentSequenceNumber=e}}class Na{constructor(e){this.persistence=e,this.Ri=new Pa,this.Ai=null}static Vi(e){return new Na(e)}get di(){if(this.Ai)return this.Ai;throw ee(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),O.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),O.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((s=>this.di.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.di.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.di,(r=>{const s=W.fromPath(r);return this.mi(e,s).next((i=>{i||t.removeEntry(s,Z.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return O.or([()=>O.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class ui{constructor(e,t){this.persistence=e,this.fi=new Pn((r=>Wv(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=t0(this,t)}static Vi(e,t){return new ui(e,t)}Ti(){}Ii(e){return O.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}pr(e){let t=0;return this.mr(e,(r=>{t++})).next((()=>t))}mr(e,t){return O.forEach(this.fi,((r,s)=>this.wr(e,r,s).next((i=>i?O.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ni(e,(a=>this.wr(e,a,t).next((c=>{c||(r++,i.removeEntry(a,Z.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),O.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),O.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),O.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),O.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Hs(e.data.value)),t}wr(e,t,r){return O.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.fi.get(t);return O.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ka{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=s}static Es(e,t){let r=de(),s=de();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new ka(e,t.fromCache,r,s)}}class f0{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class p0{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return l_()?8:zv(Ze())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.gs(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ps(e,t,s,r).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new f0;return this.ys(e,t,a).next((c=>{if(i.result=c,this.As)return this.ws(e,t,a,c.size)}))})).next((()=>i.result))}ws(e,t,r,s){return r.documentReadCount<this.Vs?(Mn()<=ie.DEBUG&&q("QueryEngine","SDK will not create cache indexes for query:",Fn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),O.resolve()):(Mn()<=ie.DEBUG&&q("QueryEngine","Query:",Fn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(Mn()<=ie.DEBUG&&q("QueryEngine","The SDK decides to create cache indexes for query:",Fn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,bt(t))):O.resolve())}gs(e,t){if(lu(t))return O.resolve(null);let r=bt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Ko(t,null,"F"),r=bt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const a=de(...i);return this.fs.getDocuments(e,a).next((c=>this.indexManager.getMinOffset(e,r).next((u=>{const h=this.bs(t,c);return this.Ss(t,h,a,u.readTime)?this.gs(e,Ko(t,null,"F")):this.Ds(e,h,t,u)}))))})))))}ps(e,t,r,s){return lu(t)||s.isEqual(Z.min())?O.resolve(null):this.fs.getDocuments(e,r).next((i=>{const a=this.bs(t,i);return this.Ss(t,a,r,s)?O.resolve(null):(Mn()<=ie.DEBUG&&q("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Fn(t)),this.Ds(e,a,t,jv(s,Kr)).next((c=>c)))}))}bs(e,t){let r=new Be(Vd(e));return t.forEach(((s,i)=>{ki(e,i)&&(r=r.add(i))})),r}Ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ys(e,t,r){return Mn()<=ie.DEBUG&&q("QueryEngine","Using full collection scan to execute query:",Fn(t)),this.fs.getDocumentsMatchingQuery(e,t,en.min(),r)}Ds(e,t,r,s){return this.fs.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const Oa="LocalStore",m0=3e8;class g0{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new ke(le),this.Fs=new Pn((i=>Ia(i)),xa),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new s0(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function y0(n,e,t,r){return new g0(n,e,t,r)}async function sf(n,e){const t=he(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Os(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const a=[],c=[];let u=de();for(const h of s){a.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}for(const h of i){c.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next((h=>({Ns:h,removedBatchIds:a,addedBatchIds:c})))}))}))}function of(n){const e=he(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function _0(n,e){const t=he(n),r=e.snapshotVersion;let s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;const c=[];e.targetChanges.forEach(((f,m)=>{const v=s.get(m);if(!v)return;c.push(t.li.removeMatchingKeys(i,f.removedDocuments,m).next((()=>t.li.addMatchingKeys(i,f.addedDocuments,m))));let S=v.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?S=S.withResumeToken(We.EMPTY_BYTE_STRING,Z.min()).withLastLimboFreeSnapshotVersion(Z.min()):f.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(f.resumeToken,r)),s=s.insert(m,S),(function(C,A,F){return C.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=m0?!0:F.addedDocuments.size+F.modifiedDocuments.size+F.removedDocuments.size>0})(v,S,f)&&c.push(t.li.updateTargetData(i,S))}));let u=sn(),h=de();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))})),c.push(v0(i,a,e.documentUpdates).next((f=>{u=f.Bs,h=f.Ls}))),!r.isEqual(Z.min())){const f=t.li.getLastRemoteSnapshotVersion(i).next((m=>t.li.setTargetsMetadata(i,i.currentSequenceNumber,r)));c.push(f)}return O.waitFor(c).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,u,h))).next((()=>u))})).then((i=>(t.vs=s,i)))}function v0(n,e,t){let r=de(),s=de();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let a=sn();return t.forEach(((c,u)=>{const h=i.get(c);u.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(c)),u.isNoDocument()&&u.version.isEqual(Z.min())?(e.removeEntry(c,u.readTime),a=a.insert(c,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),a=a.insert(c,u)):q(Oa,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",u.version)})),{Bs:a,Ls:s}}))}function w0(n,e){const t=he(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.li.getTargetData(r,e).next((i=>i?(s=i,O.resolve(s)):t.li.allocateTargetId(r).next((a=>(s=new Kt(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.vs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r}))}async function ea(n,e,t){const r=he(n),s=r.vs.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!ur(a))throw a;q(Oa,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(s.target)}function Eu(n,e,t){const r=he(n);let s=Z.min(),i=de();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(u,h,f){const m=he(u),v=m.Fs.get(f);return v!==void 0?O.resolve(m.vs.get(v)):m.li.getTargetData(h,f)})(r,a,bt(e)).next((c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,c.targetId).next((u=>{i=u}))})).next((()=>r.Cs.getDocumentsMatchingQuery(a,e,t?s:Z.min(),t?i:de()))).next((c=>(b0(r,pw(e),c),{documents:c,ks:i})))))}function b0(n,e,t){let r=n.Ms.get(e)||Z.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.Ms.set(e,r)}class Tu{constructor(){this.activeTargetIds=ww()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class E0{constructor(){this.vo=new Tu,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Tu,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class T0{Mo(e){}shutdown(){}}const Iu="ConnectivityMonitor";class xu{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){q(Iu,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){q(Iu,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Ms=null;function ta(){return Ms===null?Ms=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ms++,"0x"+Ms.toString(16)}const vo="RestConnection",I0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class x0{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.$o=this.databaseId.database===si?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,i){const a=ta(),c=this.Qo(e,t.toUriEncodedString());q(vo,`Sending RPC '${e}' ${a}:`,c,r);const u={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(u,s,i);const{host:h}=new URL(c),f=ar(h);return this.zo(e,c,u,r,f).then((m=>(q(vo,`Received RPC '${e}' ${a}: `,m),m)),(m=>{throw Sn(vo,`RPC '${e}' ${a} failed with error: `,m,"url: ",c,"request:",r),m}))}jo(e,t,r,s,i,a){return this.Wo(e,t,r,s,i)}Go(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+lr})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}Qo(e,t){const r=I0[e];let s=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}class A0{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const Ke="WebChannelConnection",Or=(n,e,t)=>{n.listen(e,(r=>{try{t(r)}catch(s){setTimeout((()=>{throw s}),0)}}))};class $n extends x0{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!$n.c_){const e=hd();Or(e,ud.STAT_EVENT,(t=>{t.stat===Uo.PROXY?q(Ke,"STAT_EVENT: detected buffering proxy"):t.stat===Uo.NOPROXY&&q(Ke,"STAT_EVENT: detected no buffering proxy")})),$n.c_=!0}}zo(e,t,r,s,i){const a=ta();return new Promise(((c,u)=>{const h=new cd;h.setWithCredentials(!0),h.listenOnce(ld.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case zs.NO_ERROR:const m=h.getResponseJson();q(Ke,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),c(m);break;case zs.TIMEOUT:q(Ke,`RPC '${e}' ${a} timed out`),u(new z(V.DEADLINE_EXCEEDED,"Request time out"));break;case zs.HTTP_ERROR:const v=h.getStatus();if(q(Ke,`RPC '${e}' ${a} failed with status:`,v,"response text:",h.getResponseText()),v>0){let S=h.getResponseJson();Array.isArray(S)&&(S=S[0]);const x=S?.error;if(x&&x.status&&x.message){const C=(function(F){const j=F.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(j)>=0?j:V.UNKNOWN})(x.status);u(new z(C,x.message))}else u(new z(V.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new z(V.UNAVAILABLE,"Connection failed."));break;default:ee(9055,{l_:e,streamId:a,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{q(Ke,`RPC '${e}' ${a} completed.`)}}));const f=JSON.stringify(s);q(Ke,`RPC '${e}' ${a} sending request:`,s),h.send(t,"POST",f,r,15)}))}T_(e,t,r){const s=ta(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Go(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const h=i.join("");q(Ke,`Creating RPC '${e}' stream ${s}: ${h}`,c);const f=a.createWebChannel(h,c);this.I_(f);let m=!1,v=!1;const S=new A0({Ho:x=>{v?q(Ke,`Not sending because RPC '${e}' stream ${s} is closed:`,x):(m||(q(Ke,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),q(Ke,`RPC '${e}' stream ${s} sending:`,x),f.send(x))},Jo:()=>f.close()});return Or(f,Vr.EventType.OPEN,(()=>{v||(q(Ke,`RPC '${e}' stream ${s} transport opened.`),S.i_())})),Or(f,Vr.EventType.CLOSE,(()=>{v||(v=!0,q(Ke,`RPC '${e}' stream ${s} transport closed`),S.o_(),this.E_(f))})),Or(f,Vr.EventType.ERROR,(x=>{v||(v=!0,Sn(Ke,`RPC '${e}' stream ${s} transport errored. Name:`,x.name,"Message:",x.message),S.o_(new z(V.UNAVAILABLE,"The operation could not be completed")))})),Or(f,Vr.EventType.MESSAGE,(x=>{if(!v){const C=x.data[0];Re(!!C,16349);const A=C,F=A?.error||A[0]?.error;if(F){q(Ke,`RPC '${e}' stream ${s} received error:`,F);const j=F.status;let D=(function(H){const E=Ve[H];if(E!==void 0)return zd(E)})(j),M=F.message;j==="NOT_FOUND"&&M.includes("database")&&M.includes("does not exist")&&M.includes(this.databaseId.database)&&Sn(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),D===void 0&&(D=V.INTERNAL,M="Unknown error status: "+j+" with message "+F.message),v=!0,S.o_(new z(D,M)),f.close()}else q(Ke,`RPC '${e}' stream ${s} received:`,C),S.__(C)}})),$n.u_(),setTimeout((()=>{S.s_()}),0),S}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return dd()}}function S0(n){return new $n(n)}function wo(){return typeof document<"u"?document:null}function Mi(n){return new Fw(n,!0)}$n.c_=!1;class af{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=s,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&q("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const Au="PersistentStream";class R0{constructor(e,t,r,s,i,a,c,u){this.Ci=e,this.b_=r,this.S_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new af(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(Nt(t.toString()),Nt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===V.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new z(V.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{r((()=>this.listener.Zo()))})),this.stream.Yo((()=>{r((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.H_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return q(Au,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(q(Au,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class C0 extends R0{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=jw(this.serializer,e),r=(function(i){if(!("targetChange"in i))return Z.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?Z.min():a.readTime?Bn(a.readTime):Z.min()})(e);return this.listener.J_(t,r)}Z_(e){const t={};t.database=_u(this.serializer),t.addTarget=(function(i,a){let c;const u=a.target;if(c=Go(u)?{documents:Uw(i,u)}:{query:Bw(i,u).ft},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Wd(i,a.resumeToken);const h=Yo(i,a.expectedCount);h!==null&&(c.expectedCount=h)}else if(a.snapshotVersion.compareTo(Z.min())>0){c.readTime=Xo(i,a.snapshotVersion.toTimestamp());const h=Yo(i,a.expectedCount);h!==null&&(c.expectedCount=h)}return c})(this.serializer,e);const r=qw(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){const t={};t.database=_u(this.serializer),t.removeTarget=e,this.K_(t)}}class P0{}class N0 extends P0{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new z(V.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Wo(e,Zo(t,r),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new z(V.UNKNOWN,i.toString())}))}jo(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,c])=>this.connection.jo(e,Zo(t,r),s,a,c,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new z(V.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function k0(n,e,t,r){return new N0(n,e,t,r)}class O0{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Nt(t),this.aa=!1):q("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const nr="RemoteStore";class D0{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo((a=>{r.enqueueAndForget((async()=>{ds(this)&&(q(nr,"Restarting streams for network reachability change."),await(async function(u){const h=he(u);h.Ea.add(4),await hs(h),h.Va.set("Unknown"),h.Ea.delete(4),await Fi(h)})(this))}))})),this.Va=new O0(r,s)}}async function Fi(n){if(ds(n))for(const e of n.Ra)await e(!0)}async function hs(n){for(const e of n.Ra)await e(!1)}function cf(n,e){const t=he(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Fa(t)?Ma(t):dr(t).O_()&&Va(t,e))}function Da(n,e){const t=he(n),r=dr(t);t.Ia.delete(e),r.O_()&&lf(t,e),t.Ia.size===0&&(r.O_()?r.L_():ds(t)&&t.Va.set("Unknown"))}function Va(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Z.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}dr(n).Z_(e)}function lf(n,e){n.da.$e(e),dr(n).X_(e)}function Ma(n){n.da=new Ow({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),dr(n).start(),n.Va.ua()}function Fa(n){return ds(n)&&!dr(n).x_()&&n.Ia.size>0}function ds(n){return he(n).Ea.size===0}function uf(n){n.da=void 0}async function V0(n){n.Va.set("Online")}async function M0(n){n.Ia.forEach(((e,t)=>{Va(n,e)}))}async function F0(n,e){uf(n),Fa(n)?(n.Va.ha(e),Ma(n)):n.Va.set("Unknown")}async function L0(n,e,t){if(n.Va.set("Online"),e instanceof Gd&&e.state===2&&e.cause)try{await(async function(s,i){const a=i.cause;for(const c of i.targetIds)s.Ia.has(c)&&(await s.remoteSyncer.rejectListen(c,a),s.Ia.delete(c),s.da.removeTarget(c))})(n,e)}catch(r){q(nr,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Su(n,r)}else if(e instanceof Ws?n.da.Xe(e):e instanceof Hd?n.da.st(e):n.da.tt(e),!t.isEqual(Z.min()))try{const r=await of(n.localStore);t.compareTo(r)>=0&&await(function(i,a){const c=i.da.Tt(a);return c.targetChanges.forEach(((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.Ia.get(h);f&&i.Ia.set(h,f.withResumeToken(u.resumeToken,a))}})),c.targetMismatches.forEach(((u,h)=>{const f=i.Ia.get(u);if(!f)return;i.Ia.set(u,f.withResumeToken(We.EMPTY_BYTE_STRING,f.snapshotVersion)),lf(i,u);const m=new Kt(f.target,u,h,f.sequenceNumber);Va(i,m)})),i.remoteSyncer.applyRemoteEvent(c)})(n,t)}catch(r){q(nr,"Failed to raise snapshot:",r),await Su(n,r)}}async function Su(n,e,t){if(!ur(e))throw e;n.Ea.add(1),await hs(n),n.Va.set("Offline"),t||(t=()=>of(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{q(nr,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Fi(n)}))}async function Ru(n,e){const t=he(n);t.asyncQueue.verifyOperationInProgress(),q(nr,"RemoteStore received new credentials");const r=ds(t);t.Ea.add(3),await hs(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Fi(t)}async function j0(n,e){const t=he(n);e?(t.Ea.delete(2),await Fi(t)):e||(t.Ea.add(2),await hs(t),t.Va.set("Unknown"))}function dr(n){return n.ma||(n.ma=(function(t,r,s){const i=he(t);return i.sa(),new C0(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Zo:V0.bind(null,n),Yo:M0.bind(null,n),t_:F0.bind(null,n),J_:L0.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),Fa(n)?Ma(n):n.Va.set("Unknown")):(await n.ma.stop(),uf(n))}))),n.ma}class La{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new vn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,c=new La(e,t,a,s,i);return c.start(r),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new z(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hf(n,e){if(Nt("AsyncQueue",`${e}: ${n}`),ur(n))return new z(V.UNAVAILABLE,`${e}: ${n}`);throw n}class qn{static emptySet(e){return new qn(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||W.comparator(t.key,r.key):(t,r)=>W.comparator(t.key,r.key),this.keyedMap=Mr(),this.sortedSet=new ke(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof qn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new qn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Cu{constructor(){this.ga=new ke(W.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ee(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class rr{constructor(e,t,r,s,i,a,c,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach((c=>{a.push({type:0,doc:c})})),new rr(e,t,qn.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ni(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class U0{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class B0{constructor(){this.queries=Pu(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=he(t),i=s.queries;s.queries=Pu(),i.forEach(((a,c)=>{for(const u of c.ba)u.onError(r)}))})(this,new z(V.ABORTED,"Firestore shutting down"))}}function Pu(){return new Pn((n=>Dd(n)),Ni)}async function $0(n,e){const t=he(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.Sa()&&e.Da()&&(r=2):(i=new U0,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const c=hf(a,`Initialization of query '${Fn(e.query)}' failed`);return void e.onError(c)}t.queries.set(s,i),i.ba.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&ja(t)}async function q0(n,e){const t=he(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.ba.indexOf(e);a>=0&&(i.ba.splice(a,1),i.ba.length===0?s=e.Da()?0:1:!i.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function z0(n,e){const t=he(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const c of a.ba)c.Fa(s)&&(r=!0);a.wa=s}}r&&ja(t)}function H0(n,e,t){const r=he(n),s=r.queries.get(e);if(s)for(const i of s.ba)i.onError(t);r.queries.delete(e)}function ja(n){n.Ca.forEach((e=>{e.next()}))}var na,Nu;(Nu=na||(na={})).Ma="default",Nu.Cache="cache";class G0{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new rr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=rr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==na.Cache}}class df{constructor(e){this.key=e}}class ff{constructor(e){this.key=e}}class W0{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=de(),this.mutatedKeys=de(),this.eu=Vd(e),this.tu=new qn(this.eu)}get nu(){return this.Za}ru(e,t){const r=t?t.iu:new Cu,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,c=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((f,m)=>{const v=s.get(f),S=ki(this.query,m)?m:null,x=!!v&&this.mutatedKeys.has(v.key),C=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let A=!1;v&&S?v.data.isEqual(S.data)?x!==C&&(r.track({type:3,doc:S}),A=!0):this.su(v,S)||(r.track({type:2,doc:S}),A=!0,(u&&this.eu(S,u)>0||h&&this.eu(S,h)<0)&&(c=!0)):!v&&S?(r.track({type:0,doc:S}),A=!0):v&&!S&&(r.track({type:1,doc:v}),A=!0,(u||h)&&(c=!0)),A&&(S?(a=a.add(S),i=C?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:a,iu:r,Ss:c,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((f,m)=>(function(S,x){const C=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ee(20277,{Vt:A})}};return C(S)-C(x)})(f.type,m.type)||this.eu(f.doc,m.doc))),this.ou(r),s=s??!1;const c=t&&!s?this._u():[],u=this.Ya.size===0&&this.current&&!s?1:0,h=u!==this.Xa;return this.Xa=u,a.length!==0||h?{snapshot:new rr(this.query,e.tu,i,a,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Cu,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=de(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))}));const t=[];return e.forEach((r=>{this.Ya.has(r)||t.push(new ff(r))})),this.Ya.forEach((r=>{e.has(r)||t.push(new df(r))})),t}cu(e){this.Za=e.ks,this.Ya=de();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return rr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const Ua="SyncEngine";class K0{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Q0{constructor(e){this.key=e,this.hu=!1}}class J0{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Pn((c=>Dd(c)),Ni),this.Iu=new Map,this.Eu=new Set,this.Ru=new ke(W.comparator),this.Au=new Map,this.Vu=new Pa,this.du={},this.mu=new Map,this.fu=tr.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Y0(n,e,t=!0){const r=_f(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await pf(r,e,t,!0),s}async function X0(n,e){const t=_f(n);await pf(t,e,!0,!1)}async function pf(n,e,t,r){const s=await w0(n.localStore,bt(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let c;return r&&(c=await Z0(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&cf(n.remoteStore,s),c}async function Z0(n,e,t,r,s){n.pu=(m,v,S)=>(async function(C,A,F,j){let D=A.view.ru(F);D.Ss&&(D=await Eu(C.localStore,A.query,!1).then((({documents:E})=>A.view.ru(E,D))));const M=j&&j.targetChanges.get(A.targetId),$=j&&j.targetMismatches.get(A.targetId)!=null,H=A.view.applyChanges(D,C.isPrimaryClient,M,$);return Ou(C,A.targetId,H.au),H.snapshot})(n,m,v,S);const i=await Eu(n.localStore,e,!0),a=new W0(e,i.ks),c=a.ru(i.documents),u=us.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),h=a.applyChanges(c,n.isPrimaryClient,u);Ou(n,t,h.au);const f=new K0(e,t,a);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function eb(n,e,t){const r=he(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((a=>!Ni(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ea(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Da(r.remoteStore,s.targetId),ra(r,s.targetId)})).catch(Si)):(ra(r,s.targetId),await ea(r.localStore,s.targetId,!0))}async function tb(n,e){const t=he(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Da(t.remoteStore,r.targetId))}async function mf(n,e){const t=he(n);try{const r=await _0(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const a=t.Au.get(i);a&&(Re(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Re(a.hu,14607):s.removedDocuments.size>0&&(Re(a.hu,42227),a.hu=!1))})),await yf(t,r,e)}catch(r){await Si(r)}}function ku(n,e,t){const r=he(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((i,a)=>{const c=a.view.va(e);c.snapshot&&s.push(c.snapshot)})),(function(a,c){const u=he(a);u.onlineState=c;let h=!1;u.queries.forEach(((f,m)=>{for(const v of m.ba)v.va(c)&&(h=!0)})),h&&ja(u)})(r.eventManager,e),s.length&&r.Pu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function nb(n,e,t){const r=he(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new ke(W.comparator);a=a.insert(i,Je.newNoDocument(i,Z.min()));const c=de().add(i),u=new Vi(Z.min(),new Map,new ke(le),a,c);await mf(r,u),r.Ru=r.Ru.remove(i),r.Au.delete(e),Ba(r)}else await ea(r.localStore,e,!1).then((()=>ra(r,e,t))).catch(Si)}function ra(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((r=>{n.Vu.containsKey(r)||gf(n,r)}))}function gf(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(Da(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),Ba(n))}function Ou(n,e,t){for(const r of t)r instanceof df?(n.Vu.addReference(r.key,e),rb(n,r)):r instanceof ff?(q(Ua,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||gf(n,r.key)):ee(19791,{wu:r})}function rb(n,e){const t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(q(Ua,"New document in limbo: "+t),n.Eu.add(r),Ba(n))}function Ba(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new W(Ae.fromString(e)),r=n.fu.next();n.Au.set(r,new Q0(t)),n.Ru=n.Ru.insert(t,r),cf(n.remoteStore,new Kt(bt(kd(t.path)),r,"TargetPurposeLimboResolution",Ri.ce))}}async function yf(n,e,t){const r=he(n),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((c,u)=>{a.push(r.pu(u,e,t).then((h=>{if((h||t)&&r.isPrimaryClient){const f=h?!h.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(h){s.push(h);const f=ka.Es(u.targetId,h);i.push(f)}})))})),await Promise.all(a),r.Pu.J_(s),await(async function(u,h){const f=he(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>O.forEach(h,(v=>O.forEach(v.Ts,(S=>f.persistence.referenceDelegate.addReference(m,v.targetId,S))).next((()=>O.forEach(v.Is,(S=>f.persistence.referenceDelegate.removeReference(m,v.targetId,S)))))))))}catch(m){if(!ur(m))throw m;q(Oa,"Failed to update sequence numbers: "+m)}for(const m of h){const v=m.targetId;if(!m.fromCache){const S=f.vs.get(v),x=S.snapshotVersion,C=S.withLastLimboFreeSnapshotVersion(x);f.vs=f.vs.insert(v,C)}}})(r.localStore,i))}async function sb(n,e){const t=he(n);if(!t.currentUser.isEqual(e)){q(Ua,"User change. New user:",e.toKey());const r=await sf(t.localStore,e);t.currentUser=e,(function(i,a){i.mu.forEach((c=>{c.forEach((u=>{u.reject(new z(V.CANCELLED,a))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await yf(t,r.Ns)}}function ib(n,e){const t=he(n),r=t.Au.get(e);if(r&&r.hu)return de().add(r.key);{let s=de();const i=t.Iu.get(e);if(!i)return s;for(const a of i){const c=t.Tu.get(a);s=s.unionWith(c.view.nu)}return s}}function _f(n){const e=he(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=mf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ib.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=nb.bind(null,e),e.Pu.J_=z0.bind(null,e.eventManager),e.Pu.yu=H0.bind(null,e.eventManager),e}class hi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Mi(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return y0(this.persistence,new p0,e.initialUser,this.serializer)}Cu(e){return new rf(Na.Vi,this.serializer)}Du(e){return new E0}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}hi.provider={build:()=>new hi};class ob extends hi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Re(this.persistence.referenceDelegate instanceof ui,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Zw(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?rt.withCacheSize(this.cacheSizeBytes):rt.DEFAULT;return new rf((r=>ui.Vi(r,t)),this.serializer)}}class sa{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>ku(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=sb.bind(null,this.syncEngine),await j0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new B0})()}createDatastore(e){const t=Mi(e.databaseInfo.databaseId),r=S0(e.databaseInfo);return k0(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,a,c){return new D0(r,s,i,a,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>ku(this.syncEngine,t,0)),(function(){return xu.v()?new xu:new T0})())}createSyncEngine(e,t){return(function(s,i,a,c,u,h,f){const m=new J0(s,i,a,c,u,h);return f&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=he(t);q(nr,"RemoteStore shutting down."),r.Ea.add(5),await hs(r),r.Aa.shutdown(),r.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}sa.provider={build:()=>new sa};class ab{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Nt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const on="FirestoreClient";class cb{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=s,this.user=Qe.UNAUTHENTICATED,this.clientId=md.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async a=>{q(on,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(q(on,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new vn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=hf(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function bo(n,e){n.asyncQueue.verifyOperationInProgress(),q(on,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await sf(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Du(n,e){n.asyncQueue.verifyOperationInProgress();const t=await lb(n);q(on,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Ru(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Ru(e.remoteStore,s))),n._onlineComponents=e}async function lb(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){q(on,"Using user provided OfflineComponentProvider");try{await bo(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===V.FAILED_PRECONDITION||s.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;Sn("Error using user provided cache. Falling back to memory cache: "+t),await bo(n,new hi)}}else q(on,"Using default OfflineComponentProvider"),await bo(n,new ob(void 0));return n._offlineComponents}async function ub(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(q(on,"Using user provided OnlineComponentProvider"),await Du(n,n._uninitializedComponentsProvider._online)):(q(on,"Using default OnlineComponentProvider"),await Du(n,new sa))),n._onlineComponents}async function hb(n){const e=await ub(n),t=e.eventManager;return t.onListen=Y0.bind(null,e.syncEngine),t.onUnlisten=eb.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=X0.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=tb.bind(null,e.syncEngine),t}function db(n,e,t={}){const r=new vn;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,c,u,h){const f=new ab({next:v=>{f.Nu(),a.enqueueAndForget((()=>q0(i,m))),v.fromCache&&u.source==="server"?h.reject(new z(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(v)},error:v=>h.reject(v)}),m=new G0(c,f,{includeMetadataChanges:!0,Ka:!0});return $0(i,m)})(await hb(n),n.asyncQueue,e,t,r))),r.promise}function vf(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const fb="ComponentProvider",Vu=new Map;function pb(n,e,t,r,s){return new Jv(n,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,vf(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}const wf="firestore.googleapis.com",Mu=!0;class Fu{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new z(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=wf,this.ssl=Mu}else this.host=e.host,this.ssl=e.ssl??Mu;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=nf;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Yw)throw new z(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Lv("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=vf(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new z(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new z(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new z(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class $a{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Fu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new z(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new z(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Fu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Rv;switch(r.type){case"firstParty":return new kv(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new z(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Vu.get(t);r&&(q(fb,"Removing Datastore"),Vu.delete(t),r.terminate())})(this),Promise.resolve()}}function mb(n,e,t,r={}){n=$o(n,$a);const s=ar(e),i=n._getSettings(),a={...i,emulatorOptions:n._getEmulatorOptions()},c=`${e}:${t}`;s&&(Zh(`https://${c}`),ed("Firestore",!0)),i.host!==wf&&i.host!==c&&Sn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...i,host:c,ssl:s,emulatorOptions:r};if(!In(u,a)&&(n._setSettings(u),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Qe.MOCK_USER;else{h=e_(r.mockUserToken,n._app?.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new z(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Qe(m)}n._authCredentials=new Cv(new pd(h,f))}}class fr{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new fr(this.firestore,e,this._query)}}class tt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new zn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new tt(this.firestore,e,this._key)}toJSON(){return{type:tt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(cs(t,tt._jsonSchema))return new tt(e,r||null,new W(Ae.fromString(t.referencePath)))}}tt._jsonSchemaVersion="firestore/documentReference/1.0",tt._jsonSchema={type:Fe("string",tt._jsonSchemaVersion),referencePath:Fe("string")};class zn extends fr{constructor(e,t,r){super(e,t,kd(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new tt(this.firestore,null,new W(e))}withConverter(e){return new zn(this.firestore,e,this._path)}}function gb(n,e,...t){if(n=ht(n),n instanceof $a){const r=Ae.fromString(e,...t);return Ql(r),new zn(n,null,r)}{if(!(n instanceof tt||n instanceof zn))throw new z(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ae.fromString(e,...t));return Ql(r),new zn(n.firestore,null,r)}}const Lu="AsyncQueue";class ju{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new af(this,"async_queue_retry"),this._c=()=>{const r=wo();r&&q(Lu,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=wo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=wo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new vn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!ur(e))throw e;q(Lu,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Nt("INTERNAL UNHANDLED ERROR: ",Uu(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=La.createAndSchedule(this,e,t,r,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&ee(47125,{Pc:Uu(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Uu(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class bf extends $a{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new ju,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ju(e),this._firestoreClient=void 0,await e}}}function yb(n,e){const t=typeof n=="object"?n:sd(),r=typeof n=="string"?n:si,s=wa(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Xy("firestore");i&&mb(s,...i)}return s}function _b(n){if(n._terminated)throw new z(V.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||vb(n),n._firestoreClient}function vb(n){const e=n._freezeSettings(),t=pb(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new cb(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(n._componentsProvider))}class ct{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ct(We.fromBase64String(e))}catch(t){throw new z(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ct(We.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ct._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(cs(e,ct._jsonSchema))return ct.fromBase64String(e.bytes)}}ct._jsonSchemaVersion="firestore/bytes/1.0",ct._jsonSchema={type:Fe("string",ct._jsonSchemaVersion),bytes:Fe("string")};class Ef{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new z(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Tf{constructor(e){this._methodName=e}}class Et{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new z(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new z(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return le(this._lat,e._lat)||le(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Et._jsonSchemaVersion}}static fromJSON(e){if(cs(e,Et._jsonSchema))return new Et(e.latitude,e.longitude)}}Et._jsonSchemaVersion="firestore/geoPoint/1.0",Et._jsonSchema={type:Fe("string",Et._jsonSchemaVersion),latitude:Fe("number"),longitude:Fe("number")};class ut{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:ut._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(cs(e,ut._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new ut(e.vectorValues);throw new z(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ut._jsonSchemaVersion="firestore/vectorValue/1.0",ut._jsonSchema={type:Fe("string",ut._jsonSchemaVersion),vectorValues:Fe("object")};const wb=/^__.*__$/;function If(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ee(40011,{dataSource:n})}}class qa{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new qa({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){const t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return di(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(If(this.dataSource)&&wb.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class bb{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Mi(e)}createContext(e,t,r,s=!1){return new qa({dataSource:e,methodName:t,targetDoc:r,path:Xe.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Eb(n){const e=n._freezeSettings(),t=Mi(n._databaseId);return new bb(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Tb(n,e,t,r=!1){return za(t,n.createContext(r?4:3,e))}function za(n,e){if(xf(n=ht(n)))return xb("Unsupported field value:",e,n),Ib(n,e);if(n instanceof Tf)return(function(r,s){if(!If(s.dataSource))throw s.createError(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(r,s){const i=[];let a=0;for(const c of r){let u=za(c,s.childContextForArray(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=ht(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return bw(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Se.fromDate(r);return{timestampValue:Xo(s.serializer,i)}}if(r instanceof Se){const i=new Se(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Xo(s.serializer,i)}}if(r instanceof Et)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ct)return{bytesValue:Wd(s.serializer,r._byteString)};if(r instanceof tt){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Kd(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof ut)return(function(a,c){const u=a instanceof ut?a.toArray():a;return{mapValue:{fields:{[Id]:{stringValue:xd},[ii]:{arrayValue:{values:u.map((f=>{if(typeof f!="number")throw c.createError("VectorValues must only contain numeric values.");return Aa(c.serializer,f)}))}}}}}})(r,s);if(tf(r))return r._toProto(s.serializer);throw s.createError(`Unsupported field value: ${Ai(r)}`)})(n,e)}function Ib(n,e){const t={};return _d(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):hr(n,((r,s)=>{const i=za(s,e.childContextForField(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function xf(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Se||n instanceof Et||n instanceof ct||n instanceof tt||n instanceof Tf||n instanceof ut||tf(n))}function xb(n,e,t){if(!xf(t)||!gd(t)){const r=Ai(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function Ha(n,e,t){if((e=ht(e))instanceof Ef)return e._internalPath;if(typeof e=="string")return Sb(n,e);throw di("Field path arguments must be of type string or ",n,!1,void 0,t)}const Ab=new RegExp("[~\\*/\\[\\]]");function Sb(n,e,t){if(e.search(Ab)>=0)throw di(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ef(...e.split("."))._internalPath}catch{throw di(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function di(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new z(V.INVALID_ARGUMENT,c+n+u)}class Rb{convertValue(e,t="none"){switch(rn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ee(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return hr(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){const t=e.fields?.[ii].arrayValue?.values?.map((r=>Pe(r.doubleValue)));return new ut(t)}convertGeoPoint(e){return new Et(Pe(e.latitude),Pe(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Pi(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Qr(e));default:return null}}convertTimestamp(e){const t=tn(e);return new Se(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ae.fromString(e);Re(ef(r),9688,{name:e});const s=new Jr(r.get(1),r.get(3)),i=new W(r.popFirst(5));return s.isEqual(t)||Nt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class Cb extends Rb{constructor(e){super(),this.firestore=e}convertBytes(e){return new ct(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new tt(this.firestore,null,t)}}const Bu="@firebase/firestore",$u="4.11.0";class Af{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new tt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Pb(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(Ha("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Pb extends Af{data(){return super.data()}}function Nb(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new z(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ga{}class kb extends Ga{}function Ob(n,e,...t){let r=[];e instanceof Ga&&r.push(e),r=r.concat(t),(function(i){const a=i.filter((u=>u instanceof Wa)).length,c=i.filter((u=>u instanceof Li)).length;if(a>1||a>0&&c>0)throw new z(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class Li extends kb{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Li(e,t,r)}_apply(e){const t=this._parse(e);return Sf(e._query,t),new fr(e.firestore,e.converter,Wo(e._query,t))}_parse(e){const t=Eb(e.firestore);return(function(i,a,c,u,h,f,m){let v;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new z(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){zu(m,f);const x=[];for(const C of m)x.push(qu(u,i,C));v={arrayValue:{values:x}}}else v=qu(u,i,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||zu(m,f),v=Tb(c,a,m,f==="in"||f==="not-in");return Me.create(h,f,v)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Db(n,e,t){const r=e,s=Ha("where",n);return Li._create(s,r,t)}class Wa extends Ga{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Wa(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:dt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,i){let a=s;const c=i.getFlattenedFilters();for(const u of c)Sf(a,u),a=Wo(a,u)})(e._query,t),new fr(e.firestore,e.converter,Wo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function qu(n,e,t){if(typeof(t=ht(t))=="string"){if(t==="")throw new z(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Od(e)&&t.indexOf("/")!==-1)throw new z(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ae.fromString(t));if(!W.isDocumentKey(r))throw new z(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ru(n,new W(r))}if(t instanceof tt)return ru(n,t._key);throw new z(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ai(t)}.`)}function zu(n,e){if(!Array.isArray(n)||n.length===0)throw new z(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Sf(n,e){const t=(function(s,i){for(const a of s)for(const c of a.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new z(V.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new z(V.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Fs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Hn extends Af{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ks(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ha("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new z(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Hn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Hn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Hn._jsonSchema={type:Fe("string",Hn._jsonSchemaVersion),bundleSource:Fe("string","DocumentSnapshot"),bundleName:Fe("string"),bundle:Fe("string")};class Ks extends Hn{data(e={}){return super.data(e)}}class Gn{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Fs(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Ks(this._firestore,this._userDataWriter,r.key,r,new Fs(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new z(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((c=>{const u=new Ks(s._firestore,s._userDataWriter,c.doc.key,c.doc,new Fs(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((c=>i||c.type!==3)).map((c=>{const u=new Ks(s._firestore,s._userDataWriter,c.doc.key,c.doc,new Fs(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let h=-1,f=-1;return c.type!==0&&(h=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),f=a.indexOf(c.doc.key)),{type:Vb(c.type),doc:u,oldIndex:h,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new z(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Gn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=md.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Vb(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ee(61501,{type:n})}}Gn._jsonSchemaVersion="firestore/querySnapshot/1.0",Gn._jsonSchema={type:Fe("string",Gn._jsonSchemaVersion),bundleSource:Fe("string","QuerySnapshot"),bundleName:Fe("string"),bundle:Fe("string")};function Mb(n){n=$o(n,fr);const e=$o(n.firestore,bf),t=_b(e),r=new Cb(e);return Nb(n._query),db(t,n._query).then((s=>new Gn(e,r,n,s)))}(function(e,t=!0){Sv(cr),Yn(new xn("firestore",((r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),c=new bf(new Pv(r.getProvider("auth-internal")),new Ov(a,r.getProvider("app-check-internal")),Yv(a,s),a);return i={useFetchStreams:t,...i},c._setSettings(i),c}),"PUBLIC").setMultipleInstances(!0)),Xt(Bu,$u,e),Xt(Bu,$u,"esm2020")})();var Fb="firebase",Lb="12.9.0";Xt(Fb,Lb,"app");function Rf(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const jb=Rf,Cf=new os("auth","Firebase",Rf());const fi=new _a("@firebase/auth");function Ub(n,...e){fi.logLevel<=ie.WARN&&fi.warn(`Auth (${cr}): ${n}`,...e)}function Qs(n,...e){fi.logLevel<=ie.ERROR&&fi.error(`Auth (${cr}): ${n}`,...e)}function kt(n,...e){throw Ka(n,...e)}function Tt(n,...e){return Ka(n,...e)}function Pf(n,e,t){const r={...jb(),[e]:t};return new os("auth","Firebase",r).create(e,{appName:n.name})}function bn(n){return Pf(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ka(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Cf.create(n,...e)}function X(n,e,...t){if(!n)throw Ka(e,...t)}function Rt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Qs(e),new Error(e)}function Ot(n,e){n||Rt(e)}function ia(){return typeof self<"u"&&self.location?.href||""}function Bb(){return Hu()==="http:"||Hu()==="https:"}function Hu(){return typeof self<"u"&&self.location?.protocol||null}function $b(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Bb()||o_()||"connection"in navigator)?navigator.onLine:!0}function qb(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class fs{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ot(t>e,"Short delay should be less than long delay!"),this.isMobile=r_()||a_()}get(){return $b()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Qa(n,e){Ot(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Nf{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Rt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Rt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Rt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const zb={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Hb=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Gb=new fs(3e4,6e4);function Ja(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function pr(n,e,t,r,s={}){return kf(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const c=as({key:n.config.apiKey,...a}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const h={method:e,headers:u,...i};return i_()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&ar(n.emulatorConfig.host)&&(h.credentials="include"),Nf.fetch()(await Of(n,n.config.apiHost,t,c),h)})}async function kf(n,e,t){n._canInitEmulator=!1;const r={...zb,...e};try{const s=new Kb(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Ls(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const c=i.ok?a.errorMessage:a.error.message,[u,h]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ls(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw Ls(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw Ls(n,"user-disabled",a);const f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Pf(n,f,h);kt(n,f)}}catch(s){if(s instanceof Dt)throw s;kt(n,"network-request-failed",{message:String(s)})}}async function Wb(n,e,t,r,s={}){const i=await pr(n,e,t,r,s);return"mfaPendingCredential"in i&&kt(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function Of(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?Qa(n.config,s):`${n.config.apiScheme}://${s}`;return Hb.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}class Kb{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Tt(this.auth,"network-request-failed")),Gb.get())})}}function Ls(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Tt(n,e,r);return s.customData._tokenResponse=t,s}async function Qb(n,e){return pr(n,"POST","/v1/accounts:delete",e)}async function pi(n,e){return pr(n,"POST","/v1/accounts:lookup",e)}function zr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Jb(n,e=!1){const t=ht(n),r=await t.getIdToken(e),s=Ya(r);X(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:r,authTime:zr(Eo(s.auth_time)),issuedAtTime:zr(Eo(s.iat)),expirationTime:zr(Eo(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function Eo(n){return Number(n)*1e3}function Ya(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Qs("JWT malformed, contained fewer than 3 sections"),null;try{const s=Qh(t);return s?JSON.parse(s):(Qs("Failed to decode base64 JWT payload"),null)}catch(s){return Qs("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Gu(n){const e=Ya(n);return X(e,"internal-error"),X(typeof e.exp<"u","internal-error"),X(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Xr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Dt&&Yb(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Yb({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Xb{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class oa{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=zr(this.lastLoginAt),this.creationTime=zr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function mi(n){const e=n.auth,t=await n.getIdToken(),r=await Xr(n,pi(e,{idToken:t}));X(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=s.providerUserInfo?.length?Df(s.providerUserInfo):[],a=eE(n.providerData,i),c=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!a?.length,h=c?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new oa(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function Zb(n){const e=ht(n);await mi(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function eE(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Df(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function tE(n,e){const t=await kf(n,{},async()=>{const r=as({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await Of(n,s,"/v1/token",`key=${i}`),c=await n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:c,body:r};return n.emulatorConfig&&ar(n.emulatorConfig.host)&&(u.credentials="include"),Nf.fetch()(a,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function nE(n,e){return pr(n,"POST","/v2/accounts:revokeToken",Ja(n,e))}class Wn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){X(e.idToken,"internal-error"),X(typeof e.idToken<"u","internal-error"),X(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Gu(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){X(e.length!==0,"internal-error");const t=Gu(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(X(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await tE(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new Wn;return r&&(X(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(X(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(X(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Wn,this.toJSON())}_performRefresh(){return Rt("not implemented")}}function Bt(n,e){X(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class lt{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new Xb(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new oa(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Xr(this,this.stsTokenManager.getToken(this.auth,e));return X(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Jb(this,e)}reload(){return Zb(this)}_assign(e){this!==e&&(X(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new lt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){X(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await mi(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(vt(this.auth.app))return Promise.reject(bn(this.auth));const e=await this.getIdToken();return await Xr(this,Qb(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,c=t.tenantId??void 0,u=t._redirectEventId??void 0,h=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:m,emailVerified:v,isAnonymous:S,providerData:x,stsTokenManager:C}=t;X(m&&C,e,"internal-error");const A=Wn.fromJSON(this.name,C);X(typeof m=="string",e,"internal-error"),Bt(r,e.name),Bt(s,e.name),X(typeof v=="boolean",e,"internal-error"),X(typeof S=="boolean",e,"internal-error"),Bt(i,e.name),Bt(a,e.name),Bt(c,e.name),Bt(u,e.name),Bt(h,e.name),Bt(f,e.name);const F=new lt({uid:m,auth:e,email:s,emailVerified:v,displayName:r,isAnonymous:S,photoURL:a,phoneNumber:i,tenantId:c,stsTokenManager:A,createdAt:h,lastLoginAt:f});return x&&Array.isArray(x)&&(F.providerData=x.map(j=>({...j}))),u&&(F._redirectEventId=u),F}static async _fromIdTokenResponse(e,t,r=!1){const s=new Wn;s.updateFromServerResponse(t);const i=new lt({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await mi(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];X(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Df(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!i?.length,c=new Wn;c.updateFromIdToken(r);const u=new lt({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:a}),h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new oa(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(u,h),u}}const Wu=new Map;function Ct(n){Ot(n instanceof Function,"Expected a class definition");let e=Wu.get(n);return e?(Ot(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Wu.set(n,e),e)}class Vf{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Vf.type="NONE";const Ku=Vf;function Js(n,e,t){return`firebase:${n}:${e}:${t}`}class Kn{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Js(this.userKey,s.apiKey,i),this.fullPersistenceKey=Js("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await pi(this.auth,{idToken:e}).catch(()=>{});return t?lt._fromGetAccountInfoResponse(this.auth,t,e):null}return lt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Kn(Ct(Ku),e,r);const s=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=s[0]||Ct(Ku);const a=Js(r,e.config.apiKey,e.name);let c=null;for(const h of t)try{const f=await h._get(a);if(f){let m;if(typeof f=="string"){const v=await pi(e,{idToken:f}).catch(()=>{});if(!v)break;m=await lt._fromGetAccountInfoResponse(e,v,f)}else m=lt._fromJSON(e,f);h!==i&&(c=m),i=h;break}}catch{}const u=s.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new Kn(i,e,r):(i=u[0],c&&await i._set(a,c.toJSON()),await Promise.all(t.map(async h=>{if(h!==i)try{await h._remove(a)}catch{}})),new Kn(i,e,r))}}function Qu(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(jf(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Mf(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Bf(e))return"Blackberry";if($f(e))return"Webos";if(Ff(e))return"Safari";if((e.includes("chrome/")||Lf(e))&&!e.includes("edge/"))return"Chrome";if(Uf(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Mf(n=Ze()){return/firefox\//i.test(n)}function Ff(n=Ze()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Lf(n=Ze()){return/crios\//i.test(n)}function jf(n=Ze()){return/iemobile/i.test(n)}function Uf(n=Ze()){return/android/i.test(n)}function Bf(n=Ze()){return/blackberry/i.test(n)}function $f(n=Ze()){return/webos/i.test(n)}function Xa(n=Ze()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function rE(n=Ze()){return Xa(n)&&!!window.navigator?.standalone}function sE(){return c_()&&document.documentMode===10}function qf(n=Ze()){return Xa(n)||Uf(n)||$f(n)||Bf(n)||/windows phone/i.test(n)||jf(n)}function zf(n,e=[]){let t;switch(n){case"Browser":t=Qu(Ze());break;case"Worker":t=`${Qu(Ze())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${cr}/${r}`}class iE{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,c)=>{try{const u=e(i);a(u)}catch(u){c(u)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function oE(n,e={}){return pr(n,"GET","/v2/passwordPolicy",Ja(n,e))}const aE=6;class cE{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??aE,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class lE{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ju(this),this.idTokenSubscription=new Ju(this),this.beforeStateQueue=new iE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Cf,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ct(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Kn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await pi(this,{idToken:e}),r=await lt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(vt(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,a=r?._redirectEventId,c=await this.tryRedirectSignIn(e);(!i||i===a)&&c?.user&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return X(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await mi(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=qb()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(vt(this.app))return Promise.reject(bn(this));const t=e?ht(e):null;return t&&X(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&X(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return vt(this.app)?Promise.reject(bn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return vt(this.app)?Promise.reject(bn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ct(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await oE(this),t=new cE(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new os("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await nE(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ct(e)||this._popupRedirectResolver;X(t,this,"argument-error"),this.redirectPersistenceManager=await Kn.create(this,[Ct(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(X(c,this,"internal-error"),c.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return X(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=zf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(vt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Ub(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Za(n){return ht(n)}class Ju{constructor(e){this.auth=e,this.observer=null,this.addObserver=g_(t=>this.observer=t)}get next(){return X(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ec={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function uE(n){ec=n}function hE(n){return ec.loadJS(n)}function dE(){return ec.gapiScript}function fE(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function pE(n,e){const t=wa(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(In(i,e??{}))return s;kt(s,"already-initialized")}return t.initialize({options:e})}function mE(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Ct);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function gE(n,e,t){const r=Za(n);X(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=Hf(e),{host:a,port:c}=yE(e),u=c===null?"":`:${c}`,h={url:`${i}//${a}${u}/`},f=Object.freeze({host:a,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){X(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),X(In(h,r.config.emulator)&&In(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,ar(a)?(Zh(`${i}//${a}${u}`),ed("Auth",!0)):_E()}function Hf(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function yE(n){const e=Hf(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Yu(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:Yu(a)}}}function Yu(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function _E(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Gf{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Rt("not implemented")}_getIdTokenResponse(e){return Rt("not implemented")}_linkToIdToken(e,t){return Rt("not implemented")}_getReauthenticationResolver(e){return Rt("not implemented")}}async function Qn(n,e){return Wb(n,"POST","/v1/accounts:signInWithIdp",Ja(n,e))}const vE="http://localhost";class Rn extends Gf{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Rn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):kt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const a=new Rn(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Qn(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Qn(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Qn(e,t)}buildRequest(){const e={requestUri:vE,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=as(t)}return e}}class Wf{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ps extends Wf{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class qt extends ps{constructor(){super("facebook.com")}static credential(e){return Rn._fromParams({providerId:qt.PROVIDER_ID,signInMethod:qt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qt.credentialFromTaggedObject(e)}static credentialFromError(e){return qt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qt.credential(e.oauthAccessToken)}catch{return null}}}qt.FACEBOOK_SIGN_IN_METHOD="facebook.com";qt.PROVIDER_ID="facebook.com";class zt extends ps{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Rn._fromParams({providerId:zt.PROVIDER_ID,signInMethod:zt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return zt.credentialFromTaggedObject(e)}static credentialFromError(e){return zt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return zt.credential(t,r)}catch{return null}}}zt.GOOGLE_SIGN_IN_METHOD="google.com";zt.PROVIDER_ID="google.com";class Ht extends ps{constructor(){super("github.com")}static credential(e){return Rn._fromParams({providerId:Ht.PROVIDER_ID,signInMethod:Ht.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ht.credentialFromTaggedObject(e)}static credentialFromError(e){return Ht.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ht.credential(e.oauthAccessToken)}catch{return null}}}Ht.GITHUB_SIGN_IN_METHOD="github.com";Ht.PROVIDER_ID="github.com";class Gt extends ps{constructor(){super("twitter.com")}static credential(e,t){return Rn._fromParams({providerId:Gt.PROVIDER_ID,signInMethod:Gt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Gt.credentialFromTaggedObject(e)}static credentialFromError(e){return Gt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Gt.credential(t,r)}catch{return null}}}Gt.TWITTER_SIGN_IN_METHOD="twitter.com";Gt.PROVIDER_ID="twitter.com";class sr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await lt._fromIdTokenResponse(e,r,s),a=Xu(r);return new sr({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Xu(r);return new sr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Xu(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class gi extends Dt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,gi.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new gi(e,t,r,s)}}function Kf(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?gi._fromErrorAndOperation(n,i,e,r):i})}async function wE(n,e,t=!1){const r=await Xr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return sr._forOperation(n,"link",r)}async function bE(n,e,t=!1){const{auth:r}=n;if(vt(r.app))return Promise.reject(bn(r));const s="reauthenticate";try{const i=await Xr(n,Kf(r,s,e,n),t);X(i.idToken,r,"internal-error");const a=Ya(i.idToken);X(a,r,"internal-error");const{sub:c}=a;return X(n.uid===c,r,"user-mismatch"),sr._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&kt(r,"user-mismatch"),i}}async function EE(n,e,t=!1){if(vt(n.app))return Promise.reject(bn(n));const r="signIn",s=await Kf(n,r,e),i=await sr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}function TE(n,e,t,r){return ht(n).onIdTokenChanged(e,t,r)}function IE(n,e,t){return ht(n).beforeAuthStateChanged(e,t)}const yi="__sak";class Qf{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(yi,"1"),this.storage.removeItem(yi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const xE=1e3,AE=10;class Jf extends Qf{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=qf(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,c,u)=>{this.notifyListeners(a,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);sE()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,AE):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},xE)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Jf.type="LOCAL";const SE=Jf;class Yf extends Qf{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Yf.type="SESSION";const Xf=Yf;function RE(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class ji{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new ji(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const c=Array.from(a).map(async h=>h(t.origin,i)),u=await RE(c);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ji.receivers=[];function tc(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class CE{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((c,u)=>{const h=tc("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const v=m;if(v.data.eventId===h)switch(v.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(v.data.response);break;default:clearTimeout(f),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function It(){return window}function PE(n){It().location.href=n}function Zf(){return typeof It().WorkerGlobalScope<"u"&&typeof It().importScripts=="function"}async function NE(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function kE(){return navigator?.serviceWorker?.controller||null}function OE(){return Zf()?self:null}const ep="firebaseLocalStorageDb",DE=1,_i="firebaseLocalStorage",tp="fbase_key";class ms{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ui(n,e){return n.transaction([_i],e?"readwrite":"readonly").objectStore(_i)}function VE(){const n=indexedDB.deleteDatabase(ep);return new ms(n).toPromise()}function aa(){const n=indexedDB.open(ep,DE);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(_i,{keyPath:tp})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(_i)?e(r):(r.close(),await VE(),e(await aa()))})})}async function Zu(n,e,t){const r=Ui(n,!0).put({[tp]:e,value:t});return new ms(r).toPromise()}async function ME(n,e){const t=Ui(n,!1).get(e),r=await new ms(t).toPromise();return r===void 0?null:r.value}function eh(n,e){const t=Ui(n,!0).delete(e);return new ms(t).toPromise()}const FE=800,LE=3;class np{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await aa(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>LE)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Zf()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ji._getInstance(OE()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await NE(),!this.activeServiceWorker)return;this.sender=new CE(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||kE()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await aa();return await Zu(e,yi,"1"),await eh(e,yi),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Zu(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>ME(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>eh(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Ui(s,!1).getAll();return new ms(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),FE)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}np.type="LOCAL";const jE=np;new fs(3e4,6e4);function UE(n,e){return e?Ct(e):(X(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class nc extends Gf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Qn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Qn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Qn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function BE(n){return EE(n.auth,new nc(n),n.bypassAuthState)}function $E(n){const{auth:e,user:t}=n;return X(t,e,"internal-error"),bE(t,new nc(n),n.bypassAuthState)}async function qE(n){const{auth:e,user:t}=n;return X(t,e,"internal-error"),wE(t,new nc(n),n.bypassAuthState)}class rp{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:c}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(u))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return BE;case"linkViaPopup":case"linkViaRedirect":return qE;case"reauthViaPopup":case"reauthViaRedirect":return $E;default:kt(this.auth,"internal-error")}}resolve(e){Ot(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ot(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const zE=new fs(2e3,1e4);class Un extends rp{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Un.currentPopupAction&&Un.currentPopupAction.cancel(),Un.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return X(e,this.auth,"internal-error"),e}async onExecution(){Ot(this.filter.length===1,"Popup operations only handle one event");const e=tc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Tt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Tt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Un.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Tt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,zE.get())};e()}}Un.currentPopupAction=null;const HE="pendingRedirect",Ys=new Map;class GE extends rp{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Ys.get(this.auth._key());if(!e){try{const r=await WE(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ys.set(this.auth._key(),e)}return this.bypassAuthState||Ys.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function WE(n,e){const t=JE(e),r=QE(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function KE(n,e){Ys.set(n._key(),e)}function QE(n){return Ct(n._redirectPersistence)}function JE(n){return Js(HE,n.config.apiKey,n.name)}async function YE(n,e,t=!1){if(vt(n.app))return Promise.reject(bn(n));const r=Za(n),s=UE(r,e),a=await new GE(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const XE=600*1e3;class ZE{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!eT(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!sp(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Tt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=XE&&this.cachedEventUids.clear(),this.cachedEventUids.has(th(e))}saveEventToCache(e){this.cachedEventUids.add(th(e)),this.lastProcessedEventTime=Date.now()}}function th(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function sp({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function eT(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sp(n);default:return!1}}async function tT(n,e={}){return pr(n,"GET","/v1/projects",e)}const nT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rT=/^https?/;async function sT(n){if(n.config.emulator)return;const{authorizedDomains:e}=await tT(n);for(const t of e)try{if(iT(t))return}catch{}kt(n,"unauthorized-domain")}function iT(n){const e=ia(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!rT.test(t))return!1;if(nT.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const oT=new fs(3e4,6e4);function nh(){const n=It().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function aT(n){return new Promise((e,t)=>{function r(){nh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{nh(),t(Tt(n,"network-request-failed"))},timeout:oT.get()})}if(It().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(It().gapi?.load)r();else{const s=fE("iframefcb");return It()[s]=()=>{gapi.load?r():t(Tt(n,"network-request-failed"))},hE(`${dE()}?onload=${s}`).catch(i=>t(i))}}).catch(e=>{throw Xs=null,e})}let Xs=null;function cT(n){return Xs=Xs||aT(n),Xs}const lT=new fs(5e3,15e3),uT="__/auth/iframe",hT="emulator/auth/iframe",dT={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},fT=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function pT(n){const e=n.config;X(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Qa(e,hT):`https://${n.config.authDomain}/${uT}`,r={apiKey:e.apiKey,appName:n.name,v:cr},s=fT.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${as(r).slice(1)}`}async function mT(n){const e=await cT(n),t=It().gapi;return X(t,n,"internal-error"),e.open({where:document.body,url:pT(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:dT,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=Tt(n,"network-request-failed"),c=It().setTimeout(()=>{i(a)},lT.get());function u(){It().clearTimeout(c),s(r)}r.ping(u).then(u,()=>{i(a)})}))}const gT={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},yT=500,_T=600,vT="_blank",wT="http://localhost";class rh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function bT(n,e,t,r=yT,s=_T){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u={...gT,width:r.toString(),height:s.toString(),top:i,left:a},h=Ze().toLowerCase();t&&(c=Lf(h)?vT:t),Mf(h)&&(e=e||wT,u.scrollbars="yes");const f=Object.entries(u).reduce((v,[S,x])=>`${v}${S}=${x},`,"");if(rE(h)&&c!=="_self")return ET(e||"",c),new rh(null);const m=window.open(e||"",c,f);X(m,n,"popup-blocked");try{m.focus()}catch{}return new rh(m)}function ET(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const TT="__/auth/handler",IT="emulator/auth/handler",xT=encodeURIComponent("fac");async function sh(n,e,t,r,s,i){X(n.config.authDomain,n,"auth-domain-config-required"),X(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:cr,eventId:s};if(e instanceof Wf){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",m_(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,m]of Object.entries({}))a[f]=m}if(e instanceof ps){const f=e.getScopes().filter(m=>m!=="");f.length>0&&(a.scopes=f.join(","))}n.tenantId&&(a.tid=n.tenantId);const c=a;for(const f of Object.keys(c))c[f]===void 0&&delete c[f];const u=await n._getAppCheckToken(),h=u?`#${xT}=${encodeURIComponent(u)}`:"";return`${AT(n)}?${as(c).slice(1)}${h}`}function AT({config:n}){return n.emulator?Qa(n,IT):`https://${n.authDomain}/${TT}`}const To="webStorageSupport";class ST{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Xf,this._completeRedirectFn=YE,this._overrideRedirectResult=KE}async _openPopup(e,t,r,s){Ot(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await sh(e,t,r,ia(),s);return bT(e,i,tc())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await sh(e,t,r,ia(),s);return PE(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Ot(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await mT(e),r=new ZE(e);return t.register("authEvent",s=>(X(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(To,{type:To},s=>{const i=s?.[0]?.[To];i!==void 0&&t(!!i),kt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=sT(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return qf()||Ff()||Xa()}}const RT=ST;var ih="@firebase/auth",oh="1.12.0";class CT{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){X(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function PT(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function NT(n){Yn(new xn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;X(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:zf(n)},h=new lE(r,s,i,u);return mE(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Yn(new xn("auth-internal",e=>{const t=Za(e.getProvider("auth").getImmediate());return(r=>new CT(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Xt(ih,oh,PT(n)),Xt(ih,oh,"esm2020")}const kT=300,OT=Xh("authIdTokenMaxAge")||kT;let ah=null;const DT=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>OT)return;const s=t?.token;ah!==s&&(ah=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function VT(n=sd()){const e=wa(n,"auth");if(e.isInitialized())return e.getImmediate();const t=pE(n,{popupRedirectResolver:RT,persistence:[jE,SE,Xf]}),r=Xh("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=DT(i.toString());IE(t,a,()=>a(t.currentUser)),TE(t,c=>a(c))}}const s=Jh("auth");return s&&gE(t,`http://${s}`),t}function MT(){return document.getElementsByTagName("head")?.[0]??document}uE({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Tt("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",MT().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});NT("Browser");const FT={apiKey:"AIzaSyAsRbgTwtA9ZIcLwMIEiWzosxkmgl5mwL8",authDomain:"ar-drone-ops-portal.firebaseapp.com",projectId:"ar-drone-ops-portal",storageBucket:"ar-drone-ops-portal.firebasestorage.app",messagingSenderId:"619795744900",appId:"1:619795744900:web:4050256b1a2dcfc3abdad1"},ip=rd(FT);VT(ip);const LT=yb(ip);function jT({onAuthenticated:n}){const[e,t]=L.useState(""),[r,s]=L.useState(""),[i,a]=L.useState(!1),c=async u=>{u.preventDefault(),s(""),a(!0);try{const h=Ob(gb(LT,"accessCodes"),Db("code","==",e.trim().toLowerCase())),f=await Mb(h);if(f.empty){s("Invalid access code."),a(!1);return}const S=f.docs[0].data().project;sessionStorage.setItem("report_access",JSON.stringify({code:e.trim().toLowerCase(),project:S})),n(S)}catch{s("Unable to verify code. Please try again."),a(!1)}};return p.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center font-gravesend",children:p.jsxs("div",{className:"w-full max-w-sm p-8",children:[p.jsxs("div",{className:"text-center mb-8",children:[p.jsx("h1",{className:"text-2xl font-bold text-black",children:"AR Drone Ops"}),p.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Inspection Reports"})]}),p.jsxs("form",{onSubmit:c,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Access Code"}),p.jsx("input",{type:"text",value:e,onChange:u=>t(u.target.value),required:!0,autoFocus:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent text-black text-center text-lg tracking-widest font-sans",placeholder:"Enter your code"})]}),r&&p.jsx("p",{className:"text-sm text-red-600 text-center",children:r}),p.jsx("button",{type:"submit",disabled:i||!e.trim(),className:"w-full py-2.5 bg-black text-white font-medium rounded-lg hover:bg-gray-800 disabled:bg-gray-400 transition-colors",children:i?"Verifying...":"View Report"})]}),p.jsx("p",{className:"text-xs text-gray-400 text-center mt-8",children:"Contact AR Drone Ops for access"})]})})}const UT=L.lazy(()=>ca(()=>import("./ThreeView-XYcZP0wC.js"),__vite__mapDeps([4,1,2]))),BT=[{id:"viewer",label:"Thermal"},{id:"map",label:"Map"},{id:"3d",label:"3D"}],$T=new em({defaultOptions:{queries:{staleTime:300*1e3,refetchOnWindowFocus:!1}}});function qT({projectSlug:n}){const{currentImage:e,isLoading:t,markers:r,setCurrentImage:s}=St(),i=yh(),[a,c]=L.useState(!0),[u,h]=L.useState(!1),[f,m]=L.useState("viewer"),[v,S]=L.useState(null),[x,C]=L.useState("buildings"),{data:A,isLoading:F,error:j}=Nr({queryKey:["projectConfig",n],queryFn:()=>by(n??void 0)}),D=L.useMemo(()=>{const G=navigator.userAgent;return/iPhone|iPad|iPod|Android/i.test(G)},[]),M=L.useMemo(()=>{let G=A?.tabs?A.tabs.map(be=>({id:be.id,label:be.label})):BT;return D&&(G=G.filter(be=>be.id!=="3d")),G},[A?.tabs,D]),$=A?.singleProperty===!0;L.useEffect(()=>{if($&&n&&!v){const G=Ty(n);Rl(G),S("default"),C("images"),i.invalidateQueries()}},[$,n,v,i]);const{data:H,isLoading:E,error:_}=Nr({queryKey:["images",v],queryFn:()=>hy(),enabled:!!v}),{data:y}=Nr({queryKey:["mapData",v],queryFn:()=>_y(),enabled:!!v}),{data:T}=Nr({queryKey:["model3D",v],queryFn:()=>vy(),enabled:!!v}),{data:b}=Nr({queryKey:["orthophoto",v],queryFn:()=>wy(),enabled:!!v}),I=L.useCallback(G=>{s(null);const be=Ey(G);Rl(be),S(G),C("images"),i.invalidateQueries({queryKey:["images"]}),i.invalidateQueries({queryKey:["mapData"]}),i.invalidateQueries({queryKey:["model3D"]}),i.invalidateQueries({queryKey:["orthophoto"]})},[s,i]),w=L.useCallback(()=>{C("buildings"),s(null)},[s]);if(L.useEffect(()=>{e&&window.innerWidth<768&&c(!1)},[e]),F)return p.jsx("div",{className:"flex items-center justify-center h-screen bg-white font-gravesend",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"spinner-light mb-4"}),p.jsx("p",{className:"text-gray-500",children:"Loading project..."})]})});if(j)return p.jsx("div",{className:"flex items-center justify-center h-screen bg-white font-gravesend",children:p.jsxs("div",{className:"text-center p-8",children:[p.jsx("h1",{className:"text-2xl text-red-500 mb-4",children:"Project Load Error"}),p.jsx("p",{className:"text-gray-500 mb-4",children:"Could not load project configuration."}),p.jsx("code",{className:"block mt-4 p-2 bg-gray-100 rounded text-sm text-gray-600",children:String(j)})]})});if(_&&v)return p.jsx("div",{className:"flex items-center justify-center h-screen bg-white font-gravesend",children:p.jsxs("div",{className:"text-center p-8",children:[p.jsx("h1",{className:"text-2xl text-red-500 mb-4",children:"Data Load Error"}),p.jsxs("p",{className:"text-gray-500 mb-4",children:["Could not load thermal data",$?".":" for this building."]}),!$&&p.jsx("button",{onClick:w,className:"mt-4 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800",children:"Back to Buildings"})]})});const k=$?void 0:A?.buildings?.find(G=>G.id===v),Q=({tab:G})=>p.jsx("button",{onClick:()=>m(G.id),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium transition-all ${f===G.id?"bg-black text-white":"text-gray-400 hover:text-black hover:bg-gray-100"}`,children:p.jsx("span",{children:G.label})}),oe=f==="viewer",Le=f==="viewer";return p.jsxs("div",{className:"theme-light flex flex-col md:flex-row h-screen bg-white font-gravesend",children:[p.jsxs("header",{className:"md:hidden h-14 bg-white border-b border-gray-200 flex items-center px-2 justify-between shrink-0 safe-area-bottom",children:[oe?p.jsx("button",{onClick:()=>{c(!a),h(!1)},className:`flex items-center gap-1 px-3 py-2 rounded-lg transition-all ${a?"bg-black text-white":"text-black active:bg-gray-100"}`,children:p.jsx("span",{className:"text-sm font-medium",children:$?"Images":x==="buildings"?"Buildings":"Images"})}):p.jsx("div",{className:"w-20"}),p.jsx("div",{className:"flex gap-1",children:M.map(G=>p.jsx("button",{onClick:()=>m(G.id),className:`px-2.5 py-1.5 rounded-md text-xs font-medium transition-all ${f===G.id?"bg-black text-white":"text-gray-400 active:bg-gray-100"}`,children:p.jsx("span",{children:G.label})},G.id))}),Le?p.jsxs("button",{onClick:()=>{h(!u),c(!1)},className:`flex items-center gap-1 px-3 py-2 rounded-lg transition-all ${u?"bg-black text-white":"text-black active:bg-gray-100"}`,children:[p.jsx("span",{className:"text-sm font-medium",children:"Settings"}),r.length>0&&p.jsx("span",{className:"bg-[#ff6600] text-white text-xs px-1.5 py-0.5 rounded-full font-bold ml-1",children:r.length})]}):p.jsx("div",{className:"w-20"})]}),oe&&p.jsxs(p.Fragment,{children:[p.jsxs("aside",{className:`${a?"translate-x-0":"-translate-x-full"} md:translate-x-0 fixed md:relative z-30 h-[calc(100%-3.5rem)] md:h-auto top-14 md:top-0 w-72 transition-transform duration-300 ease-out bg-white border-r border-gray-200 overflow-y-auto`,children:[p.jsxs("div",{className:"md:hidden flex justify-between items-center p-3 border-b border-gray-200 sticky top-0 bg-white z-10",children:[p.jsx("span",{className:"font-bold text-black",children:$?"Images":x==="buildings"?"Select Building":k?.label||"Images"}),p.jsx("button",{onClick:()=>c(!1),className:"w-8 h-8 flex items-center justify-center text-gray-400 hover:text-black bg-gray-100 rounded-full",children:""})]}),!$&&x==="buildings"&&A?p.jsx(qy,{project:A,selectedBuildingId:v,onSelectBuilding:I}):(x==="images"||$)&&v?p.jsxs("div",{className:"flex flex-col h-full",children:[!$&&p.jsxs("button",{onClick:w,className:"hidden md:flex items-center gap-2 px-4 py-3 text-sm text-gray-500 hover:text-black hover:bg-gray-50 border-b border-gray-200 transition-colors",children:[p.jsx("span",{children:""}),p.jsx("span",{children:"All Buildings"}),k&&p.jsx("span",{className:"ml-auto text-xs font-medium text-[#ff6600]",children:k.label})]}),p.jsx("div",{className:"flex-1 overflow-y-auto",children:p.jsx(xy,{images:H?.images||[],flightGroups:H?.flightGroups||[],photoGroups:H?.photoGroups||[],isLoading:E})})]}):null]}),a&&p.jsx("div",{className:"md:hidden fixed inset-0 bg-black/40 z-20 top-14",onClick:()=>c(!1)}),p.jsx("button",{onClick:()=>c(!a),className:"hidden md:block absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-black hover:bg-gray-800 text-white p-2 rounded-r transition-all",style:{left:a?"288px":"0"},children:a?"":""})]}),p.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:[p.jsxs("header",{className:"hidden md:flex h-12 bg-white border-b border-gray-200 items-center px-4 justify-between shrink-0",children:[p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("h1",{className:"text-lg font-bold text-black",children:A?.name||"Thermal Viewer"}),p.jsx("div",{className:"flex gap-1 ml-4",children:M.map(G=>p.jsx(Q,{tab:G},G.id))})]}),p.jsxs("div",{className:"flex items-center gap-3",children:[k&&p.jsx("span",{className:"text-sm font-medium text-[#ff6600]",children:k.label}),e&&p.jsx("span",{className:"text-sm text-gray-400",children:e.filename})]})]}),p.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden min-h-0",children:[f==="viewer"&&p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"flex-1 relative min-h-[250px] md:min-h-0",children:[e?p.jsx(Dy,{}):p.jsx("div",{className:"flex items-center justify-center h-full",children:p.jsxs("div",{className:"text-center text-gray-400 p-4",children:[p.jsx("p",{className:"text-xl mb-2",children:v?"Select an image to begin":"Select a building to begin"}),p.jsx("p",{className:"text-sm",children:E?"Loading images...":v?`${H?.totalCount||0} images available`:$?"Loading...":`${A?.buildings?.filter(G=>G.hasData).length||0} buildings with data`}),!$&&p.jsx("button",{onClick:()=>c(!0),className:"mt-4 px-4 py-2 bg-black text-white rounded-lg md:hidden",children:v?"Browse Images":"Browse Buildings"})]})}),t&&p.jsx("div",{className:"absolute inset-0 bg-white/60 flex items-center justify-center",children:p.jsx("div",{className:"spinner-light"})})]}),p.jsx("aside",{className:`${u?"max-h-[60vh]":"max-h-0"} md:max-h-none md:w-80 overflow-hidden md:overflow-y-auto transition-all duration-300 ease-out bg-white border-t md:border-t-0 md:border-l border-gray-200`,children:p.jsx("div",{className:"overflow-y-auto max-h-[60vh] md:max-h-none",children:p.jsx(Vy,{})})})]}),f==="map"&&p.jsx("div",{className:"flex-1 relative",children:v?p.jsx(By,{images:H?.images||[],photoGroups:H?.photoGroups||[],mapData:y,orthophoto:b}):p.jsx("div",{className:"flex items-center justify-center h-full",children:p.jsx("p",{className:"text-gray-400",children:$?"Loading map data...":"Select a building to view map data"})})}),f==="3d"&&p.jsx("div",{className:"flex-1 relative",children:v?p.jsx(L.Suspense,{fallback:p.jsx("div",{className:"flex items-center justify-center h-full bg-white",children:p.jsxs("div",{className:"text-center text-gray-400",children:[p.jsx("div",{className:"spinner-light mb-4"}),p.jsx("p",{children:"Loading 3D viewer..."})]})}),children:p.jsx(UT,{images:H?.images||[],photoGroups:H?.photoGroups||[],modelUrl:T?.url,modelTransform:T?.transform,originLat:T?.originLat,originLon:T?.originLon})}):p.jsx("div",{className:"flex items-center justify-center h-full",children:p.jsx("p",{className:"text-gray-400",children:$?"Loading 3D model...":"Select a building to view 3D model"})})})]})]})]})}function zT(){const[n,e]=L.useState(!1),[t,r]=L.useState(null),s=new URLSearchParams(window.location.search).get("mode")==="report";L.useEffect(()=>{if(!s){e(!0);return}const a=sessionStorage.getItem("report_access");if(a){try{const c=JSON.parse(a);r(c.project||null)}catch{}e(!0)}},[s]);const i=L.useCallback(a=>{r(a),e(!0)},[]);return n?p.jsx(tm,{client:$T,children:p.jsx(qT,{projectSlug:t})}):p.jsx(jT,{onAuthenticated:i})}const pI=Object.freeze(Object.defineProperty({__proto__:null,default:zT},Symbol.toStringTag,{value:"Module"}));export{pI as P,gm as a,fm as c};
